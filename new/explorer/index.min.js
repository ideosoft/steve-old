"use strict";function getWindowKey(windowName){return"window."+windowName+".id"}function getWindowIdByName(windowName){return stbStorage.getItem(getWindowKey(windowName))}function openWindow(windowName,url){var windowInfo,windowKey=getWindowKey(windowName),windowID=stbStorage.getItem(windowKey);if(windowID)try{windowInfo=JSON.parse(stbWindowMgr.windowInfo(windowID)),-1===windowInfo.result.url.indexOf(url)&&stbWebWindow.messageSend(windowID,"window.load",url),windowName===WINDOWS.BROWSER?(windowID=stbWindowMgr.openWebFace(url),stbStorage.setItem(windowKey,windowID)):stbWindowMgr.windowShow(windowID)}catch(e){echo(e),stbWindowMgr.openWebFace(url)}else windowID=windowName===WINDOWS.BROWSER?stbWindowMgr.openWebFace(url):stbWindowMgr.windowInit(JSON.stringify({url:url,backgroundColor:"#000"})),stbStorage.setItem(windowKey,windowID);return windowID}function openWindowHelp(path){openWindow(WINDOWS.HELP,PATH_ROOT+"public/app/help/index.html?path="+path)}function elattr(obj,attr){if(obj&&obj.nodeType&&attr&&attr instanceof Object)for(var key in attr)attr.hasOwnProperty(key)&&(obj[key]=attr[key]);return obj}function element(name,attr,data){var tag=document.createElement(name);return elattr(tag,attr),elchild(tag,data),tag}function elchild(obj,value){if(obj&&value)if(value.nodeType)obj.appendChild(value);else if(Array.isArray(value))for(var i=0;i<value.length;i++)elchild(obj,value[i]);else obj.appendChild(document.createTextNode(value));return obj}function elclear(obj){if(null!==obj&&obj.nodeName&&obj.hasChildNodes())for(;obj.hasChildNodes();)obj.removeChild(obj.firstChild);return obj}function loadScript(src,onload,onerror){var elem=document.createElement("script");elem.type="text/javascript",elem.src=src,"function"==typeof onload&&(elem.onload=onload),"function"==typeof onerror&&(elem.onerror=onerror),document.head.appendChild(elem)}function getCurrentLanguage(langList){var langEnv=JSON.parse(gSTB.GetEnv('{"varList":["language"]}')),langVal="en";return langList=langList||["en","ru","uk","de","tr"],!langEnv.errMsg&&langEnv.result&&langEnv.result.language&&"string"==typeof langEnv.result.language&&(langEnv.result.language=langEnv.result.language.toLowerCase(),-1!==langList.indexOf(langEnv.result.language)&&(langVal=langEnv.result.language)),langVal}function getEnvList(list){var data;try{if(data=JSON.parse(gSTB.GetEnv(JSON.stringify({varList:list}))),""!==data.errMsg)throw new Error(data.errMsg);return data.result}catch(e){echo(e)}return!1}function getEnv(name){var data=getEnvList([name]);return data!==!1&&void 0!==data[name]?data[name]:data}function setEnv(key,value){var vars={};return vars[key]=value,setEnvList(vars)}function setEnvList(hash){try{return gSTB.SetEnv(JSON.stringify(hash))}catch(e){echo(e)}return!1}function eventPrepare(event,stopBubble,label){return void 0!==event.code?!0:(event.code=event.keyCode||event.which,0===event.code?!1:(event.shiftKey&&(event.code+=1e3),event.altKey&&(event.code+=2e3),event.code===KEYS.USB_MOUNTED||event.code===KEYS.USB_UNMOUNTED?!1:(stopBubble!==!1&&event.stopPropagation(),echo(event.code+"	"+event.shiftKey+"	"+event.ctrlKey+"	"+event.altKey+"	"+event.srcElement.id+"	"+event.target.id+"	"+(label||""),"keyDown [code/shift/ctrl/alt/src/target]"),!0)))}function ajax(method,url,callback,headers,type,async){var hname,jdata=null,timeout=null,xhr=new XMLHttpRequest,title="AJAX "+method.toUpperCase()+" "+url;if(async=async!==!1,xhr.onreadystatechange=function(){if(4===xhr.readyState)if(clearTimeout(timeout),ajax.stop)echo(xhr.status,title),"function"==typeof callback&&callback(null,null,null);else{if(echo("status:"+xhr.status+", length:"+xhr.responseText.length,title),echo(xhr.responseText,title),"json"===type&&200===xhr.status)try{jdata=JSON.parse(xhr.responseText)}catch(e){echo(e,"AJAX JSON.parse"),jdata=null}"function"==typeof callback&&callback("xml"===type?xhr.responseXML:"json"===type?jdata:xhr.responseText,xhr.status,xhr)}},xhr.open(method,url,async),headers)for(hname in headers)headers.hasOwnProperty(hname)&&xhr.setRequestHeader(hname,headers[hname]);return xhr.send(),echo("sent",title),timeout=setTimeout(function(){xhr.abort(),echo("ABORT on timeout",title)},6e4),xhr}function imageLoader(imgList,callback){var count=1,onload=function(){imgList.length===count&&"function"==typeof callback?callback():count++};Array.isArray(imgList)&&imgList.length>0?imgList.forEach(function(item){var img=new Image;img.src=item,img.onload=onload,img.onerror=function(){throw"Image "+item+" load fail"}}):0===imgList.length&&callback()}function getStorageInfo(){var snList={},info=JSON.parse(gSTB.GetStorageInfo("{}"));Array.isArray(info.result)&&""===info.errMsg&&info.result.length>0?(info.result.forEach(function(item){item.mediaType="000022272228"===item.sn?3:item.mediaType,item.label=item.label.trim(),snList[item.sn]?snList[item.sn]++:snList[item.sn]=1}),info.result.forEach(function(item){item.label||(item.label=item.vendor+" "+item.model.replace(/\//,""),snList[item.sn]>1&&(item.label+=" #"+item.partitionNum))}),info.result.sort(function(a,b){return a.mountPath<b.mountPath?-1:1}),window.STORAGE_INFO=info.result):window.STORAGE_INFO=[];try{window.HDD_INFO=JSON.parse(gSTB.RDir("get_hdd_info")||"[]")}catch(e){echo(e,"get_hdd_info"),window.HDD_INFO=[]}echo(STORAGE_INFO,"STORAGE_INFO"),echo(HDD_INFO,"HDD_INFO")}function parseUri(str){for(var o=parseUri.options,m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;i--;)uri[o.key[i]]=m[i]||"";return uri[o.q.name]={},uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){$1&&(uri[o.q.name][$1]=$2)}),uri}function validateUrl(url,sol){var solReg="((ffmpeg|auto|rtp|rtsp|mp3|mpegps|mpegts|mp4|ifm|fm|ffrt|ffrt2|ffrt3|ffrt4)(\\s))?";return new RegExp("^"+(sol?solReg:"")+"(((http|https|udp|rtp|rtsp|mms|mmsh|mmst|rtmp|igmp):\\/\\/)?@?(([a-zA-Z0-9а-яА-Я$\\-_.+!*'(),;:&=]|%[0-9a-fA-Fа-яА-Я]{2})+@)?(((25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])(\\.(25[0-5]|2[0-4][0-9]|[0-1][0-9][0-9]|[1-9][0-9]|[0-9])){3})|localhost|([a-zA-Zа-яА-Я0-9\\-\\u00C0-\\u017F]+\\.)+([a-zA-Zа-яА-Я]{2,}))(:[0-9]+)?|((file:///|/)[a-zA-Zа-яА-Я0-9\\-\\u00C0-\\u017F]+))(\\/(([a-zA-Zа-яА-Я0-9$\\-_.+!*'(),;:@&=\\s]|%[0-9a-fA-Fа-яА-Я]{2})*(\\/([a-zA-Zа-яА-Я0-9$\\-_.+!*'(),;:@&=\\s]|%[0-9a-fA-Fа-яА-Я]{2})*)*)?(\\?([a-zA-Zа-яА-Я0-9$\\-_.+!*'(),;:@&=\\/?]|%[0-9a-fA-Fа-яА-Я]{2})*)?(\\#([a-zA-Zа-яА-Я0-9$\\-_.+!*'(),;:@&=\\/?]|%[0-9a-fA-Fа-яА-Я]{2})*)?)?$").test(url)}function extend(target,source,override){var _target=override===!1?extend({},target):target||{};for(var prop in source)"object"!=typeof _target[prop]||"object"!=typeof source[prop]||Array.isArray(_target[prop])||Array.isArray(source[prop])?_target[prop]=source[prop]:_target[prop]=extend(_target[prop],source[prop],override);return _target}function base64Encode(data){return btoa(unescape(encodeURIComponent(data)))}function base64Decode(data){try{return decodeURIComponent(escape(atob(data)))}catch(error){echo(error,"base64Decode Error")}}function cutTextWithEllipsis(text,length){return text.length>length?text.toString().slice(0,length)+"...":text}function parseDate(dateStr){if(!dateStr)return new Date(NaN);var date=new Date(dateStr.match(/\w{3}\s\w{3}\s\d{1,2}\s\d{1,2}:\d{1,2}:\d{1,2}/)+" "+dateStr.match(/\d{4}/)),timeZone=dateStr.match(/(\w{1,4})\s+\d{4}/)[1],offset=timeZoneOffsets[timeZone];return 0!==offset.index&&date.setMinutes(date.getMinutes()+(offset.minutes||0)*offset.index-date.getTimezoneOffset()),date}function getMediaType(file){var extension=file.split(".").pop().toLowerCase();if(extension&&-1!==configuration.registersTypes.indexOf(extension))for(var type,i=0;i<MEDIA_TYPES.length,type=MEDIA_TYPES[i];i++)if(-1!==MEDIA_EXTENSION[type].indexOf(extension))return type;return MEDIA_TYPE_NONE}function readJSON(path,fileName){var result,xmlhttp=new XMLHttpRequest;path=path+"/"+fileName;try{xmlhttp.open("GET",path,!1),xmlhttp.send(null),result=xmlhttp.responseText}catch(e){echo(e,"some xmlhttp error"),result=""}return echo(result,"file "+path),result}function CBase(parent){this.name="CBase",this.handle=null,this.parent=null,this.handleInner=null,this.showAttr="block",this.baseClass="",this.prevFocus=null,this.isActive=!1,this.activeChild=null,this.isVisible=!0,this.SetParent(parent)}function Update(events){this.bind(events),this.check_url=this.update_url="",this.checked=!1}function CPage(parent){CBase.call(this,parent||null),this.name="CPage",this.previous=null,this.isVisible=!1}function CScrollList(parent){CBase.call(this,parent),this.name="CScrollList",this.baseClass="cslist-main",this.multipleSelection=!0,this.activeItem=null,this.states={},this.manageFocus=!0,this.defaultParams={hidden:!1,marked:!1,disabled:!1,focused:!1,href:"#",self:this,manageFocus:!0,oncontextmenu:EMULATION?null:function(){return!1},onclick:function(){return this.self.Focused(this,!0),!1},onmouseover:function(){return this.self.Focused(this,!0),!1}},this.defaultFilter={hidden:!1,disabled:!1},this.scrollMode=2,this.RENDER_MODE_SINGLE=1,this.RENDER_MODE_BULK=2,this.renderMode=this.RENDER_MODE_SINGLE,this.fragment=document.createDocumentFragment()}function CList(parent,customParams){CBase.call(this,parent),customParams||(customParams={}),this.name="CList",this.baseClass="clist-main",this.multipleSelection=!0,this.activeItem=null,this.items=[],this.list=[],this.itemIndex=0,this.listIndex=0,this.pageIndex=0,this.itemsHandle=null,this.scrollHandle=null,this.scrollThumb=null,this.states={},this.manageFocus=!1,this.defaultParams={hidden:!1,marked:!1,disabled:!1,focused:!1,self:this,index:-1,data:null,manageFocus:!1,oncontextmenu:EMULATION?null:function(){return!1},onclick:function(){return this.self.OnMouseover(this),this.self.pressOK(this),!1},onmouseover:function(){return this.self.OnMouseover(this),!1}},customParams.defaultParams&&(this.defaultParams=extend(this.defaultParams,customParams.defaultParams)),this.onPage=customParams.onPage?customParams.onPage:function(){var count={480:5,576:6,720:7,1080:7};return count[screen.height]}(),this.fillsName=customParams.fillsName?customParams.fillsName:{text:"text",data:"data"},this.defaultFilter={hidden:!1,disabled:!1},this.fragment=document.createDocumentFragment()}function VScrollBar(config){this.$node=null,this.$body=null,this.viewSize=10,this.realSize=100,this.value=0,this.thumbRect=null,this.trackRect=null,config=config||{},void 0!==config.$node?this.$node=config.$node:this.$node=document.createElement("div"),void 0!==config.$body?this.$body=config.$body:this.$body=this.$node.appendChild(document.createElement("div")),this.$node.classList.add("scrollBar"),this.$body.classList.add("thumb"),this.init(config)}function VList(parent){switch(this.activeItem=null,this.indexView=null,this.data=[],this.scrollBar=null,this.size=7,this.states={},screen.height){case 480:this.size=5;break;case 576:this.size=5;break;case 720:this.size=7;break;case 1080:this.size=7}CBase.call(this,parent)}function CGroupMenu(parent){CBase.call(this,parent),this.name="CGroupMenu",this.baseClass="cgmenu-main",this.activeGroup=null,this.active=!1,this.autoFocus=!0}function CModal(parent){CPage.call(this,parent),this.name="CModal",this.baseClass="cmodal-main",this.showAttr="table",this.focusList=[],this.focusPos=0}function CModalBox(parent){CModal.call(this,parent),this.name="CModalBox",this.header=element("div",{className:"cmodal-header"}),this.content=element("div",{className:"cmodal-content"}),this.footer=element("div",{className:"cmodal-footer"})}function CModalHint(parent,data,time,isForced){if(data){CModalBox.call(this,parent),this.name="CModalHint";var self=this;this.SetHeader(),this.SetContent(data),this.SetFooter(),this.onHide=function(){self.Free()},this.onClick=function(){self.Show(!1)},this.Init(),this.Show(!0),isForced!==!0&&(this.EventHandler=function(event){self.Show(!1),self.timer&&clearTimeout(self.timer),event.preventDefault()}),time&&(this.timer=setTimeout(function(){self.Show(!1)},time||5e3))}}function CModalAlert(parent,title,data,btnExitTitle,btnExitClick){if(data){CModalBox.call(this,parent),this.name="CModalAlert";var self=this;this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",btnExitTitle||"",function(){"function"==typeof btnExitClick&&btnExitClick.call(self),self.Show(!1)}),this.SetHeader(title),this.SetContent(data),this.SetFooter(this.bpanel.handle),this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(e){eventPrepare(e,!0,this.name)&&self.bpanel.EventHandler(e)},this.Init(),this.Show(!0)}}function CModalConfirm(parent,title,data,btnExitTitle,btnExitClick,btnOKTitle,btnOKClick){CModalAlert.call(this,parent,title,data,btnExitTitle,btnExitClick),this.name="CModalConfirm";var self=this;this.bpanel.Add(KEYS.OK,"ok.png",btnOKTitle,function(){self.Show(!1),"function"==typeof btnOKClick&&(btnOKClick.call(self),btnOKClick=null)})}function CButtonPanel(parent){CBase.call(this,parent),this.name="CButtonPanel",this.baseClass="cbpanel-main",this.path="",this.isActive=!0}function CBreadCrumb(parent){CBase.call(this,parent),this.name="CBreadCrumb",this.baseClass="cbcrumb-main",this.path="",this.leftItems=3,this.rightItems=2}function CSearchBar(parent){CBase.call(this,parent),this.name="CSearchBar",this.baseClass="csbar-main",this.filter="",this.path="",this.items={},this.timer=0,this.hint=0,this.icoSearch="ico_search2.png",this.icoFilter="ico_filter.png"}function CCheckBox(parent,parameters){var parentNode,_default=!!parameters.checked,self=this;if(CBase.call(this,parent||null),this.parameters=parameters||{},this.parameters.attributes=parameters.attributes||{},this.name=parameters.name||"input",this.type=this.tagName="checkbox",this.style=parameters.style||"",this.events=parameters.events||{},void 0===(parentNode=parameters.parent)){if(void 0===parameters.element)throw"parentNode or element parameter must be specified";parentNode=parameters.element.parentNode}this.bind(this.events),this.IsChanged=function(){return _default!==self.IsChecked()},this.Init(parentNode)}function CInput(parent,parameters){var _default="",self=this;if(this.parameters=parameters,this.attributes={input:{className:"cinput-input"},hint:{className:"cinput-hint cinput-input"},icon:{className:"cinput-icon"},wrapper:{className:"cinput-wrapper"},"text-wrapper":{className:"cinput-text-wrapper"}},this.SetAutocomplete(parameters.autocomplete),this.FoldedClass="folded",void 0!==parameters.attributes&&extend(this.attributes,parameters.attributes),parameters.folded===!0&&(this.attributes.wrapper.className+=" "+this.FoldedClass),void 0!==parameters.style&&(this.attributes.wrapper.className+=" "+parameters.style),this.events=parameters.events||{},CBase.call(this,parent||null),this.bind(this.events),this.type="input",this.name=parameters.name||"input",!(this.parentNode=parameters.parent)){if(void 0===parameters.input)throw"parent or input parameter must be specified";this.parentNode=parameters.input.parentNode}this.parameters.icons=this.parameters.icons||[],this.icons={},self.IsChanged=function(){return _default!==self.GetValue()},self.GetDefault=function(){return _default},self.SetDefault=function(def){_default=def},this.Init(this.GenerateHandle()),elchild(this.parentNode,this.handle)}function CFilterInput(parent,parameters){parameters=extend({style:"main-filter-input",icons:[{name:"ico_search",type:"left",style:"black_search"},{name:"ico_search2",type:"left",style:"white_search"},{name:"f4",click:function(){this.Fold(!this.IsFolded(),!0),this.trigger("onKey")}}]},parameters),CInput.call(this,parent||null,parameters)}function CSimpleSelect(parent,parameters){this.parameters=parameters||{},this.tagName="SELECT",this.attributes={content:{className:"csimple-select-content"},left_arrow:{className:"csimple-select-arrow left"},right_arrow:{className:"csimple-select-arrow right"},wrapper:{className:"csimple-select-wrapper",tabIndex:"1"},content_wrapper:{className:"csimple-content-wrapper"},hint:{className:"csimple-select-hint csimple-select-content"}},this.style=parameters.style||"",this.type="select",void 0!==parameters.attributes&&extend(this.attributes,parameters.attributes),this.bind(parameters.events||{}),CBase.call(this,parent||null),(this.parentNode=parameters.parent)||(void 0===parameters.content?this.parentNode=element("div"):this.parentNode=parameters.content.parentNode)}function CSelectBox(parent,parameters){CSimpleSelect.call(this,parent||null,parameters),this.attributes.wrapper.className+=" cselect-box",this.Init(this.GenerateHandle());var _selectedIndex,_default,_data=parameters.data||[],idField=parameters.idField||"id",nameField=parameters.nameField||"name",_autocomplete="",self=this,placeholder=parameters.placeholder||_("No data");this.name=parameters.name||"CSelectBox",this.dropdown=new CSelectDropdown(this,{select:this,scrollMode:2,container:parameters.container}),this.SetData=function(data){if(0===data.length)throw"data cannot be empty";_data=data||[],data.length-1<_selectedIndex&&(_selectedIndex=data.length-1),self.RefreshContent(),self.trigger("dataChanged")},this.GetNameField=function(){return nameField},this.GetIdField=function(){return idField},this.GetData=function(){return _data},this.Autocomplete=function(keyCode){var find=!1,text="";if(text=keyCode===KEYS.BACK?_autocomplete.slice(0,-1):_autocomplete+String.fromCharCode(keyCode).toLowerCase(),""!==text){for(var el,i=0;i<_data.length,el=_data[i];i++)if("object"==typeof el&&(el=el[nameField]),0===el.toLowerCase().indexOf(text)){this.SetIndex(i),find=!0;break}find===!0&&(self.handle.classList.add("autocomplete"),_autocomplete=text),text=this.GetLabel(),text&&(text=text.substr(0,_autocomplete.length)),self.SetHint(text)}else self.ClearAutocomplete()},this.ClearAutocomplete=function(){self.handle.classList.remove("autocomplete"),self.SetHint(_autocomplete="")},this.GetSelected=function(){return _data[_selectedIndex]},this.Next=function(){_selectedIndex<_data.length-1&&this.SetIndex(++_selectedIndex)},this.Previous=function(){0!==_selectedIndex&&this.SetIndex(--_selectedIndex)},this.GetValue=function(){var selected=self.GetSelected();return"object"==typeof selected?selected[idField]:selected},this.GetLabel=function(){var selected=self.GetSelected();return"object"==typeof selected?selected[nameField]:selected},this.RefreshContent=function(){return self.SetContent(self.GetLabel(),placeholder),self.value=self.GetValue(),1===self.GetData().length?(self.DisableElement(self.leftArrow,!0),void self.DisableElement(self.rightArrow,!0)):void(0===self.GetIndex()?(self.DisableElement(self.leftArrow,!0),self.DisableElement(self.rightArrow,!1)):self.GetIndex()===self.GetData().length-1?(self.DisableElement(self.rightArrow,!0),self.DisableElement(self.leftArrow,!1)):(self.DisableElement(self.leftArrow,!1),self.DisableElement(self.rightArrow,!1)))},this.SelectById=function(id,quiet){for(var i=0;i<_data.length;i++)if(_data[i][idField]===id)return self.SetIndex(i,quiet),i},this.IsChanged=function(){return _selectedIndex!==_default},this.GetIndex=function(){return _selectedIndex},this.SetIndex=function(index,quiet){var old=this.GetSelected();self.ClearAutocomplete(),_selectedIndex=void 0===index||index>=_data.length?0:index,self.RefreshContent(),quiet!==!0&&self.trigger("onChange",{"new":self.GetSelected(),old:old})},this.SetIndex(parameters.selected,!0),void 0!==parameters.selectedId&&this.SelectById(parameters.selectedId,!0),_default=_selectedIndex,this.EventHandler=function(event){switch(eventPrepare(event),event.stopped=!0,event.code){case KEYS.FRAME:this.dropdown.Show(!this.dropdown.isVisible,!1);break;case KEYS.LEFT:case KEYS.RIGHT:this.dropdown.isVisible||(CSimpleSelect.prototype.EventHandler.call(this,event),this.dropdown.EventHandler(event));break;case KEYS.OK:case KEYS.UP:case KEYS.DOWN:case KEYS.PAGE_UP:case KEYS.PAGE_DOWN:event.stopped=!1,this.dropdown.isVisible&&(this.dropdown.EventHandler(event,null,!1),event.stopped=!0);break;case KEYS.EXIT:this.dropdown.isVisible?this.dropdown.Show(!1,!1):event.stopped=!1;break;default:event.stopped=!1}},this.handle.onkeypress=function(event){event.ctrlKey!==!0&&event.altKey!==!0&&self.Autocomplete(event.charCode)},this.dropdown.Refresh(),this.bind("onBlur",function(){self.ClearAutocomplete()})}function CSelectDropdown(parent,options){CScrollList.call(this,parent||null,options);var self=this;this.isVisible=!1,this.manageFocus=!1,this.multipleSelection=!1,this.attributes={wrapper:{className:"csimple-select-dropdown"},element:{className:"dropdown-element"}},this.select=null,this.baseClass="csimple-dropdown-main",CSelectDropdown.parameters.forEach(function(key){void 0!==options[key]&&(self[key]=options[key])}),this.base=this.select.handle,this.Init(element("div",this.attributes.wrapper)),this.base.parentNode.appendChild(this.handle),this.select.bind("dataChanged",function(){self.Refresh()}),this.select.bind("onChange",function(){if(self.isVisible){var item=self.handleInner.children[this.GetIndex()];self.SetPosition(item,!0,!1),self.Focused(item,!0),self.Marked(item,!0)}}),this.select.bind("onBlur",function(){setTimeout(function(){self.Show(!1,self.manageFocus)},100)}),this.select.handle.addEventListener("click",function(event){self.Show(!self.isVisible,self.manageFocus),event.stopPropagation(),event.stopImmediatePropagation(),event.preventDefault()}),this.Show(!1,self.manageFocus)}function CIntervalBox(parent,parameters){var _default,_oldValue,self=this,_value=0,_inputValue="";CSimpleSelect.call(this,parent||null,parameters),this.inputTimer={},this.attributes.wrapper.className+=" cinterval-box",void 0===parameters.align&&(this.attributes.content.className+=" center"),void 0!==parameters.contentStyle&&(this.attributes.content.className+=" "+parameters.contentStyle),this.Init(this.GenerateHandle()),this.name=parameters.name||"input",this.type="interval",this.parameters=parameters,void 0!==parameters.align&&(this.content.className+=" "+parameters.align,this.content.style.textAlign=parameters.align),this.max=parameters.max,this.min=parameters.min,this.interval=parameters.interval||1,void 0!==parameters.value?_value=void 0!==this.max&&parameters.value>this.max?this.max:void 0!==this.min&&parameters.value<this.min?this.min:parameters.value:void 0!==this.min?_value=this.min:void 0!==this.max&&(_value=this.max),_default=_value=parseInt(_value),this.SetValue=function(value){_value=parseInt(value),self.SetContent(_value),self.trigger("onChange",_value)},this.GetValue=function(){return _value},this.Next=function(){if(_inputValue.length&&(clearInterval(this.inputTimer),this.inputDone()),CSimpleSelect.prototype.Next.call(),void 0!==self.max){if(!(_value+self.interval<=self.max))return;_value+=self.interval}else _value+=self.interval;self.RefreshContent(),self.trigger("onNext",self.GetValue()),self.trigger("onChange",self.GetValue())},this.Previous=function(){if(_inputValue.length&&(clearInterval(this.inputTimer),this.inputDone()),CSimpleSelect.prototype.Next.call(),void 0!==self.min){if(!(_value-self.interval>=self.min))return;_value-=self.interval}else _value-=self.interval;self.RefreshContent(),self.trigger("onPrevious",self.GetValue()),self.trigger("onChange",self.GetValue())},this.RefreshContent=function(){this.SetContent(self.GetValue()),self.value=self.GetValue(),self.DisableElement(self.leftArrow,!1),self.DisableElement(self.rightArrow,!1),void 0!==self.min&&_value-self.interval<self.min&&self.DisableElement(self.leftArrow,!0),void 0!==self.max&&_value+self.interval>self.max&&self.DisableElement(self.rightArrow,!0)},this.onInput=function(str){_inputValue.length||(_oldValue=_value,this.DisableElement(this.leftArrow,!0),this.DisableElement(this.rightArrow,!0)),_inputValue+=str,this.SetValue(_inputValue),clearInterval(this.inputTimer),this.inputTimer=window.setTimeout(function(){self.inputDone()},1e3)},this.inputClear=function(){_inputValue="",_oldValue=null,this.actionBack()},this.inputDone=function(){_inputValue="",_oldValue=null,_value=Math.floor(_value/this.interval)*this.interval,_value>this.max&&(_value=this.max),_value<this.min&&(_value=this.min),this.SetValue(_value),this.RefreshContent()},this.actionBack=function(){clearInterval(this.inputTimer),_inputValue.length>1?(_inputValue=_inputValue.slice(0,-1),this.SetValue(_inputValue),this.inputTimer=window.setTimeout(function(){self.inputDone()},2e3)):(_oldValue||0===_oldValue)&&this.SetValue(_oldValue)},this.EventHandler=function(event){if(eventPrepare(event,!0,"CSimpleSelect"),this.disabled!==!0)switch(event.stopped=!0,event.code){case KEYS.LEFT:this.Previous();break;case KEYS.RIGHT:this.Next();break;case KEYS.BACK:this.actionBack();break;case KEYS.NUM0:case KEYS.NUM1:case KEYS.NUM2:case KEYS.NUM3:case KEYS.NUM4:case KEYS.NUM5:case KEYS.NUM6:case KEYS.NUM7:case KEYS.NUM8:case KEYS.NUM9:this.parameters.noInput||this.onInput(event.code-KEYS.NUM0);break;default:event.stopped=!1}},this.IsChanged=function(){return _value!==_default},this.RefreshContent()}function checkEnvVars(){return!1}function CModalAuth(parent,title,lblUser,lblPass,btnExitTitle,btnExitClick,btnOKTitle,btnOKClick){var self=this,html=element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},lblUser),element("td",{className:"data"},this.user=element("input",{type:"text"}))]),element("tr",{},[element("td",{className:"name"},lblPass),element("td",{className:"data"},this.pass=element("input",{type:"text"}))])]);this.user.onkeydown=this.pass.onkeydown=function(event){if(eventPrepare(event,!1,"CModalAuth"))switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:self.FocusPrev(event);break;case KEYS.DOWN:self.FocusNext(event);break;case KEYS.OK:}},this.onShow=function(){setTimeout(function(){self.user.focus(),gSTB.ShowVirtualKeyboard()},5)},CModalAlert.call(this,parent,title,html,btnExitTitle,btnExitClick),this.focusList.push(this.user),this.focusList.push(this.pass),this.name="CModalAuth",this.bpanel.Add(KEYS.OK,"ok.png",btnOKTitle,function(){"function"==typeof btnOKClick&&btnOKClick.call(self,self.user.value,self.pass.value)&&self.Show(!1)})}function CModalMount(parent,link,type){CModalBox.call(this,parent),this.name="CModalMount";var self=this;this.type=new CSelectBox(this,{data:[{id:"smb",name:"SMB"},{id:"nfs",name:"NFS"}],parent:element("div"),events:{onChange:function(){"smb"===this.GetValue()?(self.row_user.className=self.row_pass.className="",self.focusList=[self.url,self.folder,self.local,this.handle,self.login,self.pass],self.login.disabled=!1,self.pass.disabled=!1):(self.row_user.className=self.row_pass.className="inactive",self.login.value=self.pass.value="",self.focusList=[self.url,self.folder,self.local,this.handle],self.login.disabled=!0,self.pass.disabled=!0)}}});var html=element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},_("Server address:")),element("td",{className:"data"},this.url=element("input",{type:"text"}))]),element("tr",{},[element("td",{className:"name"},_("Server folder:")),element("td",{className:"data"},this.folder=element("input",{type:"text"}))]),element("tr",{},[element("td",{className:"name"},_("Local folder:")),element("td",{className:"data"},this.local=element("input",{type:"text"}))]),element("tr",{},[element("td",{className:"name"},_("Connection type:")),element("td",{className:"data"},this.type.parentNode)]),this.row_user=element("tr",{},[element("td",{className:"name"},_("Login:")),element("td",{className:"data"},this.login=element("input",{type:"text"}))]),this.row_pass=element("tr",{},[element("td",{className:"name"},_("Password:")),element("td",{className:"data"},this.pass=element("input",{type:"text"}))])]);if(echo(link,"link"),void 0!==link||MediaBrowser.FileList.parentItem.type!==MEDIA_TYPE_SAMBA_SHARE&&MediaBrowser.FileList.Current().data.type!==MEDIA_TYPE_SAMBA_SHARE&&MediaBrowser.FileList.parentItem.type!==MEDIA_TYPE_SAMBA_SHARE&&MediaBrowser.FileList.Current().data.type!==MEDIA_TYPE_SAMBA_SHARE)void 0!==link&&link instanceof Object&&(self.url.value=link.url||"",self.folder.value=link.folder||"",self.local.value=link.local||"",self.login.value=link.login||"",self.pass.value=link.pass||"");else{var address=MediaBrowser.FileList.Current().data.address||MediaBrowser.FileList.parentItem.address,smbPath=address.split("/");self.url.value=smbPath[2]||"",self.folder.value=smbPath[3]||"",self.local.value=smbPath[3]||"",self.login.value=SMB_AUTH[address]?SMB_AUTH.login||"":"",self.pass.value=SMB_AUTH[address]?SMB_AUTH.path||"":""}void 0!==type&&(type===MEDIA_TYPE_SAMBA_SHARE&&(this.type.value="smb"),type===MEDIA_TYPE_NFS_SHARE&&(this.type.value="nfs")),this.type.trigger("onChange"),this.prepare=function(){if(self.url.value=self.url.value.trim(),self.folder.value=self.folder.value.trim(),self.local.value=self.local.value.trim(),self.login.value=self.login.value.trim(),self.pass.value=self.pass.value.trim(),self.folder.value&&("nfs"===self.type.GetValue()&&"/"!==self.folder.value.charAt(0)&&(self.folder.value="/"+self.folder.value),"smb"===self.type.GetValue()&&"/"===self.folder.value.charAt(0)&&(self.folder.value=self.folder.value.slice(1)),"/"===self.folder.value.charAt(self.folder.value.length-1)&&(self.folder.value=self.folder.value.slice(0,-1))),!self.local.value&&self.folder.value){var parts=self.folder.value.split("/");self.local.value=parts[parts.length-1]}},this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_(void 0!==link?"Save":"Connect"),function(){var addr;if(gSTB.HideVirtualKeyboard(),self.prepare(),self.url.value&&self.folder.value&&self.local.value){var data,exist,dupl=!1;void 0===link&&SMB_ARRAY.forEach(function(item){item.local===self.local.value&&(dupl=!0)}),void 0===link&&NFS_ARRAY.forEach(function(item){item.local===self.local.value&&(dupl=!0)}),dupl?new CModalHint(self,_("Local folder with this name already exists"),4e3):"smb"===self.type.GetValue()?(addr="//"+self.url.value+"/"+self.folder.value,MediaBrowser.UnmountSMB(),void 0!==link||MediaBrowser.MountSMB({address:addr,login:self.login.value,pass:self.pass.value})?(data={url:self.url.value,folder:self.folder.value,local:self.local.value,login:self.login.value||"guest",pass:self.pass.value},exist=!1,void 0===link&&SMB_ARRAY.forEach(function(item){var same=!0;if(!exist){for(var name in data)same=same&&data[name]===item[name];same&&(exist=!0)}}),exist?new CModalHint(self,_("Resource already connected"),4e3):(setTimeout(function(){if(link&&-1!==SMB_ARRAY.indexOf(link)?SMB_ARRAY[SMB_ARRAY.indexOf(link)]=data:SMB_ARRAY.push(data),echo(SMB_ARRAY,"SMB_ARRAY"),gSTB.SaveUserData("smb_data",JSON.stringify(SMB_ARRAY)),void 0===link)MediaBrowser.Reset(!1,!1),MediaBrowser.FileList.Open({markable:!1,readOnly:!0,url:SMB_PATH,address:addr,link:data,type:MEDIA_TYPE_SAMBA_SHARE,name:self.local.value});else{var current=MediaBrowser.FileList.Current().data;MediaBrowser.FileList.Refresh(!1),MediaBrowser.FileList.Reposition({type:current.type,url:current.url,name:self.local.value})}echo(SMB_ARRAY,"gSTB.SaveUserData")},5),self.Show(!1),new CModalHint(currCPage,_("Network folder successfully mounted"),2e3))):new CModalHint(self,_("Unable to connect to the resource<br>with the given parameters"),4e3)):(addr=self.url.value+":"+self.folder.value,MediaBrowser.UnmountNFS(),void 0!==link||MediaBrowser.MountNFS({address:addr})?(data={url:self.url.value,folder:self.folder.value,local:self.local.value},exist=!1,void 0===link&&NFS_ARRAY.forEach(function(item){var same=!0;if(!exist){for(var name in data)same=same&&data[name]===item[name];same&&(exist=!0)}}),exist?new CModalHint(self,_("Resource already connected"),4e3):(setTimeout(function(){if(link&&-1!==SMB_ARRAY.indexOf(link)?NFS_ARRAY[NFS_ARRAY.indexOf(link)]=data:NFS_ARRAY.push(data),gSTB.SaveUserData("nfs_data",JSON.stringify(NFS_ARRAY)),void 0===link)MediaBrowser.Reset(!1,!1),MediaBrowser.FileList.Open({path:NFS_PATH,url:addr,address:addr,folder:self.folder.value,type:MEDIA_TYPE_NFS_SHARE,
name:self.local.value});else{var current=MediaBrowser.FileList.Current().data;MediaBrowser.FileList.Refresh(!1),MediaBrowser.FileList.Reposition({type:current.type,url:current.url,name:self.local.value})}echo(NFS_ARRAY,"gSTB.SaveUserData")},5),self.Show(!1),new CModalHint(currCPage,_("Network folder successfully mounted"),2e3))):new CModalHint(self,_("Unable to connect to the resource<br>with the given parameters"),4e3))}else new CModalHint(self,_("Wrong connection parameters"),4e3)}),this.SetHeader(_(void 0!==link?"Edit network folder":"Connect network folder")),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){setTimeout(function(){self.url.focus(),void 0===link&&gSTB.ShowVirtualKeyboard()},100)},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if(this.focusList[this.focusPos]===self.type.handle&&self.type.EventHandler(event),event.stopped!==!0)switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:self.prepare(),self.FocusPrev(event,!1);break;case KEYS.DOWN:self.prepare(),self.FocusNext(event,void 0===link);break;default:self.bpanel.EventHandler(event)}},this.Init(),this.Show(!0)}function CModalUnmount(parent,share){var selected,i;CModalBox.call(this,parent),this.name="CModalMount";var self=this,shares=[];for(SMB_ARRAY.forEach(function(item){shares.push({type:"smb",id:item,name:item.local})}),NFS_ARRAY.forEach(function(item){shares.push({type:"nfs",id:item,name:item.local})}),i=0;i<shares.length;i++)shares[i].id===share&&(selected=i);this.local=new CSelectBox(this,{data:shares,selected:selected,style:"wide",events:{onChange:function(){var selected=this.GetSelected();"smb"===selected.type&&(self.hint.innerHTML="smb://"+selected.id.url+"/"+selected.id.folder),"nfs"===selected.type&&(self.hint.innerHTML="nfs://"+selected.id.url+selected.id.folder)}},parent:element("div")});var html=element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},_("Local folder:"))]),element("tr",{},[element("td",{className:"data"},this.local.parentNode)]),element("tr",{},[element("td",{className:"data"},this.hint=element("div",{className:"hint"}))])]);this.local.trigger("onChange"),this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Disconnect"),function(){var pos,selected=self.local.GetSelected();"smb"===selected.type?(MediaBrowser.UnmountSMB(),pos=SMB_ARRAY.indexOf(self.local.GetValue()),-1!==pos&&SMB_ARRAY.splice(pos,1),echo(SMB_ARRAY,"SMB_ARRAY saving"),gSTB.SaveUserData("smb_data",JSON.stringify(SMB_ARRAY))):"nfs"===selected.type&&(MediaBrowser.UnmountNFS(),pos=NFS_ARRAY.indexOf(self.local.GetValue()),-1!==pos&&NFS_ARRAY.splice(pos,1),echo(NFS_ARRAY,"NFS_ARRAY saving"),gSTB.SaveUserData("nfs_data",JSON.stringify(NFS_ARRAY))),MediaBrowser.Reset(!1,!1),self.Show(!1),new CModalHint(currCPage,_("Network folder successfully unmounted"),2e3)}),this.SetHeader(_("Disconnect network folder")),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){self.local.focus()},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if(eventPrepare(event,!0,"CModalAlert")){switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;default:self.bpanel.EventHandler(event)}this.local.EventHandler(event)}},this.Init(),this.Show(!0)}function CModalFormat(parent){CModalBox.call(this,parent),this.name="CModalFormat";var self=this,parts=[];if(this.type=new CSelectBox(this,{style:"format",data:[{id:"ext3",name:"EXT3"},{id:"ext2",name:"EXT2"},{id:"ntfs",name:"NTFS"}]}),HDD_INFO.length>0)for(var i=0;i<HDD_INFO.length;i++)HDD_INFO[i].partitionNum||parts.push({name:HDD_INFO[i].vendor+" "+HDD_INFO[i].model.replace(/\//,"")+" "+(""!==HDD_INFO[i].size?Math.floor(HDD_INFO[i].size/1073741824*100/100)+"GB":""),id:"allHDD|"+(""!==HDD_INFO[i].size?Math.floor(HDD_INFO[i].size/1073741824*100)/100:0)});this.part=new CSelectBox(this,{style:"format",data:parts});var html=element("table",{className:"main maxw"},[this.$file_system=element("tr",{},[element("td",{className:"name"},_("File system:")),element("td",{className:"data"},this.type.parentNode)]),this.$partition=element("tr",{},[element("td",{className:"name"},_("Partition:")),element("td",{className:"data"},this.part.parentNode)]),this.$progress_bar_row=element("tr",{},[element("td",{colSpan:2},element("div",{},this.$progress_bar=element("div",{className:"progressbar formatting"},element("div",{className:"progressbar_bg maxh"},[this.line=element("div",{className:"progressbar_line maxh"}),this.text=element("div",{className:"progressbar_digit"})]))))])]);self.focusList=[self.type,self.part],this.finish=function(){this.line.style.width=this.text.innerHTML="",document.addEventListener("keydown",mainEventListener),this.type.disabled=this.part.disabled=!1,this.type.focus(),this.bpanel.Activate(!0)},this.check=function(){function showElements(){self.$partition.style.display=self.$file_system.style.display="table-cell",self.$exit_key.style.display=self.$ok_key.style.display="block"}var read_status={};try{eval("read_status="+gSTB.RDir("tempfile read hdd_progress"))}catch(e){echo(e,"tempfile read hdd_progress")}if(echo(read_status,"read_status"),"undefined"===read_status.state)return this.line.style.width=this.text.innerHTML="0%",setTimeout(function(){self.check()},5e3);if("complete"===read_status.state)return this.finish(),self.Show(!1),void setTimeout(function(){new CModalAlert(parent,_("Formatting"),_("Formatting completed"),_("Close"),function(){echo("exit")})},0);if("error"!==read_status.state)return this.line.style.width=this.text.innerHTML=read_status.percent+"%",setTimeout(function(){self.check()},500);switch(this.finish(),read_status.stage){case"16":showElements(),new CModalAlert(this,_("Formatting error"),_('Formatting impossible.<br>Make sure the device is not used in:<br>"Download manager", "Record manager"<br>or content playback.'),_("Close"),function(){echo("exit")});break;case"2":case"22":showElements(),new CModalAlert(this,_("Formatting error"),_("Formatting impossible"),_("Close"),function(){echo("exit")});break;default:showElements(),new CModalAlert(this,_("Formatting"),_("Formatting error"),_("Close"),function(){echo("exit")})}},this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.$exit_key=this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.$ok_key=this.bpanel.Add(KEYS.OK,"ok.png",_("Start formatting"),function(){var part=self.part.GetValue().split("|");return echo(part),echo(self.part.GetValue()),part[0]?"fat32"===self.type.GetValue()&&parseInt(part[1],10)>320?new CModalAlert(self,_("Formatting error"),_("Selected file system supports disks up to 320GB"),_("Close"),function(){echo("exit")}):void new CModalConfirm(self,_("Formatting"),_('<b style="color:red">Warning: </b>after formatting all data in the<br> selected section will be deleted.'),_("Cancel"),function(){},_("Start formatting"),function(){MediaBrowser.FileList.mode===MEDIA_TYPE_STORAGE_SATA&&MediaBrowser.Reset(),document.removeEventListener("keydown",mainEventListener),self.type.disabled=self.part.disabled=!0,self.bpanel.Activate(!1);var cmd="hdd_format "+self.type.GetValue();echo(cmd,"formatting command"),gSTB.RDir(cmd),self.check(),self.$partition.style.display=self.$file_system.style.display=self.$exit_key.style.display=self.$ok_key.style.display="none"}):new CModalAlert(self,_("Formatting error"),_("Formatting impossible"),_("Close"),function(){echo("exit")})}),this.SetHeader(_("Formatting")),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){self.type.focus()},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if("function"==typeof self.focusList[self.focusPos].EventHandler&&self.focusList[self.focusPos].EventHandler(event),event.stopped!==!0)switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;default:self.bpanel.EventHandler(event)}},this.Init(),this.Show(!0),this.handleInner.className="cmodal-main format"}function CModalPlayListOpen(parent){CModalBox.call(this,parent);var $selectBox,isFileInUTF8=gSTB.IsFileUTF8Encoded(this.parent.FileList.Current().data.url),encs=["cp1250","cp1251","cp1252","cp1253","cp1254","cp1254","cp1255","cp1256","cp1257","cp1258","iso8859-1","iso8859-2","iso8859-3","iso8859-4","iso8859-5","iso8859-6","iso8859-7","iso8859-8","iso8859-9","iso8859-10","iso8859-11","iso8859-12","iso8859-13","iso8859-14","iso8859-15","iso8859-16"];this.content.className=this.content.className+" cmodal-pls",this.name="CModalPlayListOpen";var self=this,func=function(code){setTimeout(function(){echo(self.list.value);var data=self.parent.FileList.Current().data;data.code=code,data.encoding=isFileInUTF8?null:self.list.value,self.parent.FileList.Open(data)},5),self.Show(!1)};this.list=new CSelectBox(this,{data:encs,style:"subtitles"}),this.onShow=function(){isFileInUTF8?$selectBox.style.display="none":setTimeout(function(){self.list.focus()},5)},this.bpanelMain=new CButtonPanel,this.bpanelMain.Init(CMODAL_IMG_PATH),this.bpanelMain.Add(KEYS.F1,"f1.png",_("See playlist content"),func),this.bpanelMain.Add(KEYS.F2,"f2.png",_("Start playing all records"),func),this.bpanelMain.Add(KEYS.F3,"f3.png",_("Add all records to IPTV channels"),func),this.bpanelBottom=new CButtonPanel,this.bpanelBottom.Init(CMODAL_IMG_PATH),this.bpanelBottom.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)});var $html=element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},this.bpanelMain.handle)]),$selectBox=element("tr",{},[element("td",{className:"data"},[_("File encoding:"),this.list.parentNode])])]);this.SetHeader(_("Open playlist")),this.SetContent([$html]),this.SetFooter(this.bpanelBottom.handle),this.onHide=function(){elclear(self.bpanelMain.handle),elclear(self.bpanelBottom.handle),delete self.bpanelMain,delete self.bpanelBottom,self.Free()},this.EventHandler=function(e){self.bpanelMain&&self.bpanelMain.EventHandler(e),self.bpanelBottom&&self.bpanelBottom.EventHandler(e),!isFileInUTF8&&self.list&&self.list.EventHandler(e)},this.Init(),this.Show(!0)}function CModalSubtitleOpen(parent,options){var self=this,encs=["cp1250","cp1251","cp1252","cp1253","cp1254","cp1254","cp1255","cp1256","cp1257","cp1258","iso8859-1","iso8859-2","iso8859-3","iso8859-4","iso8859-5","iso8859-6","iso8859-7","iso8859-8","iso8859-9","iso8859-10","iso8859-11","iso8859-12","iso8859-13","iso8859-14","iso8859-15","iso8859-16"];this.list=new CSelectBox(this,{data:encs,style:"subtitles"});var html=element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},_("File:")),element("td",{className:"data"},options.data.name||"")]),element("tr",{},[element("td",{className:"name"},_("Encoding:")),element("td",{className:"data"},this.list.parentNode)])]);this.onShow=function(){setTimeout(function(){self.list.focus()},5)},CModalAlert.call(this,parent,_("Accessing subtitle file"),html,_("Cancel"),function(){self.Show(!1)}),this.EventHandler=function(event){eventPrepare(event,!0,this.name)&&(self.list.EventHandler(event),self.bpanel.EventHandler(event))},this.name="CModalSubtitleOpen",this.bpanel.Add(KEYS.OK,"ok.png",_("Connection"),function(){self.Show(!1),"function"==typeof options.onadd&&options.onadd(options,self.list.value)})}function CModalCreateGroup(parent,label,data,toDelete,newGroup){CModalBox.call(this,parent),data||(data=[]),toDelete||(toDelete=[]),this.content.className=this.content.className+" cmodal-pls",this.name="CModalCreateGroup";var self=this,group=[],done=!1,func=function(code){switch(code){case KEYS.F1:break;case KEYS.F4:toDelete=[]}""===self.newLocal.value?self.local.GetValue()!==!1&&(done=self.parent.TVList.createGroup(self.local.GetValue(),data,toDelete)):done=self.parent.TVList.createGroup(self.newLocal.value,data,toDelete),done&&self.Show(!1)},domArr=[];newGroup?(domArr.push(element("tr",{},[element("td",{className:"name"},_("Group:")),element("td",{className:"data"},this.newLocal=element("input",{type:"text",className:"wide"}))])),this.focusList.push(this.newLocal)):(domArr.push([element("tr",{},[element("td",{className:"name"},_("Group:")),element("td",{className:"data"},this.localDiv=element("div"))]),element("tr",{},[element("td"),element("td",{className:"data"},_("or create and use a new group:"))]),element("tr",{},[element("td"),element("td",{className:"data"},this.newLocal=element("input",{type:"text",className:"wide"}))])]),group=parent.TVList.parentItem.data.slice(parent.TVList.handle.children[0].data.type===MEDIA_TYPE_BACK?1:0,parent.TVList.channelStart+1),group.length?this.local=new CSelectBox(this,{idField:"name",nameField:"name",content:this.localDiv,data:group,style:"cselect-box-wide"}):this.local=new CSelectBox(this,{content:this.localDiv,data:[{id:!1,name:parent.TVList.parentItem.name?parent.TVList.parentItem.name:_("IPTV channels")}],style:"cselect-box-wide"}),this.focusList.push(this.local),this.focusList.push(this.newLocal));var html=element("table",{className:"main maxw"},domArr);this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),newGroup?this.bpanel.Add(KEYS.OK,"ok.png",_("Save"),function(){""!==self.newLocal.value&&(self.Show(!1),self.parent.TVList.createGroup(self.newLocal.value,data,toDelete))}):(this.bpanel.Add(KEYS.F1,"f1.png",_("Move"),func),this.bpanel.Add(KEYS.F4,"f4.png",_("Copy"),func)),this.SetHeader(label),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){newGroup?self.newLocal.focus():self.local.focus()},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if(eventPrepare(event,!0,"CModalAlert"))switch(newGroup||document.activeElement!==this.local.handle||this.local.EventHandler(event),event.code){case KEYS.UP:self.FocusPrev(event);break;case KEYS.DOWN:self.FocusNext(event);break;case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;default:self.bpanel.EventHandler(event)}},this.Init(),this.Show(!0)}function CModalAddRecord(parent,label){CModalBox.call(this,parent),this.name="CModalIptvAddRecord";var self=this,autoCorrection=!0,time=new Date,sec=time.getSeconds(),min=time.getMinutes(),hour=time.getHours(),day=time.getDate(),month=time.getMonth()+1,year=time.getFullYear();time=new Date(time.getTime()+36e5);var min1=time.getMinutes(),hour1=time.getHours(),day1=time.getDate(),month1=time.getMonth()+1,year1=time.getFullYear();sec=sec>9?sec:"0"+sec,min=10>min?"0"+min:min,hour=10>hour?"0"+hour:hour,day=10>day?"0"+day:day,month=10>month?"0"+month:month,min1=10>min1?"0"+min1:min1,hour1=10>hour1?"0"+hour1:hour1,day1=10>day1?"0"+day1:day1,month1=10>month1?"0"+month1:month1,this.parseTime=function(){var tt=/^([0-9]+)$/;return echo("parseTime : "+this.value+" | "+tt.test(this.value)),tt.test(this.value)?(this.value>this.maxValue&&(this.value=this.maxValue),this.value.length===this.maxLength&&setTimeout(function(){self.FocusRight()},50)):this.value.length>0&&(this.value=this.value.substring(0,this.value.length-2)),!1},this.checkTime=function(){self.startTimeYear.value=self.startTimeYear.value||(new Date).getFullYear(),self.startTimeMonth.value=self.startTimeMonth.value||"01",self.startTimeDay.value=self.startTimeDay.value||"00",self.startTimeHour.value=self.startTimeHour.value||"00",self.startTimeMin.value=self.startTimeMin.value||"00",self.endTimeYear.value=self.endTimeYear.value||(new Date).getFullYear(),self.endTimeMonth.value=self.endTimeMonth.value||"01",self.endTimeDay.value=self.endTimeDay.value||"00",self.endTimeHour.value=self.endTimeHour.value||"00",self.endTimeMin.value=self.endTimeMin.value||"00";var startTime=new Date(self.startTimeYear.value,self.startTimeMonth.value-1,self.startTimeDay.value,self.startTimeHour.value,self.startTimeMin.value),endTime=new Date(self.endTimeYear.value,self.endTimeMonth.value-1,self.endTimeDay.value,self.endTimeHour.value,self.endTimeMin.value),delta=(endTime.getTime()-startTime.getTime())/1e3;if(delta>0){var h=Math.floor(delta/3600),m=Math.floor((delta-3600*h)/60);h>24&&(h=23,m=59,self.checkEndTime()),self.timeHour.value=h>9?h:"0"+h,self.timeMin.value=m>9?m:"0"+m}else self.timeHour.value="00",self.timeMin.value="00";return autoCorrection&&(self.itemName.value=(self.startTimeHour.value<10&&"00"!==self.startTimeHour.value?"0"+Number(self.startTimeHour.value):self.startTimeHour.value)+":"+(self.startTimeMin.value<10&&"00"!==self.startTimeMin.value?"0"+Number(self.startTimeMin.value):self.startTimeMin.value)+":00"),!1},this.checkEndTime=function(){var hour=self.startTimeHour.value,min=self.startTimeMin.value,day=self.startTimeDay.value;self.timeHour.value=self.timeHour.value||"00",self.timeMin.value=self.timeMin.value||"00";var startTime=new Date(self.startTimeYear.value,self.startTimeMonth.value-1,day,hour,min),endTime=new Date(startTime.getTime()+1e3*(3600*self.timeHour.value+60*self.timeMin.value));min=endTime.getMinutes(),min=10>min?"0"+min:min,hour=endTime.getHours(),hour=10>hour?"0"+hour:hour,day=endTime.getDate(),day=10>day?"0"+day:day,month=endTime.getMonth()+1,month=10>month?"0"+month:month,self.endTimeHour.value=hour,self.endTimeMin.value=min,self.endTimeDay.value=day,self.endTimeMonth.value=month,self.endTimeYear.value=endTime.getFullYear()},function(obj){obj.channels=[],IPTVChannels.TVList.parentItem.data.forEach(function(item){item.data||obj.channels.push(item)}),obj.channels.forEach(function(item){item.label=item.name})}(this),this.refreshStorageInfo=function(){this.storage=[],getStorageInfo();var usb,i;for(i=0;i<STORAGE_INFO.length;i++)usb=STORAGE_INFO[i],0===usb.isReadOnly&&(usb.freeSizeGb=Math.floor(usb.freeSize/1024/1024/1024*100)/100,usb.sizeGb=Math.floor(usb.size/1024/1024/1024*100)/100,usb.id=i,this.storage.push(usb))},this.refreshStorageInfo(),echo(this.storage,"this.storage"),this.device=new CSelectBox(this,{data:this.storage.length>0?this.storage:[{id:-1,label:_("No storage device")}],nameField:"label",style:"cselect-box-wide",events:{onChange:function(){self.$freeSize.innerHTML=this.GetSelected().freeSizeGb||"0",self.$totlaSize.innerHTML=this.GetSelected().sizeGb||"0"}}}),this.$channels=new CSelectBox(this,{data:this.channels.length>0?this.channels:[{id:-1,label:_("No channels")}],nameField:"label",style:"cselect-box-wide"});for(var i=0;i<this.channels.length;i++)IPTVChannels.TVList.activeItem.data.index&&IPTVChannels.TVList.parentItem.data[IPTVChannels.TVList.activeItem.data.index].type===MEDIA_TYPE_STREAM&&this.channels[i].url===IPTVChannels.TVList.parentItem.data[IPTVChannels.TVList.activeItem.data.index].url&&this.$channels.SetIndex(i);var html=element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},_("Start recording:")),element("td",{className:"data"},[element("div",{className:"box"},[this.startTimeHour=element("input",{className:"time",type:"text",value:hour,maxLength:2,minValue:0,maxValue:23,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},":"),this.startTimeMin=element("input",{className:"time",type:"text",value:min,maxLength:2,minValue:0,maxValue:59,oninput:this.parseTime,onchange:this.checkTime})]),element("div",{className:"box"},[this.startTimeDay=element("input",{className:"time",type:"text",value:day,maxLength:2,minValue:1,maxValue:31,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},"."),this.startTimeMonth=element("input",{className:"time",type:"text",value:month,maxLength:2,minValue:1,maxValue:12,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},"."),this.startTimeYear=element("input",{className:"data_time",type:"text",value:year,maxLength:4,minValue:1,maxValue:9999,oninput:this.parseTime,onchange:this.checkTime})])])]),element("tr",{},[element("td",{className:"name"},_("End recording:")),element("td",{className:"data"},[element("div",{className:"box"},[this.endTimeHour=element("input",{className:"time",type:"text",value:hour1,maxLength:2,minValue:0,maxValue:23,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},":"),this.endTimeMin=element("input",{className:"time",type:"text",value:min1,maxLength:2,minValue:0,maxValue:59,oninput:this.parseTime,onchange:this.checkTime})]),element("div",{className:"box"},[this.endTimeDay=element("input",{className:"time",type:"text",value:day1,maxLength:2,minValue:1,maxValue:31,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},"."),this.endTimeMonth=element("input",{className:"time",type:"text",value:month1,maxLength:2,minValue:1,maxValue:12,oninput:this.parseTime,onchange:this.checkTime}),element("div",{className:"colon"},"."),this.endTimeYear=element("input",{className:"data_time",type:"text",value:year1,maxLength:4,minValue:1,maxValue:9999,oninput:this.parseTime,onchange:this.checkTime})])])]),element("tr",{},[element("td",{className:"name"},_("Record length:")),element("td",{className:"data"},[element("div",{className:"box"},[this.timeHour=element("input",{className:"time",type:"text",value:"01",maxLength:2,minValue:0,maxValue:23,oninput:this.parseTime,onchange:this.checkEndTime}),element("div",{className:"colon"},":"),this.timeMin=element("input",{className:"time",type:"text",value:"00",maxLength:2,minValue:0,maxValue:59,oninput:this.parseTime,onchange:this.checkEndTime})])])]),element("tr",{},[element("td",{className:"name"},_("Channel:")),element("td",{className:"data"},this.$channels.parentNode)]),element("tr",{},[element("td",{className:"name"},_("Record name:")),element("td",{className:"data"},[this.itemName=element("input",{className:"wide",type:"text",value:hour+":"+min+":"+sec,change:!1,onchange:function(){},oninput:function(){this.change=!0,autoCorrection=!1}})])]),element("tr",{},[element("td",{className:"name"},_("Record in:")),element("td",{className:"data"},this.device.parentNode)]),element("tr",{},[element("td"),element("td",{className:"data"},[_("Free space:")+" ",this.$freeSize=element("span",{className:"size"},this.device.GetSelected().freeSizeGb||"0")," "+_("GB")+"   "+_("of")+" ",this.$totlaSize=element("span",{className:"size"},this.device.GetSelected().sizeGb||"0")," "+_("GB")])])]);this.focusList=[[this.startTimeHour,this.startTimeMin,this.startTimeDay,this.startTimeMonth,this.startTimeYear],[this.endTimeHour,this.endTimeMin,this.endTimeDay,this.endTimeMonth,this.endTimeYear],[this.timeHour,this.timeMin],[this.$channels],[this.itemName],[this.device]],this.startTimeHour.oninput=this.parseTime,this.focusPos=0,this.subFocusPos=0,this.FocusNext=function(event,manageVK){if(this.focusList.length>0){++this.focusPos>=this.focusList.length&&(this.focusPos=0);var el=this.focusList[this.focusPos][0];manageVK!==!1&&gSTB.HideVirtualKeyboard(),el.focus(),this.subFocusPos=0,event&&"SELECT"!==el.nodeName&&(event.preventDefault(),el.select&&el.select())}},this.FocusPrev=function(event,manageVK){if(this.focusList.length>0){--this.focusPos<0&&(this.focusPos=this.focusList.length-1);var el=this.focusList[this.focusPos][0];manageVK!==!1&&gSTB.HideVirtualKeyboard(),el.focus(),this.subFocusPos=0,"SELECT"!==el.nodeName&&(el.select&&el.select(),event.preventDefault())}},this.FocusRight=function(event){if(this.focusList[this.focusPos].length>1){++this.subFocusPos>=this.focusList[this.focusPos].length&&(this.subFocusPos=0);var el=this.focusList[this.focusPos][this.subFocusPos];el.focus(),"SELECT"!==el.nodeName&&(el.select&&el.select(),event&&event.preventDefault())}},this.FocusLeft=function(event){if(this.focusList[this.focusPos].length>1){--this.subFocusPos<0&&(this.subFocusPos=this.focusList[this.focusPos].length-1);var el=this.focusList[this.focusPos][this.subFocusPos];el.focus(),"SELECT"!==el.nodeName&&(el.select&&el.select(),event&&event.preventDefault())}},this.startPVR=function(){if(self.$channels.GetSelected().id<0)return void new CModalHint(currCPage,_("Channel list is empty"),3e3);var arr,inProgress=0;try{arr=JSON.parse(pvrManager.GetAllTasks())}catch(e){arr=[]}if(arr.forEach(function(item){2===item.state&&inProgress++}),inProgress>=5)return void new CModalHint(currCPage,_("Error. Too many active records."),3e3);if(0===self.device.GetSelected().freeSize)return void new CModalHint(currCPage,_("Not enough disk space"),3e3);var url=self.$channels.GetSelected().url.replace(/@/gim,""),devPath=self.device.GetSelected().mountPath,chanName=self.$channels.GetSelected().name.replace(/\/|\*|:|\\|\?|\||'|&|"|\^|%|<|>/gim,"");echo(url,"SELECTED CHANNEL IS"),gSTB.ExecAction('make_dir "'+devPath+'/records"'),gSTB.ExecAction('make_dir "'+devPath+"/records/"+chanName+'"'),gSTB.ExecAction('make_dir "'+devPath+"/records/"+chanName+"/"+this.startTimeYear.value+"-"+this.startTimeMonth.value+"-"+this.startTimeDay.value+'"');var name=devPath+"/records/"+chanName+"/"+this.startTimeYear.value+"-"+this.startTimeMonth.value+"-"+this.startTimeDay.value+"/"+this.itemName.value.split(":").join("-").replace(/\/|\*|:|\\|\?|\||'|&|"|\^|%|<|>/gim,"")+".ts",hour=self.startTimeHour.value,min=self.startTimeMin.value,day=self.startTimeDay.value,mon=self.startTimeMonth.value-1,year=self.startTimeYear.value,startTime=new Date(year,mon,day,hour,min),hourE=self.endTimeHour.value,minE=self.endTimeMin.value,dayE=self.endTimeDay.value,monE=self.endTimeMonth.value-1,yearE=self.endTimeYear.value,endTime=new Date(yearE,monE,dayE,hourE,minE),done=pvrManager.CreateTask(url,name,startTime.getTime()/1e3,endTime.getTime()/1e3);if(echo("DONE:"+done),0>done){var text;switch(done){case"-2":text=_("Not enough disk space");break;case"-3":text=_("Incorrect time");break;case"-5":text=_("Wrong name or path");break;case"-6":text=_("Duplicated file");break;case"-7":text=_("Wrong URL");break;case"-9":text=_("Too many active records processed");break;case"-11":text=_("Not enough disk space");break;default:text=_("Error...")}new CModalHint(currCPage,text,3e3)}else parent===IPTVChannels&&IPTVChannels.pvr.start(),self.Show(!1)},this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Start recording"),function(){self.startPVR()}),this.SetHeader(label),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){self.focusList[self.focusPos][0].focus(),self.focusList[self.focusPos][0].select()},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.onMountAction=function(){echo("IPTV-modals->onMountAction"),this.refreshStorageInfo(),this.device.SetData(this.storage.length>0?this.storage:[{id:-1,label:_("No storage device")}]),this.$freeSize.innerHTML=currCPage.device.GetSelected().freeSizeGb||"0",this.$totlaSize.innerHTML=currCPage.device.GetSelected().sizeGb||"0"},this.EventHandler=function(event){if(eventPrepare(event,!0,"CModalAlert")&&(document.activeElement.component&&document.activeElement.component.constructor===CSelectBox&&document.activeElement.component.EventHandler(event),event.stopped!==!0))switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;case KEYS.LEFT:self.FocusLeft(event);break;case KEYS.RIGHT:self.FocusRight(event);break;case KEYS.PAGE_UP:document.activeElement.value>=document.activeElement.minValue&&document.activeElement.value<document.activeElement.maxValue&&(document.activeElement.value++,document.activeElement.onchange(),document.activeElement.value<10&&(document.activeElement.value="0"+document.activeElement.value));break;case KEYS.PAGE_DOWN:document.activeElement.value>document.activeElement.minValue&&document.activeElement.value<=document.activeElement.maxValue&&(document.activeElement.value--,document.activeElement.onchange(),document.activeElement.value<10&&(document.activeElement.value="0"+document.activeElement.value));break;case KEYS.VOLUME_DOWN:case KEYS.VOLUME_UP:event.preventDefault();break;default:self.bpanel.EventHandler(event)}},this.Init(),this.Show(!0)}function CModalChannelEdit(parent,item,data){CModalBox.call(this,parent);var self=this;this.name="CModalChannelEdit";var html=null;html=item.data.type===MEDIA_TYPE_GROUP?element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},_("Name :")),element("td",{className:"data"},this.chName=element("input",{type:"text",value:data.name}))])]):element("table",{className:"main maxw"},[element("tr",{},[element("td",{className:"name"},_("Name :")),element("td",{className:"data"},this.chName=element("input",{type:"text",value:data.name}))]),element("tr",{},[element("td",{className:"name"},_("URL :")),element("td",{className:"data"},this.chURL=element("input",{type:"text",value:(data.sol&&""!==data.sol?data.sol+" ":"")+data.url}))])]),this.focusList=[this.chName,this.chURL],this.focusPos=0,this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Save"),function(){var arr=[];if(data.name=self.chName.value,item.data.type===MEDIA_TYPE_STREAM){if(!(validateUrl(self.chURL.value,!0)||(arr=self.chURL.value.trim().split(" "),arr.length>1&&(validateUrl(arr[0]+" "+arr[1],!0)||validateUrl(arr[0])))))return void new CModalHint(self,_("Wrong field data"),4e3);data.url=self.chURL.value,data.sol&&(data.sol=""),item.data.url=data.url,IPTVChannels.domURL.innerHTML=data.url,data.changed=!0;var tempList=[JSON.parse(JSON.stringify(IPTVChannels.TVList.parentItem.data[item.data.index]))];tempList=IPTVChannels.checkTS_data(tempList,!0),data=tempList.a[0],item.children[2].className=data.tsOn?"timeshift tsOn":"timeshift",IPTVChannels.TVList.timer.OnFocusPlay=setTimeout(function(){MediaPlayer.preparePlayer(data,IPTVChannels,!0,!1,!0)},100)}item.data.name=data.name,item.children[1].innerHTML=data.name,IPTVChannels.needSave=!0,IPTVChannels.domInfoTitle.innerHTML=data.name,self.Show(!1)}),this.SetHeader(_("Edit")),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){self.focusList[self.focusPos].focus()},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if(eventPrepare(event,!0,"CModalChannelEdit"))switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;case KEYS.LEFT:case KEYS.RIGHT:break;default:self.bpanel.EventHandler(event)}},this.Init(),this.Show(!0)}function CModalChannelsAdd(parent,IsItPlaylist){CModalBox.call(this,parent);var self=this;this.name="CModalChannelsAdd",this.focusList=[];var $html=element("table",{className:"main maxw"}),playListHint="",encs=["utf-8","cp1250","cp1251","cp1252","cp1253","cp1254","cp1254","cp1255","cp1256","cp1257","cp1258","iso8859-1","iso8859-2","iso8859-3","iso8859-4","iso8859-5","iso8859-6","iso8859-7","iso8859-8","iso8859-9","iso8859-10","iso8859-11","iso8859-12","iso8859-13","iso8859-14","iso8859-15","iso8859-16"];if(IsItPlaylist){try{playListHint=JSON.parse(gSTB.GetEnv(JSON.stringify({varList:["playlist_url"]}))).result.playlist_url}catch(e){echo("Something wrong with last used playlist URL -> "+e),playListHint=""}self.list=new CSelectBox(this,{data:encs,style:"subtitles"}),elchild($html,element("tr",{},[element("td",{className:"name"},_("File encoding:")),element("td",{
className:"data"},self.list.parentNode)])),this.focusList.push(self.list)}else elchild($html,element("tr",{},[element("td",{className:"name"},_("Name :")),element("td",{className:"data"},self.chName=element("input",{type:"text",value:"",className:"wide"}))])),this.focusList.push(self.chName);elchild($html,element("tr",{},[element("td",{className:"name"},_("URL :")),element("td",{className:"data"},self.chURL=element("input",{type:"text",value:playListHint,className:"wide"}))])),this.focusList.push(this.chURL),this.focusPos=0,this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Save"),function(){var xmlhttp,income,extension,arr=self.chURL.value.trim().split(" ");if(validateUrl(self.chURL.value,!0)||arr.length>1&&(validateUrl(arr[0]+" "+arr[1],!0)||validateUrl(arr[0])))if(IsItPlaylist)xmlhttp=new XMLHttpRequest,xmlhttp.overrideMimeType("text/html; charset="+self.list.value),xmlhttp.open("GET",self.chURL.value,!1),xmlhttp.send(null),echo(xmlhttp.responseText,"response from list"),income=xmlhttp.responseText,extension=self.chURL.value.substring(self.chURL.value.length-3,self.chURL.value.length),income=MediaBrowser.ParsePlaylist(extension,income),IPTVChannels.TVList.addChannelsToList(IPTVChannels.TVList.parentItem.data,income,!0),IPTVChannels.needSave=!0,gSTB.SetEnv(JSON.stringify({playlist_url:self.chURL.value})),self.Show(!1);else{var in_object=[{name:self.chName.value,url:self.chURL.value,type:MEDIA_TYPE_STREAM}];IPTVChannels.TVList.addChannelsToList(IPTVChannels.TVList.parentItem.data,in_object,!1),IPTVChannels.TVList.Focused(IPTVChannels.TVList.handle.children[IPTVChannels.TVList.handle.children.length-1],!0),IPTVChannels.needSave=!0,self.Show(!1)}else new CModalHint(self,_("Wrong field data"),4e3)});var header=_(IsItPlaylist?"Add IPTV list":"Add IPTV channel");this.SetHeader(header),this.SetContent($html),this.SetFooter(this.bpanel.handle),this.onShow=function(){self.focusList[self.focusPos].focus()},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if(eventPrepare(event,!0,"CModalAlert")&&("function"==typeof this.focusList[this.focusPos].EventHandler&&this.focusList[this.focusPos].EventHandler(event),event.stopped!==!0))switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;case KEYS.LEFT:case KEYS.RIGHT:break;default:self.bpanel.EventHandler(event)}},this.Init(),this.Show(!0)}function CModalImportTVChannels(parent){CModalBox.call(this,parent),this.name="CModalImportTVChannels";var self=this;this.step1=new CSelectBox(this,{data:[{id:"",name:_("Select country...")}],parent:element("div"),events:{onChange:function(){this.GetValue()&&self.step2.startAction(this.GetValue()),self.step3.GetValue()!==_("Select operator...")&&self.step3.SetData([{id:"",name:_("Select operator...")}]),self.step2.GetValue()!==_("Select city...")&&self.step2.SetData([{id:"",name:_("Select city...")}])}}}),this.step2=new CSelectBox(this,{data:[{id:"",name:_("Select city...")}],parent:element("div"),events:{onChange:function(){this.GetValue()&&self.step3.startAction(self.step2.GetValue())}}}),this.step3=new CSelectBox(this,{data:[{id:"",name:_("Select operator...")}],parent:element("div")});var html=element("table",{className:"main maxw CModalImportTVChannels"},[element("tr",{},[element("td",{className:"name"},_("Country:")),element("td",{className:"data"},this.step1.parentNode)]),element("tr",{},[element("td",{className:"name"},_("City:")),element("td",{className:"data"},this.step2.parentNode)]),element("tr",{},[element("td",{className:"name"},_("Operator:")),element("td",{className:"data"},this.step3.parentNode)])]);self.focusList=[self.step1,self.step2,self.step3],ajax("GET",configuration.url.operatorsTVList+"country/",function(countries){countries.results.unshift({id:"",name:_("Select country...")}),self.step1.SetData(countries.results)},{},"json"),this.step2.startAction=function(country_id){ajax("GET",configuration.url.operatorsTVList+"country_cities/"+country_id,function(cities){cities.results.unshift({id:"",name:_("Select city...")}),self.step2.SetData(cities.results)},{},"json")},this.step3.startAction=function(city_id){ajax("GET",configuration.url.operatorsTVList+"city_isp/"+city_id,function(operators){operators.results.unshift({id:"",name:_("Select operator...")}),self.step3.SetData(operators.results)},{},"json")},this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Save"),function(){if(self.step3.GetValue())try{var value=self.step3.GetSelected().playlist;ajax("GET",value,function(income){self.Show(!1);var extencion=value.substring(value.length-3,value.length);income=MediaBrowser.ParsePlaylist(extencion,income),IPTVChannels.TVList.addChannelsToList(IPTVChannels.TVList.parentItem.data,income,!0)},{},"text")}catch(err){new CModalHint(self,_("Bad playlist file"),4e3)}else new CModalHint(self,_("Wrong field data"),4e3);return!1}),this.SetHeader(_("Loading operator playlist")),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){setTimeout(function(){self.step1.focus()},100)},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if("function"==typeof this.focusList[this.focusPos].EventHandler&&this.focusList[this.focusPos].EventHandler(event),event.stopped!==!0)switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;case KEYS.RIGHT:case KEYS.LEFT:event.preventDefault();break;default:self.bpanel.EventHandler(event)}},this.Init(),this.SetContent(html),this.Show(!0)}function CModalScanDVB(parent){var html,data,self=this;CModalBox.call(this,parent),this.name="CModalScanDVB";try{var text=dvbManager.GetCurrentScanTypes();echo(text,"GetCurrentScanTypes"),data=JSON.parse(text)}catch(e){echo(e,"GetCurrentScanTypes parse error")}echo("DVBChannels.DVBType : "+DVBChannels.DVBType),echo(data,"data"),this.step1=new CSelectBox(this,{data:data,idField:"type",nameField:"name",parent:element("div"),events:{onChange:function(){}},selected:DVBChannels.DVBType}),1===DVBChannels.DVBType?(this.step2=new CIntervalBox(SettingsPage,{parent:element("div"),max:7200,min:870,interval:1,value:6875,style:"elements"}),this.step3=new CSelectBox(this,{data:[{value:0,name:"Auto"},{value:1,name:"16 QAM"},{value:2,name:"32 QAM"},{value:3,name:"64 QAM"},{value:4,name:"128 QAM"},{value:5,name:"256 QAM"}],idField:"value",nameField:"name",parent:element("div"),events:{onChange:function(){}},selected:0}),html=element("table",{className:"main maxw CModalScanDVB"},[element("tr",{},[element("td",{className:"name"},_("DVB type:")),element("td",{className:"data"},this.step1.parentNode)]),element("tr",{},[element("td",{className:"name"},_("Symbol rate:")),element("td",{className:"data"},this.step2.parentNode)]),element("tr",{},[element("td",{className:"name"},_("Modulation:")),element("td",{className:"data"},this.step3.parentNode)])]),this.focusList=[this.step1,this.step2,this.step3]):(html=element("table",{className:"main maxw CModalScanDVB"},[element("tr",{},[element("td",{className:"name"},_("DVB type:")),element("td",{className:"data"},this.step1.parentNode)])]),this.focusList=[this.step1]),this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Scan"),function(){return self.step1.GetValue()?(self.Show(!1),DVBChannels.DVBType=self.step1.GetValue(),1===DVBChannels.DVBType&&(echo({type:self.step1.GetValue(),symRate:self.step2.GetValue(),modulation:self.step3.GetValue(),scanMode:0,networkId:0},"AUTO SCAN"),dvbManager.SetScanParams(JSON.stringify({type:self.step1.GetValue(),symRate:self.step2.GetValue(),modulation:self.step3.GetValue(),scanMode:0,networkId:0}))),DVBChannels.startAutoScan()):new CModalHint(self,_("Wrong field data"),4e3),!1}),this.SetHeader(_("Start scanning")),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){setTimeout(function(){self.step1.focus()},100)},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if("function"==typeof this.focusList[this.focusPos].EventHandler&&this.focusList[this.focusPos].EventHandler(event),event.stopped!==!0)switch(event.code){case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;default:self.bpanel.EventHandler(event)}},this.Init(),this.SetContent(html),this.Show(!0)}function CModalManualScanDVB(parent){CModalBox.call(this,parent),this.name="CModalManualScanDVB";var data,self=this,domArr=[];try{var text=dvbManager.GetCurrentScanTypes();echo(text,"GetCurrentScanTypes"),data=JSON.parse(text)}catch(e){echo(e,"GetCurrentScanTypes parse error")}this.step1=new CIntervalBox(SettingsPage,{parent:element("div"),max:858e3,min:5e4,interval:500,value:CModalManualScanDVBtext,style:"elements"}),this.step2=new CSelectBox(this,{data:data,idField:"type",nameField:"name",parent:element("div"),events:{onChange:function(){}},selected:DVBChannels.DVBType}),1!==DVBChannels.DVBType?(this.step3=new CSelectBox(this,{data:[{id:6,name:6},{id:7,name:7},{id:8,name:8}],parent:element("div"),events:{onChange:function(){}},selected:7}),this.focusList=[this.step1,this.step2,this.step3],domArr=[element("tr",{},[element("td",{className:"name"},_("Frequency (KHz):")),element("td",{className:"data"},this.step1.parentNode)]),element("tr",{},[element("td",{className:"name"},_("DVB type:")),element("td",{className:"data"},this.step2.parentNode)]),element("tr",{},[element("td",{className:"name"},_("Bandwidth (MHz):")),element("td",{className:"data"},this.step3.parentNode)])]):(this.step3=new CIntervalBox(SettingsPage,{parent:element("div"),max:7200,min:870,interval:1,value:6875,style:"elements"}),this.step4=new CSelectBox(this,{data:[{value:0,name:_("Auto")},{value:1,name:"16 QAM"},{value:2,name:"32 QAM"},{value:3,name:"64 QAM"},{value:4,name:"128 QAM"},{value:5,name:"256 QAM"}],idField:"value",nameField:"name",parent:element("div"),events:{onChange:function(){}},selected:0}),this.step5=new CSelectBox(this,{data:[{value:0,name:_("Network")},{value:1,name:_("Full")},{value:2,name:_("Fast")}],idField:"value",nameField:"name",parent:element("div"),events:{onChange:function(){}},selected:1}),this.step6=element("input",{type:"text"}),domArr=[element("tr",{},[element("td",{className:"name"},_("Frequency (KHz):")),element("td",{className:"data"},this.step1.parentNode)]),element("tr",{},[element("td",{className:"name"},_("DVB type:")),element("td",{className:"data"},this.step2.parentNode)]),element("tr",{},[element("td",{className:"name"},_("Symbol rate:")),element("td",{className:"data"},this.step3.parentNode)]),element("tr",{},[element("td",{className:"name"},_("Modulation:")),element("td",{className:"data"},this.step4.parentNode)]),element("tr",{},[element("td",{className:"name"},_("Network ID:")),element("td",{className:"data"},this.step6)])],this.focusList=[this.step1,this.step2,this.step3,this.step4,this.step6]);var html=element("table",{className:"main maxw CModalScanDVB"},domArr);this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Scan"),function(){var netId,freq=self.step1.GetValue(),type=self.step2.GetValue();CModalManualScanDVBtext=freq,freq&&type?(self.Show(!1),DVBChannels.DVBType=type,1===DVBChannels.DVBType?(netId=parseInt(self.step6.value)||0,dvbManager.SetScanParams(JSON.stringify({type:type,symRate:self.step3.GetValue(),modulation:self.step4.GetValue(),scanMode:2,frequency:freq,networkId:netId})),echo({type:type,symRate:self.step3.GetValue(),modulation:self.step4.GetValue(),scanMode:2,frequency:freq,networkId:netId},"MANUAL SCAN"),DVBChannels.startAutoScan()):DVBChannels.startManualScan(freq,1!==type?self.step3.GetValue():null)):new CModalHint(self,_("Wrong field data"),4e3)}),this.SetHeader(_("Start scanning")),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.onShow=function(){setTimeout(function(){self.focusList[0].focus()},100)},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if("function"==typeof this.focusList[this.focusPos].EventHandler&&this.focusList[this.focusPos].EventHandler(event),event.stopped!==!0)switch(event.code){case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;default:self.bpanel.EventHandler(event)}},this.Init(),this.SetContent(html),this.Show(!0)}function CModalInitEPGInfo(parent,id){var data,up,down;if(this.day=0,this.id=id,data=dvbManager.GetEPGSchedule(this.id,this.day),echo(data,"epg shedule"),""===data||"{}"===data)return void new CModalHint(currCPage,_("EPG not available"),3e3);try{data=JSON.parse(data)}catch(e){data.events=[],echo(e,"EPG parse error")}if(!data.events||0===data.events.length)return void new CModalHint(currCPage,_("EPG not available"),3e3);CModalBox.call(this,parent);var date=new Date;this.name="CModalInitEPGInfo";var self=this;this.EventHandler=function(event){switch(event.code){case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault();break;case KEYS.UP:case KEYS.DOWN:self.EPGList.EventHandler(event),event.preventDefault();break;case KEYS.RIGHT:event.preventDefault(),self.changeDay(1);break;case KEYS.LEFT:event.preventDefault(),self.changeDay(-1);break;case KEYS.PAGE_DOWN:self.domText.scrollTop+=self.domText.offsetHeight,event.preventDefault();break;case KEYS.PAGE_UP:self.domText.scrollTop-=self.domText.offsetHeight,event.preventDefault();break;case KEYS.INFO:case KEYS.EXIT:self.Show(!1)}},this.changeDay=function(a){this.day+=a,this.day<0&&(this.day=0);var date=new Date,time=date.getTime();date.setTime(time+864e5*this.day),this.domDay.innerHTML=date.getDate()+" "+fullMonthNames[date.getMonth()];var data=dvbManager.GetEPGSchedule(this.id,this.day);if(""===data||"{}"===data)return void this.EPGList.Clear();try{data=JSON.parse(data)}catch(e){this.EPGList.Clear(),data.events=[],echo(e,"EPG parse error")}return data.events&&0!==data.events.length?(this.EPGList.data=data.events,void this.EPGList.Open({type:MEDIA_TYPE_ROOT_EPG})):void this.EPGList.Clear()},this.Init(),this.handle.querySelector(".cmodal-body").className+=" "+this.name,elchild(this.handle.querySelector(".cmodal-content"),[element("div",{className:"header"},[element("div",{className:"left"},_("The program for:")),element("a",{},[element("div",{className:"day_left"})]),this.domDay=element("div",{className:"left"},date.getDate()+" "+fullMonthNames[date.getMonth()]),element("a",{},[element("div",{className:"day_right"})])]),this.domList=element("div",{className:"list"}),element("div",{className:"rightBlock"},[up=element("div",{className:"textUp"}),this.domText=element("div",{className:"text"}),down=element("div",{className:"textDown"})])]),configuration.newRemoteControl,up.style.backgroundImage="url("+PATH_IMG_SYSTEM+"buttons/new/pgup.png)",down.style.backgroundImage="url("+PATH_IMG_SYSTEM+"buttons/new/pgdown.png)",this.EPGList=new EPGList(this),this.EPGList.Init(this.domList),this.EPGList.data=data.events,this.Show(!0),this.EPGList.Open({type:MEDIA_TYPE_ROOT_EPG})}function EPGList(parent){CScrollList.call(this,parent),this.data=[]}function CModalAntennaPower(parent,input){var html,data,self=this;CModalBox.call(this,parent),this.name="CModalAntennaPower";try{data=JSON.parse(dvbManager.GetCurrentScanTypes(input))}catch(e){echo(e,"GetCurrentScanTypes parse error")}this.focusList=[],this.focusPos=0,1!==data[0].type?(this.step1=new CCheckBox(this,{parent:element("div",{className:"control"}),checked:dvbManager.GetAntennaPower(input)}),html=element("table",{className:"main maxw CModalScanDVB"},[element("tr",{},[element("td",{className:"name"},_("DVB type:")),element("td",{className:"data"},data[0].name)]),element("tr",{},[element("td",{className:"name"},_("Antenna power supply")+":"),element("td",{className:"data"},this.step1.handle)])]),this.focusList=[this.step1]):html=element("table",{className:"main maxw CModalScanDVB"},[element("tr",{},[element("td",{className:"name"},_("DVB type:")),element("td",{className:"data"},data[0].name)])]),this.bpanel=new CButtonPanel,this.bpanel.Init(CMODAL_IMG_PATH),this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Show(!1)}),this.bpanel.Add(KEYS.OK,"ok.png",_("Save"),function(){return dvbManager.SetAntennaPower(self.step1.IsChecked(),input),self.Show(!1),!1}),this.onShow=function(){setTimeout(function(){self.step1&&self.step1.focus()},100)},this.onHide=function(){elclear(self.bpanel.handle),delete self.bpanel,self.Free()},this.EventHandler=function(event){if(event.preventDefault(),this.focusList.length&&"function"==typeof this.focusList[this.focusPos].EventHandler&&this.focusList[this.focusPos].EventHandler(event),event.stopped!==!0)switch(event.code){case KEYS.UP:self.FocusPrev(event,!1),event.preventDefault();break;case KEYS.DOWN:self.FocusNext(event,!1),event.preventDefault();break;default:self.bpanel.EventHandler(event)}},this.Init(),this.SetHeader(_("Antenna")+" "+(input+1)),this.SetContent(html),this.SetFooter(this.bpanel.handle),this.Show(!0)}function importStbParams(){var fv_data=gSTB.LoadUserData("favorites.json"),oldConfFile=gSTB.ReadCFG();if(echo("file favorites.json:"+fv_data),echo("file stb_param:"+oldConfFile),oldConfFile){var files=[],fvLastChange,oldConfLastChange,i,j,data,fv_text="";gSTB.SetListFilesExt("favorites.json iptv.json stb_params");try{eval(gSTB.ListDir("/mnt/Userfs",!0))}catch(e){echo(e),files=[]}oldConfLastChange=files[0]?Number(files[0].last_modified):0;try{eval(gSTB.ListDir("/mnt/Userfs/data",!0))}catch(e){echo(e),files=[]}if(fvLastChange=files[0]&&files[0].last_modified?Number(files[0].last_modified):0,gSTB.SetListFilesExt("."+configuration.registersTypes.join(" .")),echo("fav LastChange="+fvLastChange+", oldConf LastChange="+oldConfLastChange),oldConfLastChange>=tvLastChange&&oldConfLastChange>=fvLastChange&&""!==oldConfFile){i=oldConfFile.indexOf("[Favorites]"),-1!==i&&(j=oldConfFile.indexOf("[/Favorites]"),-1!==j&&(fv_text=oldConfFile.substr(i+11,j-i-11)));try{""!==fv_text&&void 0!==fv_text?(data=oldFV_to_new(eval(fv_text||"{}")),MediaBrowser.FavSave(data)):MediaBrowser.FavSave({})}catch(e){MediaBrowser.FavSave({}),echo(e,"Favorites parsing from the old file")}}gSTB.WriteCFG("")}else if(""!==fv_data)try{FAVORITES=JSON.parse(fv_data);for(var name in FAVORITES)FAVORITES[name].markable=!0,FAVORITES_NEW[name]=FAVORITES[name]}catch(e){echo(e,"FAVORITES data parsing error"),FAVORITES={},FAVORITES_NEW={},gSTB.SaveUserData("favorites.json","{}")}}function oldFV_to_new(data){var list={};return Array.isArray(data)&&data.forEach(function(item){var fav={};fav.name=unescape(item.name).trim(),fav.size=fav.size||0,fav.url=unescape(item.source).trim(),fav.markable=!0,"stream"===item.fileType?(fav.type=MEDIA_TYPE_STREAM,fav.tsOn="true"===item.tsOn,fav.ext=""):(fav.ext=fav.name.split(".").pop(),fav.type=MediaBrowser.FileList.ext2type[fav.ext.toLowerCase()]),list[fav.url]=fav}),list}function startPortal(){switch(echo("Start Embeded Portal"),WINDOW_HEIGHT){case 480:as.image_dir="576";break;case 576:as.image_dir="576";break;case 720:as.image_dir="720";break;case 1080:as.image_dir="1080";break;default:as.image_dir="576"}environment.language=environment.language.toLowerCase()||as.default_lang,STORAGE_INFO.forEach(function(item){stbDownloadManager.RestoreJobs(item.mountPath)});try{VIDEO_MODE=gSTB.RDir("vmode")}catch(e){echo(e,"vmode rdir error")}echo(VIDEO_MODE,"current video mode"),gSTB.EnableServiceButton(!0),gSTB.EnableVKButton(!0);try{SMB_ARRAY=JSON.parse(gSTB.LoadUserData("smb_data")),SMB_ARRAY&&Array.isArray(SMB_ARRAY)?SMB_ARRAY.forEach(function(item){"/"===item.folder.charAt(item.folder.length-1)&&(item.folder=item.folder.slice(0,-1)),void 0===item.automount&&(SMB_AUTH["//"+item.url+"/"+item.folder]={login:item.login,pass:item.pass})}):SMB_ARRAY=[]}catch(e){echo(e,"SMB data parsing error"),gSTB.SaveUserData("smb_data","[]")}try{NFS_ARRAY=JSON.parse(gSTB.LoadUserData("nfs_data")),NFS_ARRAY&&Array.isArray(NFS_ARRAY)?NFS_ARRAY.forEach(function(item){item.folder&&"/"!==item.folder.charAt(0)&&(item.folder="/"+item.folder),"/"===item.folder.charAt(item.folder.length-1)&&(item.folder=item.folder.slice(0,-1))}):NFS_ARRAY=[]}catch(e){echo(e,"NFS data parsing error"),gSTB.SaveUserData("nfs_data","[]")}}function mainEventListener(event){if(eventPrepare(event,!1,currCPage.name)){if(currCPage&&currCPage.EventHandler(event))return event.preventDefault(),void event.stopPropagation();switch(event.code){case 220:echo("\n\n\n<html><head>\n"+document.head.innerHTML+"\n</head>\n<body>\n"+document.body.innerHTML+"\n</body>\n</html>\n");break;case KEYS.MUTE:toggleMuteState();break;case KEYS.VOLUME_UP:environment.audio_initial_volume<100&&(environment.audio_initial_volume+=configuration.volume.step),volumeSetVolume(environment.audio_initial_volume),event.preventDefault(),event.stopPropagation();break;case KEYS.VOLUME_DOWN:environment.audio_initial_volume>0&&(environment.audio_initial_volume-=configuration.volume.step),volumeSetVolume(environment.audio_initial_volume),event.preventDefault(),event.stopPropagation();break;case KEYS.EXIT:app.pressExit();break;case KEYS.NUM0:DEBUG&&location.reload()}}}function sendPingRequest(){configuration.url.ping.length>0&&ajax("get",configuration.url.ping[sendPingRequest.linkIndex],function(data,status){var state=status>0;state?(CURRENT_INTERNET_STATE!==state&&stbEvent.onInternetStateChange(!0),CURRENT_INTERNET_STATE=!0,sendPingRequest.errorCount=0):(sendPingRequest.linkIndex=++sendPingRequest.linkIndex%configuration.url.ping.length,++sendPingRequest.errorCount>=configuration.url.pingAttempts?(sendPingRequest.errorCount=0,CURRENT_INTERNET_STATE!==state&&stbEvent.onInternetStateChange(!1),CURRENT_INTERNET_STATE=!1):sendPingRequest())})}function getNetworkState(){var state=gSTB.GetLanLinkStatus();return CURRENT_NETWORK_STATE!==state&&"function"==typeof stbEvent.onNetworkStateChange&&stbEvent.onNetworkStateChange(state),state||CURRENT_INTERNET_STATE===!1||(CURRENT_INTERNET_STATE=!1,"function"==typeof stbEvent.onInternetStateChange&&stbEvent.onInternetStateChange(CURRENT_INTERNET_STATE)),CURRENT_NETWORK_STATE=state,state}function getNetState(state){getNetworkState()}function toggleMuteState(){configuration.volume.mute?(document.getElementById("mute").style.visibility="hidden",document.getElementById("toolsPan").style.display="none",configuration.volume.mute=0):(volumeCloseForm(),document.getElementById("mute").style.visibility="visible",document.getElementById("toolsPan").style.display="block",configuration.volume.mute=1,configuration.volume.timer&&clearTimeout(configuration.volume.timer)),gSTB.SetMute(configuration.volume.mute)}function volumeSetVolume(vol){configuration.volume.timer&&clearTimeout(configuration.volume.timer),document.getElementById("mute").style.visibility="hidden";var step_px;step_px=1920===WINDOW_WIDTH?15:10;var valueDiv=document.getElementById("volumeForm"),volumeNum=document.getElementById("volume_num"),bar=document.getElementById("volume_right"),control=document.getElementById("volume_bar"),vol_idx=vol/5;if(vol_idx){var value=vol_idx*step_px-5;bar.style.width=value+"px",configuration.volume.mute&&toggleMuteState(),control.style.visibility="visible"}else control.style.visibility="hidden";volumeNum.innerHTML=environment.audio_initial_volume+"%",gSTB.SetVolume(vol),configuration.volume.timer=setTimeout(volumeCloseForm,configuration.volume.hideTimeOut),valueDiv.style.visibility="visible",document.getElementById("toolsPan").style.display="block"}function volumeCloseForm(){configuration.volume.timer=null,document.getElementById("volumeForm").style.visibility="hidden",environment.audio_initial_volume>=5&&(document.getElementById("volume_bar").style.visibility="hidden"),document.getElementById("toolsPan").style.display="none"}function loadEnvironmentVars(volume){var environment,query={varList:["audio_initial_volume","hdmi_event_delay"]};try{environment=JSON.parse(gSTB.GetEnv(JSON.stringify(query))).result,""===environment.hdmi_event_delay&&(environment.hdmi_event_delay="3",gSTB.SetEnv(JSON.stringify({hdmi_event_delay:"3"}))),null!==volume&&""===environment.audio_initial_volume&&(environment.audio_initial_volume=volume),environment.language=getCurrentLanguage()}catch(e){echo(e,"Environment load"),environment={}}return gSTB.SetInputLang(environment.language),environment}function random(m,n){return Math.floor(Math.random()*(n-m+1))+m}function CFileList(parent){var self=this;VList.call(this,{size:5}),this.parent=parent,this.name="CFileList",this.bcrumb=null,this.sbar=null,this.ext2type={},this.LEVEL_CHANGE_NONE=0,this.LEVEL_CHANGE_UP=-1,this.LEVEL_CHANGE_DOWN=1,this.path=[],this.subList=[],this.playList=[],this.playListSet=!1,this.mtypes=[],this.hideF2=!0,this.canFav=!1,this.total=0,MEDIA_EXTENSION[MEDIA_TYPE_VIDEO].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_VIDEO}),MEDIA_EXTENSION[MEDIA_TYPE_AUDIO].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_AUDIO}),MEDIA_EXTENSION[MEDIA_TYPE_IMAGE].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_IMAGE}),MEDIA_EXTENSION[MEDIA_TYPE_TEXT].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_TEXT}),MEDIA_EXTENSION[MEDIA_TYPE_ISO].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_ISO}),MEDIA_EXTENSION[MEDIA_TYPE_PLAYLIST].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_PLAYLIST}),MEDIA_EXTENSION[MEDIA_TYPE_CUE].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_CUE}),MEDIA_EXTENSION[MEDIA_TYPE_RECORDS_ITEM].forEach(function(item){self.ext2type[item]=MEDIA_TYPE_RECORDS_ITEM}),FileBrowser.init(this),this.fileBrowser=FileBrowser}var DEBUG=!0,DEBUG_NAME="",DEBUG_SERVER="",EMULATION=!1,PATH_MODE_WEB=!1,PATH_ROOT=null,PATH_SYSTEM=null,PATH_MEDIA="/media/",WINDOW_WIDTH=screen.width,WINDOW_HEIGHT=screen.height,URL_PARAMS={},initFound=!1,proxy;PATH_ROOT=location.pathname.split("/"),PATH_ROOT[PATH_ROOT.length-1]="",PATH_ROOT=PATH_ROOT.join("/"),PATH_ROOT=location.protocol+"//"+location.host+PATH_ROOT+PATH_BASE,PATH_SYSTEM=PATH_ROOT+"system/",document.location.search&&document.location.search.substring(1).split("&").forEach(function(part){part=part.split("="),2===part.length&&(URL_PARAMS[part[0]]=decodeURIComponent(part[1]))}),window.parent&&window.parent.gSTB&&(window.dvbManager=window.parent.dvbManager,window.epgManager=window.parent.epgManager,window.gSTB=window.parent.gSTB,window.pvrManager=window.parent.pvrManager,window.stbDownloadManager=window.parent.stbDownloadManager,window.stbStorage=window.parent.stbStorage,window.stbUpdate=window.parent.stbUpdate,window.stbUPnP=window.parent.stbUPnP,window.stbWebWindow=window.parent.stbWebWindow,window.stbWindowMgr=window.parent.stbWindowMgr,window.timeShift=window.parent.timeShift),void 0===window.gSTB&&void 0===window.parent.gSTB?(DEBUG=EMULATION=!0,DEBUG_SERVER=DEBUG_SERVER||localStorage.getItem("DEBUG_SERVER"),DEBUG_NAME=DEBUG_NAME||localStorage.getItem("DEBUG_NAME"),WINDOW_WIDTH=parseInt(URL_PARAMS.width,10)||window.outerWidth,WINDOW_HEIGHT=parseInt(URL_PARAMS.height,10)||window.outerHeight,document.write('<script type="text/javascript" src="'+PATH_SYSTEM+'gstb.js"></script>\n'),document.write('<script type="text/javascript" src="'+PATH_SYSTEM+'debug.js"></script>\n'),document.write('<script type="text/javascript" src="http://'+DEBUG_SERVER+':8800/file/client.js"></script>\n'),document.write('<script type="text/javascript">if ( window.proxyClient ) {proxy = new proxyClient();if ( DEBUG_NAME && DEBUG_SERVER ) proxy.init({name:"'+DEBUG_NAME+'", host:"'+DEBUG_SERVER+'"}); }</script>\n'),window.addEventListener("load",function(){document.body.style.backgroundColor="black"})):(gSTB.SetNativeStringMode(!0),function(){var vars=JSON.parse(gSTB.GetEnv(JSON.stringify({varList:["debug","debug_name","debug_server"]})));!vars.errMsg&&vars.result&&(DEBUG="1"===vars.result.debug,DEBUG&&!URL_PARAMS.nodebug&&(document.write('<script type="text/javascript" src="'+PATH_SYSTEM+'debug.js"></script>\n'),DEBUG_NAME=DEBUG_NAME||vars.result.debug_name,DEBUG_SERVER=DEBUG_SERVER||vars.result.debug_server,DEBUG_NAME&&DEBUG_SERVER&&"1"!==stbStorage.getItem("spyjs.active")&&document.write('<script type="text/javascript" src="http://'+DEBUG_SERVER+":8000/target/target-script-min.js#"+DEBUG_NAME+'"></script>\n')))}());var PATH_IMG_SYSTEM=PATH_SYSTEM+"img/"+WINDOW_WIDTH+"/",PATH_IMG_PUBLIC=PATH_ROOT+"public/img/"+WINDOW_WIDTH+"/",configuration=function(){var config={newRemoteControl:!1,allowMulticastUpdate:!1};return config.newRemoteControl=-1!==["AuraHD2","AuraHD3","AuraHD8","MAG254","MAG275","MAG276","WR320"].indexOf(gSTB.GetDeviceModelExt()),config}(),WINDOWS={PORTAL:"portal",HELP:"help",DOWNLOAD_MANAGER:"dlman",PVR:"recordsManager",BROWSER:"ibman",BROWSER_VIEW:"ibmanView",PORTALS_LOADER:"portalsLoader",SYSTEM_SETTINGS:"systemSettings"},KEYS={BACK:8,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,NUM0:48,DELETE:46,CHANNEL_PREV:1009,CHANNEL_NEXT:9,OK:13,EXIT:27,UP:38,DOWN:40,LEFT:37,RIGHT:39,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,VOLUME_UP:107,VOLUME_DOWN:109,F1:112,F2:113,F3:114,F4:115,REFRESH:116,FRAME:117,PHONE:119,EPG:119,SET:120,TV:121,MENU:122,WEB:123,MIC:2032,REWIND:2066,FORWARD:2070,APP:2076,USB_MOUNTED:2080,USB_UNMOUNTED:2081,PLAY_PAUSE:2082,STOP:2083,POWER:2085,RECORD:2087,INFO:2089,MUTE:2192,CLOCK:2032,AUDIO:2071,KEYBOARD:2076},gettext=function(){var module={},data=null;return module.init=function(options,onReady){options.name=options.name||"en",options.ext=options.ext||"js",options.path=options.path||"lang",data=null,"en"!==options.name?loadScript(options.path+"/"+options.name+"."+options.ext,onReady,onReady):"function"==typeof onReady&&onReady()},module.load=function(input){data=input},module.data=function(key){return null===data?key:void 0!==data[key]?data[key]:key},module}(),_=gettext.data;if(void 0===window.echo&&(window.echo=function(data,title){}),ajax.stop=!1,parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},!("classList"in document.documentElement)){var prototype=Array.prototype,indexOf=prototype.indexOf,slice=prototype.slice,push=prototype.push,splice=prototype.splice,join=prototype.join;window.DOMTokenList=function(el){if(this._element=el,el.className!==this._classCache){if(this._classCache=el.className,!this._classCache)return;var i,classes=this._classCache.replace(/^\s+|\s+$/g,"").split(/\s+/);for(i=0;i<classes.length;i++)push.call(this,classes[i])}},window.DOMTokenList.prototype={add:function(token){this.contains(token)||(push.call(this,token),this._element.className=slice.call(this,0).join(" "))},contains:function(token){return-1!==indexOf.call(this,token)},item:function(index){return this[index]||null},remove:function(token){var i=indexOf.call(this,token);-1!==i&&(splice.call(this,i,1),
this._element.className=slice.call(this,0).join(" "))},toString:function(){return join.call(this," ")},toggle:function(token){return this.contains(token)?this.remove(token):this.add(token),this.contains(token)}},Object.defineProperty(Element.prototype,"classList",{get:function(){return new window.DOMTokenList(this)}})}var Events={bind:function(event,callback){if(this._events||(this._events={}),"object"==typeof event)for(var name in event)this.bind(name,event[name]);else"string"==typeof event&&"function"==typeof callback&&(void 0===this._events[event]&&(this._events[event]=[]),this._events[event].push(callback))},trigger:function(event,data){var result,results=[],self=this;return void 0!==event&&void 0!==this._events&&void 0!==this._events[event]&&this._events[event].forEach(function(ev){result=ev.call(self,data),void 0!==result&&results.push(result)}),results},unbind:function(event){delete this._events[event]},inject:function(obj){"function"==typeof obj?extend(obj.prototype,this):"object"==typeof obj&&extend(obj,this)}},timeZoneOffsets={A:{index:-1,minutes:60},ACDT:{index:-1,minutes:60},ACST:{index:-1,minutes:570},ACT:{index:1,minutes:300},ACWST:{index:-1,minutes:525},ADT:{index:1,minutes:180},AEDT:{index:-1,minutes:61},AEST:{index:-1,minutes:60},AFT:{index:-1,minutes:270},AKDT:{index:1,minutes:480},AKST:{index:1,minutes:540},ALMT:{index:-1,minutes:360},AMST:{index:1,minutes:180},AMT:{index:1,minutes:240},ANAST:{index:-1,minutes:62},ANAT:{index:-1,minutes:62},AQTT:{index:-1,minutes:300},ART:{index:1,minutes:180},AST:{index:1,minutes:240},AWDT:{index:-1,minutes:540},AWST:{index:-1,minutes:480},AZOST:{index:0,minutes:0},AZOT:{index:1,minutes:60},AZST:{index:-1,minutes:300},AZT:{index:-1,minutes:240},B:{index:-1,minutes:120},BNT:{index:-1,minutes:480},BOT:{index:1,minutes:240},BRST:{index:1,minutes:120},BRT:{index:1,minutes:180},BST:{index:-1,minutes:60},BTT:{index:-1,minutes:360},C:{index:-1,minutes:180},CAST:{index:-1,minutes:480},CAT:{index:-1,minutes:120},CCT:{index:-1,minutes:390},CDT:{index:1,minutes:300},CEST:{index:-1,minutes:120},CET:{index:-1,minutes:60},CHADT:{index:-1,minutes:63},CHAST:{index:-1,minutes:62},CHOT:{index:-1,minutes:480},CHUT:{index:-1,minutes:600},CKT:{index:1,minutes:60},CLST:{index:1,minutes:180},CLT:{index:1,minutes:240},COT:{index:1,minutes:300},CST:{index:1,minutes:360},CVT:{index:1,minutes:60},CXT:{index:-1,minutes:420},ChST:{index:-1,minutes:60},D:{index:-1,minutes:240},DAVT:{index:-1,minutes:420},E:{index:-1,minutes:300},EASST:{index:1,minutes:300},EAST:{index:1,minutes:360},EAT:{index:-1,minutes:180},ECT:{index:1,minutes:300},EDT:{index:-1,minutes:61},EEST:{index:-1,minutes:180},EET:{index:-1,minutes:120},EGST:{index:0,minutes:0},EGT:{index:1,minutes:60},EST:{index:1,minutes:300},ET:{index:1,minutes:300},F:{index:-1,minutes:360},FET:{index:-1,minutes:180},FJST:{index:-1,minutes:63},FJT:{index:-1,minutes:62},FKST:{index:1,minutes:180},FKT:{index:1,minutes:240},FNT:{index:1,minutes:120},G:{index:-1,minutes:420},GALT:{index:1,minutes:360},GAMT:{index:1,minutes:540},GET:{index:-1,minutes:240},GFT:{index:1,minutes:180},GILT:{index:-1,minutes:62},GMT:{index:0,minutes:0},GST:{index:-1,minutes:240},GYT:{index:1,minutes:240},H:{index:-1,minutes:480},HAA:{index:1,minutes:180},HAC:{index:1,minutes:300},HADT:{index:1,minutes:540},HAE:{index:1,minutes:240},HAP:{index:1,minutes:420},HAR:{index:1,minutes:360},HAST:{index:1,minutes:60},HAT:{index:1,minutes:150},HAY:{index:1,minutes:480},HKT:{index:-1,minutes:480},HLV:{index:1,minutes:270},HNA:{index:1,minutes:240},HNC:{index:1,minutes:360},HNE:{index:1,minutes:300},HNP:{index:1,minutes:480},HNR:{index:1,minutes:420},HNT:{index:1,minutes:210},HNY:{index:1,minutes:540},HOVT:{index:-1,minutes:420},I:{index:-1,minutes:540},ICT:{index:-1,minutes:420},IDT:{index:-1,minutes:180},IOT:{index:-1,minutes:360},IRDT:{index:-1,minutes:270},IRKST:{index:-1,minutes:540},IRKT:{index:-1,minutes:540},IRST:{index:-1,minutes:210},IST:{index:-1,minutes:60},JST:{index:-1,minutes:540},K:{index:-1,minutes:60},KGT:{index:-1,minutes:360},KOST:{index:-1,minutes:660},KRAST:{index:-1,minutes:480},KRAT:{index:-1,minutes:480},KST:{index:-1,minutes:540},KUYT:{index:-1,minutes:240},L:{index:-1,minutes:61},LHDT:{index:-1,minutes:61},LHST:{index:-1,minutes:60},LINT:{index:-1,minutes:64},M:{index:-1,minutes:62},MAGST:{index:-1,minutes:62},MAGT:{index:-1,minutes:62},MART:{index:1,minutes:570},MAWT:{index:-1,minutes:300},MDT:{index:1,minutes:360},MESZ:{index:-1,minutes:120},MEZ:{index:-1,minutes:60},MHT:{index:-1,minutes:62},MMT:{index:-1,minutes:390},MSD:{index:-1,minutes:240},MSK:{index:-1,minutes:240},MST:{index:1,minutes:420},MUT:{index:-1,minutes:240},MVT:{index:-1,minutes:300},MYT:{index:-1,minutes:480},N:{index:1,minutes:60},NCT:{index:-1,minutes:61},NDT:{index:1,minutes:150},NFT:{index:-1,minutes:61},NOVST:{index:-1,minutes:420},NOVT:{index:-1,minutes:360},NPT:{index:-1,minutes:345},NRT:{index:-1,minutes:720},NST:{index:1,minutes:210},NUT:{index:1,minutes:61},NZDT:{index:-1,minutes:63},NZST:{index:-1,minutes:62},O:{index:1,minutes:120},OMSST:{index:-1,minutes:420},OMST:{index:-1,minutes:420},ORAT:{index:-1,minutes:300},P:{index:1,minutes:180},PDT:{index:1,minutes:420},PET:{index:1,minutes:300},PETST:{index:-1,minutes:62},PETT:{index:-1,minutes:62},PGT:{index:-1,minutes:60},PHOT:{index:-1,minutes:63},PHT:{index:-1,minutes:480},PKT:{index:-1,minutes:300},PMDT:{index:1,minutes:120},PMST:{index:1,minutes:180},PONT:{index:-1,minutes:61},PST:{index:1,minutes:480},PT:{index:1,minutes:480},PWT:{index:-1,minutes:540},PYST:{index:1,minutes:180},PYT:{index:1,minutes:240},Q:{index:1,minutes:240},QYZT:{index:1,minutes:360},R:{index:1,minutes:300},RET:{index:-1,minutes:240},S:{index:1,minutes:360},SAKT:{index:1,minutes:600},SAMT:{index:-1,minutes:240},SAST:{index:-1,minutes:120},SBT:{index:-1,minutes:61},SCT:{index:-1,minutes:240},SGT:{index:-1,minutes:480},SRET:{index:-1,minutes:660},SRT:{index:1,minutes:180},SST:{index:1,minutes:61},T:{index:1,minutes:420},TAHT:{index:1,minutes:60},TFT:{index:-1,minutes:300},TJT:{index:-1,minutes:300},TKT:{index:-1,minutes:63},TLT:{index:-1,minutes:540},TMT:{index:-1,minutes:300},TOT:{index:-1,minutes:780},TVT:{index:-1,minutes:62},U:{index:1,minutes:480},ULAT:{index:-1,minutes:480},UTC:{index:0,minutes:0},UYST:{index:1,minutes:120},UYT:{index:1,minutes:180},UZT:{index:-1,minutes:300},V:{index:1,minutes:540},VET:{index:1,minutes:270},VLAST:{index:-1,minutes:61},VLAT:{index:-1,minutes:61},VUT:{index:-1,minutes:61},W:{index:1,minutes:60},WARST:{index:1,minutes:180},WAST:{index:-1,minutes:120},WAT:{index:-1,minutes:60},WEST:{index:-1,minutes:60},WESZ:{index:-1,minutes:60},WET:{index:0,minutes:0},WEZ:{index:0,minutes:0},WFT:{index:-1,minutes:62},WGST:{index:1,minutes:120},WGT:{index:1,minutes:180},WIB:{index:-1,minutes:420},WIT:{index:-1,minutes:540},WITA:{index:-1,minutes:480},WST:{index:-1,minutes:63},WT:{index:0,minutes:0},X:{index:1,minutes:61},Y:{index:1,minutes:62},YAKST:{index:-1,minutes:60},YAKT:{index:-1,minutes:60},YAPT:{index:-1,minutes:60},YEKST:{index:-1,minutes:360},YEKT:{index:-1,minutes:360},Z:{index:0,minutes:0}};Array.prototype.shuffle=function(){for(var i,tmp,n=this.length;n--;)i=Math.floor(n*Math.random()),tmp=this[i],this[i]=this[n],this[n]=tmp;return this},CBase.prototype.SetParent=function(parent){parent instanceof CBase&&(this.parent=parent)},CBase.prototype.Init=function(handle){if(handle&&handle.nodeName){this.handle=handle,this.baseClass&&-1===handle.className.indexOf(this.baseClass)?this.handleInner=this.handle.appendChild(element("div",{className:this.baseClass})):this.handleInner=this.handle;var self=this;this.handle.addEventListener("click",function(event){"function"==typeof self.onClick&&self.onClick()===!1&&event.stopPropagation()}),"function"==typeof this.onInit&&this.onInit()}},CBase.prototype.Activate=function(active){this.isActive=active!==!1,this.isActive?("function"==typeof this.onActivate&&this.onActivate(),this.parent&&(this.parent.activeChild&&this.parent.activeChild!==this&&this.parent.activeChild.Activate(!1),this.parent.activeChild=this)):("function"==typeof this.onDeactivate&&this.onDeactivate(),this.parent&&(this.parent.activeChild=null))},CBase.prototype.Show=function(visible,manageFocus){var success=!1;return this.handle&&(this.isVisible=visible!==!1,this.isVisible?this.handle.style.display!==this.showAttr&&(this.prevFocus=document.activeElement,manageFocus!==!1&&document.activeElement&&document.activeElement.blur(),this.handle.style.display=this.showAttr,manageFocus!==!1&&this.handle.focus(),"function"==typeof this.onShow&&this.onShow(),success=!0):"none"!==this.handle.style.display&&(manageFocus!==!1&&document.activeElement&&document.activeElement.blur(),this.handle.style.display="none",manageFocus!==!1&&this.prevFocus&&this.prevFocus.focus(),"function"==typeof this.onHide&&this.onHide(),this.isActive&&this.Activate(!1),success=!0)),success},CBase.prototype.Visible=function(mode){this.handle.style.visibility=Boolean(mode)?"visible":"hidden"},CBase.prototype.EventHandler=null,CBase.prototype.onInit=null,CBase.prototype.onShow=null,CBase.prototype.onHide=null,CBase.prototype.onActivate=null,CBase.prototype.onDeactivate=null,CBase.prototype.onClick=function(){return this.Activate(!0),!0},Update.CrashStatuses=[1,2,3,4,7,17,19,20,22,25,27],Update.OkStatus=21,Update.StatusMessages={1:"Signature init error",2:"Wrong device model",3:"Section size exceeds partition size on FLASH",4:"Required FLASH section not found. Aborting update",5:"Updating kernel",6:"Updating image",7:"Internal error",8:"Inspecting firmware",9:"Updating environment variables",10:"Updating Bootstrap section",11:"Skipping Bootstrap section",12:"Updating User FS section",13:"Skipping User FS section",14:"Updating second boot",15:"Updating logotype",16:"Update finished OK",17:"Wrong signature",18:"Erasing flash section",19:"Flash write error",20:"File write error",21:"Idle",22:"Invalid file header",23:"Inspecting update file",24:"File check finished",25:"File not found",26:"Initialising",27:"Read error"},Update.StartTFTP=function(timeout){var bootstrap_url=parseUri(Update.DefaultUpdateUrls.bootstrap_url),lan_params=["ipaddr","gatewayip","dnsip","netmask","ipaddr_conf"],lan_config=getEnvList(lan_params),type="up_dhcp_tftp",count=0;if(lan_config.ipaddr_conf&&"0.0.0.0"!==lan_params.ipaddr_conf){for(var i=0;i<lan_params.length;i++)lan_config[lan_params[i]]&&count++;if(count!==lan_params.length)return!1;type="up_ip_tftp"}return this.CheckUpdateByTFTP()?(setEnvList({serverip_conf:bootstrap_url.host,tftp_path_conf:bootstrap_url.relative.substr(1)})&&setTimeout(function(){gSTB.ExecAction("UpdateSW "+type)},timeout||0),!0):!1},Update.CheckUpdateByTFTP=function(){var update_url=parseUri(Update.DefaultUpdateUrls.update_url),ip_regexp=/^((?:[0-9]{1,3}\.){3}[0-9]{1,3})$/,bootstrap_regexp=/^(tftp):\/\/((?:[0-9]{1,3}\.){3}[0-9]{1,3})(:[0-9]+)?(\/.+)+$/;return-1===["igmp","tftp","http"].indexOf(update_url.protocol)?!1:"igmp"===update_url.protocol&&""!==update_url.relative?!1:"tftp"!==update_url.protocol&&"igmp"!==update_url.protocol||update_url.host.match(ip_regexp)?"Aura"===gSTB.GetDeviceModelExt().substr(0,4)?!1:!!Update.DefaultUpdateUrls.bootstrap_url.match(bootstrap_regexp):!1},Update.StartMulticast=function(timeout){var bootstrap_url=parseUri(Update.DefaultUpdateUrls.bootstrap_url);return this.CheckUpdateByMulticast&&setEnvList({mcip_conf:bootstrap_url.host,mcport_conf:bootstrap_url.port})?(setTimeout(function(){gSTB.ExecAction("UpdateSW up_mc_url")},timeout||0),!0):!1},Update.CheckUpdateByMulticast=function(){var regexp=/^(igmp):\/\/((?:[0-9]{1,3}\.){3}[0-9]{1,3})(:[0-9]+)?$/;return configuration.allowMulticastUpdate?!!Update.DefaultUpdateUrls.bootstrap_url.match(regexp)&&!!Update.DefaultUpdateUrls.update_url.match(regexp):!1},Update.DefaultUpdateUrls=getEnvList(["update_url","bootstrap_url"]),Update.prototype.Start=function(update_url){var status=stbUpdate.getStatus(),activeBank=stbUpdate.getActiveBank(),modelTemp=gSTB.RDir("Model").toUpperCase();if(status==Update.OkStatus&&this.update_url===update_url){if(this.trigger("onStart"),this.SystemButtons(!1),"MAG250"!==modelTemp&&"MAG270"!==modelTemp&&"MAG275"!==modelTemp&&-1!=activeBank&&2!=stbUpdate.GetFlashBankCount())return void this.trigger("onError",{errorMessage:_("Unable to update active memory bank"),logMessage:"Unable to update active memory bank",status:30});0==activeBank?stbUpdate.startUpdate(1,update_url):stbUpdate.startUpdate(0,update_url)}else this.CheckUpdate(update_url,!0);this.CheckProgress()},Update.prototype.CheckProgress=function(){var status=stbUpdate.getStatus(),self=this;this.CheckError(status)&&(this.auto_start===!0&&status===Update.OkStatus&&(this.auto_start=!1,this.Start(this.update_url)),this.trigger("onProgress",{percent:stbUpdate.getPercents(),statusMessage:_(Update.StatusMessages[status]),logMessage:Update.StatusMessages[status],status:status}),this.progress_timeout=setTimeout(function(){self.CheckProgress()},1e3))},Update.prototype.CheckError=function(status){return-1!==Update.CrashStatuses.indexOf(status)?(this.trigger("onError",{errorMessage:_(Update.StatusMessages[status]),logMessage:Update.StatusMessages[status],status:status}),this.SystemButtons(!0),!1):!0},Update.prototype.CheckUpdate=function(update_url,start_on_ready){"string"==typeof update_url&&stbUpdate.startCheck(this.check_url=update_url);var status=stbUpdate.getStatus(),self=this;if(this.CheckError(status))return this.trigger("onCheck",{statusMessage:_(Update.StatusMessages[status]),logMessage:Update.StatusMessages[status],status:status}),status===Update.OkStatus?(this.update_url=this.check_url,this.trigger("onReady"),void(start_on_ready===!0&&this.Start(this.update_url))):void(this.check_update_timeout=setTimeout(function(){self.CheckUpdate(null,start_on_ready)},100))},Update.prototype.GetImageInfo=function(){return stbUpdate.getStatus()===Update.OkStatus?{date:parseDate(stbUpdate.getImageDateStr()),description:stbUpdate.getImageDescStr(),version:stbUpdate.getImageVersionStr()}:null},Update.prototype.GetCurrentImageInfo=function(){if(void 0===this.curr_info){var info=JSON.parse(gSTB.GetEnv(JSON.stringify({varList:["Image_Desc","Image_Date","Image_Version"]}))).result;this.curr_info={date:parseDate(info.Image_Date),description:info.Image_Desc,version:info.Image_Version}}return this.curr_info},Update.prototype.Clear=function(){clearTimeout(this.check_update_timeout),clearTimeout(this.progress_timeout),this.auto_start=!1,this.update_url=""},Update.prototype.SystemButtons=function(enable){gSTB.EnableServiceButton(enable),gSTB.EnableVKButton(enable),gSTB.EnableAppButton(enable),gSTB.EnableTvButton(enable)},Events.inject(Update);var CProgressBar=function(parent,parentNode){CBase.call(this,parent||null),void 0===parentNode&&(parentNode=element("div")),elchild(parentNode,this.$bar=element("div",{className:"cprogressbar"},element("div",{className:"progressbar_bg"},[this.$line=element("div",{className:"progressbar_line"}),this.$digit=element("div",{className:"progressbar_digit"},"0 %")]))),this.Init(parentNode)};CProgressBar.prototype=Object.create(CBase.prototype),CProgressBar.prototype.constructor=CProgressBar,CProgressBar.prototype.SetProgress=function(percent){this.$line.style.width=percent+"%",this.$digit.innerHTML=percent+"%"},CPage.prototype=Object.create(CBase.prototype),CPage.prototype.constructor=CPage,CPage.prototype.Show=function(visible,previous){visible===!1?(this.activeChild&&this.activeChild.Activate(!1),CBase.prototype.Show.call(this,!1,!0,!0),window.currCPage=this.previous||window.baseCPage,this.previous=null,window.currCPage&&window.currCPage!==this&&CBase.prototype.Show.call(window.currCPage,!0,!0,!0)):(window.currCPage&&window.currCPage!==this&&(window.currCPage.activeChild&&window.currCPage.activeChild.Activate(!1),CBase.prototype.Show.call(window.currCPage,!1,!0,!0)),CBase.prototype.Show.call(this,!0,!0,!0),this.previous=previous||null,window.currCPage=this)},CPage.prototype.onClick=function(){return!1},CPage.prototype.EventHandler=function(){},CScrollList.prototype=Object.create(CBase.prototype),CScrollList.prototype.constructor=CScrollList,CScrollList.prototype.Init=function(handle){CBase.prototype.Init.call(this,handle);var self=this;this.handleInner.onmousewheel=function(event){var direction=event.wheelDeltaY>0,found=self.Next(null,direction);return found&&(self.MoveNext(direction?-1:1),self.Focused(found,!0)),event.stopPropagation(),!1}},CScrollList.prototype.Add=function(body,attrs){attrs=attrs||{};var item=element("a",this.defaultParams,body);this.renderMode===this.RENDER_MODE_BULK?this.fragment.appendChild(item):this.handleInner.appendChild(item),attrs.hidden&&this.Hidden(item,!0),attrs.marked&&this.Marked(item,!0),attrs.disabled&&this.Disabled(item,!0),attrs.focused&&this.Focused(item,!0,attrs.manageFocus);for(var name in attrs)attrs.hasOwnProperty(name)&&(item[name]=attrs[name]);return item},CScrollList.prototype.Render=function(){this.fragment.childNodes.length>0&&this.handleInner.appendChild(this.fragment)},CScrollList.prototype.Clear=function(){this.handleInner.innerHTML=null,this.activeItem=null,this.states={}},CScrollList.prototype.Reset=function(item){item&&item.nodeName&&(this.Hidden(item,this.defaultParams.hidden),this.Marked(item,this.defaultParams.marked),this.Disabled(item,this.defaultParams.disabled),this.Focused(item,this.defaultParams.focused),item!==this.activeItem||item.focused||(this.activeItem=null))},CScrollList.prototype.DeleteAll=function(items){var self=this,curPos=null;Array.isArray(items)&&items.length>0&&(null!==document.activeElement&&document.activeElement.parentNode===this.handleInner&&document.activeElement.blur(),-1===items.indexOf(this.Current())?curPos=this.Current():(curPos=this.Next({marked:!1,hidden:!1,disabled:!1}),(null===curPos||curPos===this.Current())&&(curPos=this.Next({marked:!1,hidden:!1,disabled:!1},!0))),items.forEach(function(item){self.Delete(item)}),null!==curPos&&(this.Focused(curPos,!0),this.SetPosition(curPos,!0)))},CScrollList.prototype.Delete=function(item){if(item&&item.nodeName&&item.parentNode===this.handleInner){for(var name in this.states)if(this.states.hasOwnProperty(name)){var index=this.states[name].indexOf(item);-1!==index&&this.states[name].splice(index,1)}item===this.activeItem&&(this.activeItem=null),this.handleInner.removeChild(item)}},CScrollList.prototype.Current=function(){return this.activeItem},CScrollList.prototype.Length=function(){return this.handleInner.children.length+this.fragment.childNodes.length},CScrollList.prototype.SetState=function(item,option,state){if(state=Boolean(state),item[option]!==state){this.states[option]||(this.states[option]=[]);var index=this.states[option].indexOf(item);state?-1===index&&this.states[option].push(item):-1!==index&&this.states[option].splice(index,1);var oldVal=item[option];return item[option]=state,state?item.classList.add(option):item.classList.remove(option),"function"==typeof this.onStateChange&&this.onStateChange(item,option,oldVal,state),!0}return!1},CScrollList.prototype.Hidden=function(item,state){if(state=Boolean(state),item&&item.nodeName){var changed=this.SetState(item,"hidden",state);return changed&&state&&(item.focused&&(this.activeItem=null),this.SetState(item,"marked",!1),this.SetState(item,"focused",!1)),changed}return!1},CScrollList.prototype.Marked=function(item,state){var self=this;return state=Boolean(state),item&&item.nodeName&&!item.disabled&&!item.hidden?(this.multipleSelection===!1&&(this.states.marked||[]).forEach(function(marked){self.SetState(marked,"marked",!1)}),this.SetState(item,"marked",state)):!1},CScrollList.prototype.Disabled=function(item,state){if(state=Boolean(state),item&&item.nodeName){var changed=this.SetState(item,"disabled",state);return changed&&state&&(item.focused&&(this.activeItem=null),this.SetState(item,"marked",!1),this.SetState(item,"focused",!1)),changed}return!1},CScrollList.prototype.Focused=function(item,state,manageFocus){var changed=!1,prevent=!1;return state=state!==!1,void 0===manageFocus&&(manageFocus=this.manageFocus),item&&item.nodeName&&!item.disabled&&!item.hidden&&state!==item.focused&&(state?item!==this.activeItem&&("function"==typeof this.onFocus&&(prevent=this.onFocus(item,this.activeItem)),prevent||(changed=this.SetState(item,"focused",state),this.Focused(this.activeItem,!1,manageFocus),this.activeItem=item,manageFocus!==!1&&this.activeItem.focus())):(changed=this.SetState(item,"focused",state),manageFocus!==!1&&this.activeItem.blur(),this.activeItem=null)),changed},CScrollList.prototype.Activate=function(state,manageFocus){if(void 0===manageFocus&&(manageFocus=this.manageFocus),CBase.prototype.Activate.call(this,state),this.isActive){if(this.activeItem=this.activeItem||this.FindOne(),null===this.activeItem)return!1;this.SetState(this.activeItem,"focused",!0),this.SetPosition(this.activeItem),manageFocus!==!1&&this.activeItem.focus()}else this.activeItem&&this.activeItem.blur();return!0},CScrollList.prototype.Each=function(callback){Array.prototype.forEach.call(this.handleInner.children,callback)},CScrollList.prototype.Find=function(filter,limit,reverse){var match,found=[],items=this.handleInner.children,itlen=items.length,citem=null;filter=filter||this.defaultFilter;for(var i=0;itlen>i;i++){citem=items[reverse?itlen-i-1:i],match=!0;for(var attr in filter)filter.hasOwnProperty(attr)&&(match=match&&citem[attr]===filter[attr]);if(match&&(found.push(citem),limit&&found.length>=limit))break}return found},CScrollList.prototype.FindOne=function(filter,reverse){return this.Find(filter,1,reverse).pop()||null},CScrollList.prototype.Next=function(filter,reverse,nskip,toend){var match,suitable=this.activeItem,pointer=this.activeItem,skipcount=0;if(nskip=nskip||0,pointer)for(filter=filter||this.defaultFilter;pointer=reverse?pointer.previousSibling:pointer.nextSibling;){match=!0;for(var attr in filter)filter.hasOwnProperty(attr)&&(match=match&&pointer[attr]===filter[attr]);if(pointer.hidden||skipcount++,match&&(toend!==!1&&(suitable=pointer),0===nskip||nskip>0&&skipcount>=nskip))return pointer}return suitable},CScrollList.prototype.SetPosition=function(item,makeFocused,manageFocus){var index,page;makeFocused&&(void 0===manageFocus&&(manageFocus=this.manageFocus),this.Focused(item||this.FindOne(),!0,manageFocus)),null!==this.activeItem&&(index=this.activeItem.offsetTop/this.itemHeight,page=Math.floor(index/this.itemsPerPage),1===this.scrollMode?this.handleInner.scrollTop=(index-Math.floor((this.itemsPerPage-1)/2))*this.itemHeight:2===this.scrollMode&&(this.handleInner.scrollTop=this.itemsPerPage*this.itemHeight*page))},CScrollList.prototype.EventHandler=function(event,filter,manageFocus){var found=null;if(void 0===manageFocus&&(manageFocus=this.manageFocus),event.stopped!==!0){switch(event.code){case KEYS.PAGE_UP:case KEYS.PAGE_DOWN:found=this.Next(filter,event.code!==KEYS.PAGE_DOWN,this.itemsPerPage),this.handleInner.scrollTop=this.handleInner.scrollTop+(event.code===KEYS.PAGE_UP?-1:1)*this.itemsPerPage*this.itemHeight;break;case KEYS.LEFT:case KEYS.RIGHT:case KEYS.HOME:case KEYS.END:found=this.FindOne(filter,event.code===KEYS.RIGHT||event.code===KEYS.END);break;case KEYS.UP:case KEYS.DOWN:found=this.Next(filter,event.code===KEYS.UP),this.MoveNext(event.code===KEYS.UP?-1:1);break;case KEYS.OK:return this.activeItem&&this.activeItem.onclick(),void event.preventDefault();default:return}event.preventDefault(),this.Focused(found||this.FindOne(filter),!0,manageFocus)}},CScrollList.prototype.MoveNext=function(direction){null!==this.activeItem&&(1===this.scrollMode?this.handleInner.scrollTop=this.activeItem.offsetTop-Math.floor((this.itemsPerPage-1)/2)*this.itemHeight+direction*this.itemHeight:2===this.scrollMode&&(-1===direction?this.activeItem.offsetTop===this.handleInner.scrollTop&&(this.handleInner.scrollTop=this.handleInner.scrollTop-this.itemsPerPage*this.itemHeight):this.activeItem.offsetTop-this.handleInner.scrollTop===(this.itemsPerPage-1)*this.itemHeight&&(this.handleInner.scrollTop=this.handleInner.scrollTop+this.itemsPerPage*this.itemHeight)))},CScrollList.prototype.onFocus=null,CScrollList.prototype.onStateChange=null,Object.defineProperty(CScrollList.prototype,"itemsPerPage",{get:function(){return this._itemsPerPage?this._itemsPerPage:this._itemsPerPage=Math.round(this.handleInner.offsetHeight/this.handleInner.firstChild.offsetHeight)}}),Object.defineProperty(CScrollList.prototype,"itemHeight",{get:function(){return this.handleInner.firstChild?this.handleInner.firstChild.offsetHeight:0}}),CList.prototype=Object.create(CBase.prototype),CList.prototype.constructor=CList,CList.prototype.SetList=function(list){return Array.isArray(list)?(this.list=list,!0):!1},CList.prototype.InsertToList=function(arr,start,deleteCount){var lastIndex=0,activeItem=this.list[this.listIndex];if(Array.isArray(arr)&&0!==this.list.length){lastIndex=(this.pageIndex+1)*this.onPage-1,start||0===start||(start=this.list.length),deleteCount?this.list.splice(start,deleteCount):deleteCount=0;for(var i=0;i<arr.length;i++)this.list.splice(start+i,0,arr[i]);return lastIndex>=start&&(start<=this.listIndex&&(this.listIndex=this.FindByElement(activeItem),this.RefreshPageIndex()),this.FillItems()),!0}return!1},CList.prototype.DeleteFromList=function(arr){var index=-1,listIndex=this.listIndex,activeItem=this.list[this.listIndex];if(Array.isArray(arr)&&0!==this.list.length){for(var i=0;i<arr.length;i++)index=this.list.indexOf(arr[i]),-1!==index&&(this.list.splice(index,1),listIndex>index&&listIndex--);return index=this.list.indexOf(activeItem),-1===index?(this.listIndex=listIndex,this.listIndex>=this.list.length&&(this.listIndex=this.list.length-1)):this.listIndex=index,this.RefreshPageIndex(),this.FillItems(),!0}return!1},CList.prototype.RefreshPageIndex=function(){var pageIndex=this.pageIndex;return this.pageIndex=Math.floor(this.listIndex/this.onPage),this.itemIndex=this.listIndex%this.onPage,pageIndex!==this.pageIndex},CList.prototype.FindByElement=function(obj){return this.list.indexOf(obj)},CList.prototype.FindByFild=function(value,fild){var index=-1,map=[];return void 0!==value&&(fild||(fild=this.fillsName.data),map=this.list.map(function(item){return item[fild]}),index=map.indexOf(value)),index},CList.prototype.Init=function(handle){CBase.prototype.Init.call(this,handle);var self=this,table=null;table=element("table",{className:"maxh maxw"},element("tr",{},[this.itemsHandle=element("td",{className:"list"}),element("td",{className:"scroll"},this.scrollHandle=element("div"))])),elchild(this.scrollHandle,this.scrollThumb=element("div",{className:"thumb"})),elchild(this.handleInner,table),this.handleInner.onmousewheel=function(event){var direction=event.wheelDeltaY>0,found=direction?self.Prev():self.Next();return found&&self.Focused(found,!0),event.stopPropagation(),!1},this.RenderBody()},CList.prototype.onShow=function(){this.setScroll()},CList.prototype.RenderBody=function(){if(0===this.itemsHandle.children.length||0===this.items.length){this.items=[];for(var i=0;i<this.onPage;i++)this.items[i]=this.fragment.appendChild(element("div",this.defaultParams)),elchild(this.items[i],this.RenderItem());this.itemsHandle.appendChild(this.fragment)}},CList.prototype.RenderItem=function(){return null},CList.prototype.setScroll=function(){var margin=0,percent=0;percent=Math.ceil(this.onPage/this.list.length*100),percent>=100&&(percent=0),margin=Math.ceil(this.scrollHandle.offsetHeight/Math.ceil(this.list.length/this.onPage)*this.pageIndex),this.scrollThumb.style.height=percent+"%",this.scrollThumb.style.marginTop=margin+"px"},CList.prototype.FillItems=function(noFocus){for(var startPos=this.onPage*this.pageIndex,listLength=this.list.length,active=null,list=[],i=0;i<this.onPage;i++)listLength>i+startPos?(this.items[i].innerHTML=this.list[i+startPos][this.fillsName.text],list.push(this.list[i+startPos]),this.list[i+startPos][this.fillsName.data]&&(this.items[i].data=this.list[i+startPos][this.fillsName.data]),this.items[i].index=i+startPos,this.Hidden(this.items[i],!1),i+startPos===this.listIndex&&(active=this.items[i])):(this.items[i].index=-1,this.items[i].data=null,this.Hidden(this.items[i],!0));return this.Reset(active),noFocus||this.Focused(active,!0),this.setScroll(),"function"==typeof this.onFillItems&&this.onFillItems(active,list),active},CList.prototype.onFillItems=null,CList.prototype.Clear=function(){this.list=[],this.pageIndex=0,this.itemIndex=0,this.listIndex=0,this.activeItem=null,this.states={},this.FillItems()},CList.prototype.Reset=function(item){item&&item.nodeName&&(this.Hidden(item,this.defaultParams.hidden),this.Marked(item,this.defaultParams.marked),this.Disabled(item,this.defaultParams.disabled),item!==this.activeItem||item.focused||(this.activeItem=null),this.Focused(item,this.defaultParams.focused))},CList.prototype.Length=function(){return this.list.length},CList.prototype.SetState=function(item,option,state){if(state=Boolean(state),item[option]!==state){this.states[option]||(this.states[option]=[]);var index=this.states[option].indexOf(item);state?-1===index&&this.states[option].push(item):-1!==index&&this.states[option].splice(index,1);var oldVal=item[option];return item[option]=state,state?item.classList.add(option):item.classList.remove(option),"function"==typeof this.onStateChange&&this.onStateChange(item,option,oldVal,state),!0}return!1},CList.prototype.Hidden=function(item,state){if(state=Boolean(state),item&&item.nodeName){var changed=this.SetState(item,"hidden",state);return changed&&state&&(item.focused&&(this.activeItem=null),this.SetState(item,"marked",!1),this.SetState(item,"focused",!1)),changed}return!1},CList.prototype.Marked=function(item,state){var self=this;return state=Boolean(state),item&&item.nodeName&&!item.disabled&&!item.hidden?(this.multipleSelection===!1&&(this.states.marked||[]).forEach(function(marked){self.SetState(marked,"marked",!1)}),this.SetState(item,"marked",state)):!1},CList.prototype.Disabled=function(item,state){if(state=Boolean(state),item&&item.nodeName){var changed=this.SetState(item,"disabled",state);return changed&&state&&(item.focused&&(this.activeItem=null),this.SetState(item,"marked",!1),this.SetState(item,"focused",!1)),changed}return!1},CList.prototype.OnMouseover=function(item){return this.listIndex===item.index?!1:(this.listIndex=item.index,this.RefreshPageIndex(),void this.Focused(item,!0))},CList.prototype.Focused=function(item,state,manageFocus){var changed=!1,prevent=!1;return state=state!==!1,void 0===manageFocus&&(manageFocus=this.manageFocus),item&&item.nodeName&&!item.disabled&&!item.hidden&&state!==item.focused&&(state?item!==this.activeItem&&("function"==typeof this.onFocus&&(prevent=this.onFocus(item,this.activeItem)),prevent||(changed=this.SetState(item,"focused",state),this.Focused(this.activeItem,!1,manageFocus),this.activeItem=item,manageFocus!==!1&&this.activeItem.focus())):(changed=this.SetState(item,"focused",state),manageFocus!==!1&&this.activeItem.blur(),this.activeItem=null)),changed},CList.prototype.Activate=function(state,manageFocus){if(void 0===manageFocus&&(manageFocus=this.manageFocus),CBase.prototype.Activate.call(this,state),this.isActive){if(this.activeItem=this.activeItem||this.ActiveItem(),null===this.activeItem)return!1;this.itemIndex=this.activeItem.index,this.RefreshPageIndex()?this.FillItems():this.SetState(this.activeItem,"focused",!0),manageFocus===!0&&this.activeItem.focus()}else this.activeItem&&this.activeItem.blur();return!0},CList.prototype.ActiveItem=function(){return this.items[this.itemIndex]||null},CList.prototype.ActiveItems=function(){var list=[];return this.items.forEach(function(item){item.disabled||item.hidden||list.push(item)}),list},CList.prototype.Next=function(count){var next=null,endList=!1;return count=count&&count>0?count:1,this.itemIndex+=count,this.listIndex+=count,this.listIndex>=this.list.length&&(this.listIndex=this.list.length-1,endList=!0),next=(this.itemIndex>=this.onPage||endList)&&this.RefreshPageIndex()?this.FillItems(!1):this.items[this.itemIndex],
this.Focused(next,!0),next},CList.prototype.Prev=function(count){var prev=null;return count=count&&count>0?count:1,this.itemIndex-=count,this.listIndex-=count,this.listIndex<0&&(this.listIndex=0),prev=this.itemIndex<0&&this.RefreshPageIndex()?this.FillItems(!1):this.items[this.itemIndex],this.Focused(prev,!0),prev},CList.prototype.SetPosition=function(item,makeFocused){var index=this.items.indexOf(item);return index=-1===index?this.list.indexOf(item):item.index,-1===index||void 0===index?!1:(this.listIndex=index,this.RefreshPageIndex()?this.FillItems():makeFocused&&this.Focused(this.items[this.itemIndex],!0),!0)},CList.prototype.EventHandler=function(event,filter,manageFocus){var found=null;if(void 0===manageFocus&&(manageFocus=this.manageFocus),event.stopped!==!0){switch(event.code){case KEYS.PAGE_UP:this.Prev(this.onPage);break;case KEYS.PAGE_DOWN:this.Next(this.onPage);break;case KEYS.LEFT:case KEYS.HOME:this.Prev(this.list.length);break;case KEYS.RIGHT:case KEYS.END:this.Next(this.list.length);break;case KEYS.UP:this.Prev();break;case KEYS.DOWN:this.Next();break;case KEYS.OK:return this.pressOK(this.ActiveItem()),void event.preventDefault();default:return}event.preventDefault(),this.Focused(found||this.ActiveItem(),!0,manageFocus)}},CList.prototype.pressOK=function(){},CList.prototype.onFocus=null,CList.prototype.onStateChange=null,VScrollBar.prototype.init=function(config){if(config=config||{},DEBUG){if(1!==arguments.length)throw"wrong arguments number";if("object"!=typeof config)throw"wrong config type"}if(void 0!==config.realSize){if(DEBUG&&Number(config.realSize)!==config.realSize)throw"config.realSize value must be a number";this.realSize=config.realSize}if(void 0!==config.viewSize){if(DEBUG){if(Number(config.viewSize)!==config.viewSize)throw"config.viewSize value must be a number";if(config.viewSize<=0)throw"config.viewSize value must be greater than 0"}this.viewSize=config.viewSize}this.viewSize>=this.realSize?this.$body.classList.add("hidden"):this.$body.classList.remove("hidden"),void 0!==config.value&&this.scrollTo(config.value),this.$body.style.height=this.viewSize/this.realSize*100+"%",this.thumbRect=this.$body.getBoundingClientRect(),this.trackRect=this.$node.getBoundingClientRect()},VScrollBar.prototype.scrollTo=function(value){if(DEBUG){if(1!==arguments.length)throw"wrong arguments number";if(Number(value)!==value)throw"value must be a number";if(this.realSize>this.viewSize&&value>this.realSize-this.viewSize)throw"value is greater than this.realSize-this.viewSize";if(0>value)throw"value is less then 0"}return this.value!==value?((0===this.thumbRect.height||0===this.thumbRect.width)&&(this.trackRect=this.$node.getBoundingClientRect(),this.thumbRect=this.$body.getBoundingClientRect()),this.$body.style.marginTop=(this.trackRect.height-this.thumbRect.height)*value/(this.realSize-this.viewSize)+"px",value>=this.realSize&&(value=this.realSize),this.value=value,!0):!1},VList.prototype=Object.create(CBase.prototype),VList.prototype.constructor=VList,VList.prototype.Length=function(){return this.data.length},VList.prototype.renderItem=function($item,attrs){$item.innerText=attrs.name},VList.prototype.focus=function(){this.$body.focus()},VList.prototype.EventHandler=function(event){switch(event.code){case KEYS.UP:case KEYS.DOWN:case KEYS.RIGHT:case KEYS.LEFT:case KEYS.PAGE_UP:case KEYS.PAGE_DOWN:case KEYS.HOME:case KEYS.END:this.move(event.code);break;case KEYS.OK:this.activeItem.onclick()}event.preventDefault()},VList.prototype.Init=function(config){var item,i,self=this,onClick=!1;for(void 0===config.handle?this.handleInner=this.$body=this.$node=document.createElement("div"):this.handleInner=this.$body=this.$node=config.handle,this.size>0&&(this.$body.innerText=null),void 0!==config.onClick&&(onClick=config.onClick),this.$node.classList.add("vlist-main"),i=0;i<this.size;i++)item=document.createElement("a"),item.index=i,onClick&&(item.onclick=onClick),this.$body.appendChild(item);this.$body.addEventListener("mousewheel",function(event){event.wheelDeltaY&&self.move(event.wheelDeltaY>0?KEYS.UP:KEYS.DOWN)}),config.scrollBar&&null===this.scrollBar&&(this.scrollBar=config.scrollBar,this.scrollBar.init({viewSize:self.size,realSize:self.data.length}))},VList.prototype.renderView=function(index){var $item,i,itemData,currIndex;if(this.indexView!==index){for(this.indexView=currIndex=index,i=0;i<this.size;i++)$item=this.$body.children[i],itemData=this.data[index],void 0!==itemData?($item.data=itemData,$item.index=index,this.renderItem($item,itemData),itemData.markable?$item.classList.add("mark"):$item.classList.remove("mark")):($item.data=$item.index=void 0,$item.ready&&($item.$body.innerText="",$item.$body.style.background="")),index++;return null!==this.scrollBar&&this.scrollBar.scrollTo(this.indexView),!0}return!1},VList.prototype.move=function(direction){direction===KEYS.UP&&(this.activeItem&&this.activeItem.index>0?this.activeItem===this.$body.firstChild?this.renderView(this.indexView-1):this.focusItem(this.activeItem.previousSibling):this.onOverflow&&this.onOverflow({direction:direction})),direction===KEYS.DOWN&&(this.activeItem&&this.activeItem.index<this.data.length-1?this.activeItem===this.$body.lastChild?this.renderView(this.indexView+1):this.focusItem(this.activeItem.nextSibling):this.onOverflow&&this.onOverflow({direction:direction})),direction===KEYS.PAGE_UP&&(this.indexView<this.size?this.renderView(0):this.renderView(this.indexView-this.size+1),this.focusItem(this.$body.firstChild)),direction===KEYS.PAGE_DOWN&&(this.data.length>this.size?(this.indexView>this.data.length-2*this.size?this.renderView(this.data.length-this.size):this.renderView(this.indexView+this.size-1),this.focusItem(this.$body.lastChild)):this.focusItem(this.$body.children[this.data.length-1])),(direction===KEYS.HOME||direction===KEYS.LEFT)&&(this.renderView(0),this.focusItem(this.$body.firstChild)),(direction===KEYS.END||direction===KEYS.RIGHT)&&(this.data.length>this.size?(this.renderView(this.data.length-this.size),this.focusItem(this.$body.lastChild)):this.focusItem(this.$body.children[this.data.length-1]))},VList.prototype.focusItem=function($item){var $prev=this.activeItem;return void 0!==$item&&$prev!==$item?(null!==$prev&&$prev.classList.remove("focused"),this.activeItem=$item,this.activeItem.data=this.data[this.activeItem.index],$item.classList.add("focused"),!0):!1},VList.prototype.Add=function(name,attrs,states){var prop;if(attrs.name=name,states)for(prop in states)attrs.prop=states[prop];this.data.push(attrs)},VList.prototype.Clear=function(){this.data=[]},VList.prototype.SetState=function(item,option,state){if(state=!!state,item[option]!==state){this.states[option]||(this.states[option]=[]);var index=this.states[option].indexOf(item);return state?-1===index&&this.states[option].push(item):-1!==index&&this.states[option].splice(index,1),item[option]=state,!0}return!1},VList.prototype.Render=function(){this.indexView=-1,this.renderView(0),this.focusItem(this.$body.firstChild)},VList.prototype.Next=function(){return this.data[this.activeItem.index+1]},VList.prototype.Current=function(){return this.activeItem},VList.prototype.SetPosition=function(data,manageFocus){var i,viewIndex,index=this.data.indexOf(data);return-1===index||void 0===index?!1:(this.indexView=-1,i=data.index||0,i<this.size?viewIndex=0:i>this.data.length-this.size&&(viewIndex=this.data.length-this.size,i-=viewIndex),this.renderView(viewIndex),manageFocus&&this.focusItem(this.$body.children[i]),!0)},VList.prototype.Each=function(callback){this.data.forEach(callback)},CGroupMenu.prototype=Object.create(CBase.prototype),CGroupMenu.prototype.constructor=CGroupMenu,CGroupMenu.prototype.Init=function(handle){CBase.prototype.Init.call(this,handle),this.handle.onclick=function(event){event.stopPropagation()}},CGroupMenu.prototype.GetGroup=function(gid){for(var i=0,items=this.handleInner.children,length=items.length;length>i;i++)if(items[i].gid===gid)return items[i];return!1},CGroupMenu.prototype.AddGroup=function(gid,title,options){var self=this;if(gid&&!this.GetGroup(gid)){var aleft,aright,hlist=element("div",{className:"cslist-main"}),group=element("table",{gid:gid,slist:new CScrollList,options:options||{}},[element("tr",{className:"title"},[element("td",{className:"side",onclick:function(){self.Switch(self.Next({hidden:!1},!0),!0)}},aleft=element("p")),element("td",null,title),element("td",{className:"side",onclick:function(){self.Switch(self.Next({hidden:!1}),!0)}},aright=element("p"))]),element("tr",{className:"ilist"},element("td",{colSpan:3},hlist))]);return group.options.hidden=group.options.hidden?!0:!1,group.slist.Init(hlist),group.aleft=aleft,group.aright=aright,elchild(this.handleInner,group),group}return!1},CGroupMenu.prototype.Hidden=function(group,state){group&&group.nodeName&&(group.options.hidden=state)},CGroupMenu.prototype.AddItem=function(group,iid,body,options){return options=options||{},options.iid=iid,group.options.onclick&&!options.onclick&&(options.onclick=group.options.onclick),options.icon&&(body=element("div",{className:"short"},body),body.style.backgroundImage='url("'+options.icon+'")',body.style.backgroundPosition="right",body.style.backgroundRepeat="no-repeat"),group.slist.Add(body,options)},CGroupMenu.prototype.ApplyArrows=function(){this.activeGroup.aright.className=this.Next({hidden:!1})?"active":"",this.activeGroup.aleft.className=this.Next({hidden:!1},!0)?"active":""},CGroupMenu.prototype.Switch=function(group,activate){return group&&group.gid&&group.nodeName?(this.activeGroup&&(this.activeGroup.slist.Activate(!1),this.activeGroup.style.display="none"),this.activeGroup=group,this.activeGroup.style.display="table",activate&&(this.activeGroup.slist.Activate(),this.autoFocus&&Array.isArray(this.activeGroup.slist.states.marked)&&this.activeGroup.slist.Focused(this.activeGroup.slist.states.marked[0],!0)),this.ApplyArrows(),!0):!1},CGroupMenu.prototype.Activate=function(active,setFocus){var status=!1;return null!==this.activeGroup&&(status=this.activeGroup.slist.Activate(active,setFocus)),this.autoFocus&&Array.isArray(this.activeGroup.slist.states.marked)&&this.activeGroup.slist.Focused(this.activeGroup.slist.states.marked[0],!0),status},CGroupMenu.prototype.Next=function(filter,reverse){var match,pointer=this.activeGroup;if(pointer)for(;pointer=reverse?pointer.previousSibling:pointer.nextSibling;){match=!0;for(var attr in filter)filter.hasOwnProperty(attr)&&(match=match&&pointer.options[attr]===filter[attr]);if(match)return pointer}return null},CGroupMenu.prototype.EventHandler=function(event){switch(event.code){case KEYS.LEFT:this.Switch(this.Next({hidden:!1},!0),!0);break;case KEYS.RIGHT:this.Switch(this.Next({hidden:!1}),!0);break;default:this.activeGroup.slist.EventHandler(event)}};var CMODAL_IMG_PATH=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/";CModal.prototype=Object.create(CPage.prototype),CModal.prototype.constructor=CModal,CModal.prototype.Init=function(body){CPage.prototype.Init.call(this,element("div",{className:this.baseClass},element("div",{className:"cmodal-cell"},body)));var owner=this.parent&&this.parent.handle&&this.parent.handle.nodeName?this.parent.handle:document.body;this.parent instanceof CModal&&this.parent.parent&&(owner=this.parent.parent.handle),owner.appendChild(this.handle)},CModal.prototype.Free=function(){this.handle&&this.handle.parentNode&&this.handle.parentNode.removeChild(this.handle),elclear(this.handle)},CModal.prototype.Show=function(visible,manageFocus){CBase.prototype.Show.call(this,visible,manageFocus!==!1),currCPage=visible===!1?this.parent:this},CModal.prototype.FocusPrev=function(event,manageVK){if(this.focusList.length>0){--this.focusPos<0&&(this.focusPos=this.focusList.length-1);var el=this.focusList[this.focusPos];manageVK!==!1&&gSTB.HideVirtualKeyboard(),el.focus(),event&&"INPUT"===el.tagName&&"text"===el.type&&(event.preventDefault(),manageVK!==!1&&gSTB.ShowVirtualKeyboard())}},CModal.prototype.FocusNext=function(event,manageVK){if(this.focusList.length>0){++this.focusPos>=this.focusList.length&&(this.focusPos=0);var el=this.focusList[this.focusPos];manageVK!==!1&&gSTB.HideVirtualKeyboard(),el.focus(),event&&"INPUT"===el.tagName&&"text"===el.type&&(event.preventDefault(),manageVK!==!1&&gSTB.ShowVirtualKeyboard())}},CModalBox.prototype=Object.create(CModal.prototype),CModalBox.prototype.constructor=CModalBox,CModalBox.prototype.SetData=function(place,data){return elclear(place),data instanceof Node||Array.isArray(data)?elchild(place,data):place.innerHTML=data,data&&data.nodeName&&(data.style.display="block"),place.style.display=data?"block":"none",place},CModalBox.prototype.SetHeader=function(data){return this.SetData(this.header,data||"")},CModalBox.prototype.SetContent=function(data){return this.SetData(this.content,data||"")},CModalBox.prototype.SetFooter=function(data){return this.SetData(this.footer,data||"")},CModalBox.prototype.Init=function(){CModal.prototype.Init.call(this,element("div",{className:"cmodal-body"},[this.header,this.content,this.footer]))},CModalHint.prototype=Object.create(CModalBox.prototype),CModalHint.prototype.constructor=CModalHint,CModalAlert.prototype=Object.create(CModalBox.prototype),CModalAlert.prototype.constructor=CModalAlert,CModalConfirm.prototype=Object.create(CModalAlert.prototype),CModalConfirm.prototype.constructor=CModalConfirm,CButtonPanel.prototype=Object.create(CBase.prototype),CButtonPanel.prototype.constructor=CButtonPanel,CButtonPanel.prototype.Init=function(path,handle){this.path=path,handle&&handle.nodeName?CBase.prototype.Init.call(this,handle):CBase.prototype.Init.call(this,element("div",{className:"cbpanel-main"}))},CButtonPanel.prototype.Add=function(code,icon,text,callback,hidden){var html=null,self=this,func=function(){self.isActive&&"function"==typeof callback&&(gSTB.HideVirtualKeyboard(),callback(code))};text&&(html=element("div",{className:"cbpanel-text",onclick:func}),html.innerHTML=text);var item=element("div",{className:"cbpanel-item",data:{code:code,onclick:func}},[element("img",{className:"cbpanel-icon",onclick:func,src:this.path+"/"+icon}),html]);return item.$name=html,this.Hidden(item,hidden||!1),elchild(this.handleInner,item),item},CButtonPanel.prototype.Hidden=function(item,state){item&&item.nodeName&&item.data.hidden!==state&&(item.data.hidden=state,item.style.display=state?"none":"table-cell")},CButtonPanel.prototype.SetName=function(item,name){var html=null;item&&item.nodeName&&name&&(item.$name?this.Rename(item,name):(html=element("div",{className:"cbpanel-text",onclick:item.data.onclick}),html.innerHTML=name,item.$name=html,item.appendChild(html)))},CButtonPanel.prototype.Rename=function(item,name){item&&item.nodeName&&(item.$name.innerHTML=name)},CButtonPanel.prototype.Activate=function(active){this.isActive=active!==!1},CButtonPanel.prototype.EventHandler=function(event){if(event.stopped!==!0&&this.isActive)for(var data,i=0,items=this.handleInner.children,length=items.length;length>i;i++)if(data=items[i].data,!data.hidden&&data.code===event.code&&"function"==typeof data.onclick)return void(data.onclick()&&event.preventDefault())},CButtonPanel.prototype.onClick=function(){return!1},CBreadCrumb.prototype=Object.create(CBase.prototype),CBreadCrumb.prototype.constructor=CBreadCrumb,CBreadCrumb.prototype.Init=function(path,handle,leftItems,rightItems){this.path=path,CBase.prototype.Init.call(this,handle),this.dom={},elchild(this.handleInner,[this.dom.list=element("div",{className:"cbcrumb-list"}),this.dom.name=element("div",{className:"cbcrumb-name"})]),this.leftItems=leftItems||this.leftItems,this.rightItems=rightItems||this.rightItems},CBreadCrumb.prototype.SetName=function(text){elclear(this.dom.name),elchild(this.dom.name,element("div",{innerHTML:text,className:"cbcrumb-name-text"})),this.DrawName()},CBreadCrumb.prototype.DrawName=function(){this.dom.name.style.display=1===this.dom.list.children.length?"table-cell":"none"},CBreadCrumb.prototype.Push=function(path,icon,text,iid){var last=this.dom.list.lastChild;last&&(last.className="cbcrumb-item");var item=element("div",{className:"cbcrumb-item active",onclick:null,path:path},[icon?element("img",{className:"cbcrumb-icon",onclick:null,src:this.path+icon}):null,text?element("div",{className:"cbcrumb-text",onclick:null},text):null]);return iid&&(item.iid=iid),this.dom.list.children.length===this.leftItems&&elchild(this.dom.list,element("div",{className:"cbcrumb-item divider"},". . .")),elchild(this.dom.list,item),this.dom.list.children.length>this.leftItems+this.rightItems+1&&(this.dom.list.children[this.leftItems].style.display="table-cell",this.dom.list.children[this.dom.list.children.length-this.rightItems-1].style.display="none"),this.DrawName(),item},CBreadCrumb.prototype.Pop=function(){var item=this.dom.list.lastChild;return item&&(this.dom.list.removeChild(item),this.dom.list.children.length===this.leftItems+1?this.dom.list.removeChild(this.dom.list.lastChild):this.dom.list.children.length>this.leftItems+this.rightItems&&(this.dom.list.children[this.dom.list.children.length-this.rightItems].style.display="table-cell"),this.dom.list.children.length===this.leftItems+this.rightItems+1&&(this.dom.list.children[this.leftItems].style.display="none"),this.dom.list.lastChild&&(this.dom.list.lastChild.className="cbcrumb-item active"),this.DrawName()),item},CBreadCrumb.prototype.Tip=function(){return this.dom.list.lastChild},CBreadCrumb.prototype.Reset=function(){elclear(this.dom.list),this.DrawName()},CBreadCrumb.prototype.onClick=function(){return!1},CSearchBar.prototype=Object.create(CBase.prototype),CSearchBar.prototype.constructor=CSearchBar,CSearchBar.prototype.Init=function(path,handle,hint){this.path=path,this.hint=hint||"";var self=this,func=function(){self.Activate(!self.isActive),event.stopPropagation()};CBase.prototype.Init.call(this,handle),this.items.hint=element("input",{type:"text",className:"hint maxw",value:this.hint}),this.items.text=element("input",{type:"text",className:"text maxw",oninput:function(){self.onChange&&self.onChange(this.value)},onkeydown:function(event){self.EventHandler(event)}}),this.items.span=element("div",{className:"csbar-item span"}),this.items.icon=element("div",{className:"csbar-item icon",onclick:func},element("img",{className:"",src:this.path+this.icoSearch})),this.items.button=element("div",{className:"csbar-item icon",onclick:func},element("img",{className:"",src:this.path+"f2.png"})),this.items.input=element("div",{className:"csbar-item stext"},[this.items.hint,this.items.text]),elchild(this.handleInner,[this.items.input,this.items.span,this.items.icon,this.items.button])},CSearchBar.prototype.ShowInput=function(visible,manageFocus){visible=visible!==!1,visible||(this.items.text.blur(),gSTB.HideVirtualKeyboard(),manageFocus!==!1&&this.prevFocus&&this.prevFocus.focus()),this.items.input.style.display=visible?"table-cell":"none",this.items.span.style.display=visible?"none":"table-cell",visible&&(this.prevFocus=document.activeElement,this.items.text.focus(),gSTB.ShowVirtualKeyboard())},CSearchBar.prototype.Reset=function(){this.Activate(!1),this.items.text.value=this.items.hint.value=this.hint=this.filter="",this.items.icon.lastChild.src=this.path+"/"+this.icoSearch},CSearchBar.prototype.onSearch=null,CSearchBar.prototype.onHint=null,CSearchBar.prototype.onChange=null,CSearchBar.prototype.SetHint=function(hint){hint=hint||this.items.text.value||this.hint,hint&&(this.items.hint.value=hint)},CSearchBar.prototype.SetValue=function(text){this.filter=text,this.items.text.value=this.filter},CSearchBar.prototype.EventHandler=function(event){switch(event.code){case KEYS.LEFT:case KEYS.RIGHT:case KEYS.UP:case KEYS.DOWN:return;case KEYS.EXIT:this.Activate(!1),event.stopPropagation();break;case KEYS.F2:this.Activate(!this.isActive),event.stopPropagation();break;case KEYS.OK:this.Activate(!1),"function"==typeof this.onSearch&&this.onSearch(this.items.text.value),this.items.icon.firstChild.src=this.items.text.value?this.path+"/"+this.icoFilter:this.path+"/"+this.icoSearch,event.stopPropagation();break;default:if(this.items.hint.value=""===this.items.text.value?this.hint:"","function"==typeof this.onHint){this.items.hint.value===this.hint&&this.SetHint(" "),this.timer&&clearTimeout(this.timer);var self=this;this.timer=setTimeout(function(){self.onHint.call(self,self.items.text.value)},300)}}},CSearchBar.prototype.Activate=function(active,manageFocus){active||this.ShowInput(!1,manageFocus),CBase.prototype.Activate.call(this,active),active&&this.ShowInput(!0,manageFocus)};var globalBuffer=function(){var data=[],mode=1,place={};return{MODE_COPY:1,MODE_CUT:2,onPaste:null,add:function(item){return-1===data.indexOf(item)?(data.push(item),!0):!1},paste:function(func){var self=this;data.forEach(function(item){func(item)&&"function"==typeof self.onPaste&&self.onPaste(item)}),this.clear()},mode:function(newMode){return void 0!==newMode&&(mode=newMode),mode},place:function(newPlace){return void 0!==newPlace&&(place=newPlace),place},size:function(){return data.length},remove:function(item){if(void 0!==item){var index=data.indexOf(item);if(-1!==index)return 1===data.splice(index,1).length}return!1},clear:function(){data=[],place={},this.onPaste=null}}}();CCheckBox.prototype=Object.create(CBase.prototype),CCheckBox.prototype.constructor=CCheckBox,CCheckBox.DefaultAttributes={checkbox:{type:"checkbox",className:"ccheck-box-input"},label:{className:"ccheck-box-label"},wrapper:{className:"ccheck-box-wrapper",tabIndex:"1"}},CCheckBox.prototype.onInit=function(){void 0!==this.parameters.element&&"INPUT"===this.parameters.element.nodeName&&"checkbox"===this.parameters.element.type&&(this.parameters.element.parentNode.removeChild(this.parameters.element),this.checkbox=this.parameters.element,elattr(this.checkbox,extend(CCheckBox.DefaultAttributes.checkbox,this.parameters.attributes.checkbox,!0))),void 0===this.checkbox&&(this.checkbox=this.generateCheckbox()),this.wrapper=this.generateWrapper(this.checkbox),this.wrapper.className+=" "+this.style,this.parameters.checked===!0&&this.Check(!0,!0),elchild(this.handleInner,this.wrapper)},CCheckBox.prototype.generateCheckbox=function(){var self=this,attrs=extend(CCheckBox.DefaultAttributes.checkbox,this.parameters.attributes.checkbox,!0);return void 0===attrs.id&&(attrs.id=CCheckBox.GenerateId()),attrs.onchange=function(){self.checked=this.checked,self.trigger("onChange",arguments)},attrs.onclick=function(){self.Check(!self.IsChecked())},element("input",attrs)},CCheckBox.prototype.generateWrapper=function(checkbox,label){var self=this;if(void 0===this.checkbox)throw"Checkbox must be created before label";return this.label=element("label",extend({htmlFor:this.checkbox.id},CCheckBox.DefaultAttributes.label)),this.label.onclick=function(){self.Check(!self.IsChecked())},element("div",CCheckBox.DefaultAttributes.wrapper,[checkbox,label||this.label])},CCheckBox.GenerateId=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},CCheckBox.prototype.Check=function(checked,block_event){this.checked=this.checkbox.checked=checked===!0,block_event!==!0&&this.trigger("onChange")},CCheckBox.prototype.IsChecked=function(){return this.checkbox.checked===!0},CCheckBox.prototype.EventHandler=function(event){switch(event.code){case KEYS.LEFT:case KEYS.RIGHT:this.Check(event.code===KEYS.LEFT),event.stopped=!0}},CCheckBox.prototype.focus=function(){this.wrapper.focus()},Events.inject(CCheckBox);var CINPUT_IMG_PATH=PATH_IMG_PUBLIC;CInput.prototype=Object.create(CBase.prototype),CInput.prototype.constructor=CInput,CInput.prototype.GenerateHandle=function(){var i,icon,attrs,changed,self=this;if(this.row=element("tr"),void 0!==this.parameters.hint&&(this.DefaultHint=this.attributes.hint.value=this.parameters.hint,this.hint=element("input",extend(this.attributes.input,this.attributes.hint,!1))),void 0===this.parameters.input?(void 0!==this.parameters.value&&(this.attributes.input.value=this.parameters.value,this.SetDefault(this.parameters.value)),elchild(this.row,element("td",this.attributes["text-wrapper"],[this.input=element("input",this.attributes.input),this.hint||""]))):(this.input=this.parameters.input,this.input.parentNode.removeChild(this.input),this.input.className+=this.attributes.input.className,elchild(this.row,element("td",{},element("div",this.attributes["text-wrapper"],[this.input,this.hint||""]))),""!==this.input.value&&(this.ShowHint(!1),this.SetDefault(this.input.value))),this.input.oninput=function(e){changed=!1,self.trigger("onChange",e),""!==self.GetValue()?self.ShowHint(!1):(self.SetHint(self.DefaultHint),self.ShowHint(!0))},this.input.onblur=function(){""!==self.GetValue()?self.ShowHint(changed):(self.SetHint(self.DefaultHint),self.ShowHint(!0))},void 0!==this.parameters.icons)for(i=0;i<this.parameters.icons.length;i++)icon=this.parameters.icons[i],attrs=extend({},this.attributes.icon),attrs.className+=" "+(icon.style||""),this.AddIcon(icon,attrs);return element("table",this.attributes.wrapper,this.row)},CInput.prototype.SetAutocomplete=function(autocomplete){this.autocomplete=autocomplete},CInput.prototype.onInit=function(){},CInput.prototype.ShowIcon=function(name,show){void 0!==this.icons[name]&&(this.icons[name].parentNode.style.display=show===!0?"table-cell":"none")},CInput.prototype.ApplyHint=function(){this.SetValue(this.GetHint())},CInput.prototype.AddIcon=function(icon,attrs){var self=this,iconFile=null,attributes=extend(icon.attributes,{}),remoteControlButtonsImagesPath=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/";iconFile=void 0!==icon.src?icon.src:icon.name?icon.name+".png":null,"f4.png"===iconFile?iconFile&&(attributes.src=(this.parameters.icons_path||remoteControlButtonsImagesPath)+iconFile):iconFile&&(attributes.src=(this.parameters.icons_path||CINPUT_IMG_PATH)+iconFile),element("td",attrs||this.attributes.icon,this.icons[icon.name]=element("img",attributes)),"left"===icon.type?this.row.insertBefore(this.icons[icon.name].parentNode,this.row.firstChild):this.row.appendChild(this.icons[icon.name].parentNode),"function"==typeof icon.click&&(this.icons[icon.name].onclick=function(event){icon.click.call(self,event)})},CInput.prototype.RemoveIcon=function(icon_name){void 0!==this.icons[icon_name]&&this.row.removeChild(this.icons[icon_name].parentNode)},CInput.prototype.SetValue=function(value,siltent){this.input.value=value,this.ShowHint(""===value),siltent!==!0&&(this.trigger("onChange"),this.input.oninput())},CInput.prototype.GetValue=function(){return this.input.value},CInput.prototype.SetHint=function(hint){return void 0!==this.hint?(this.hint.value=hint,this.hint.value):void 0},CInput.prototype.GetHint=function(){return void 0!==this.hint?this.hint.value:void 0},CInput.prototype.ShowHint=function(show){void 0!==this.hint&&(this.hint.style.display=show===!0?"block":"none")},CInput.prototype.Fold=function(fold,manage_focus,stop_event){fold===!0?(-1===this.handle.className.indexOf("folded")&&(this.handle.className+=" "+this.FoldedClass,stop_event!==!0&&this.trigger("onFold"),manage_focus===!0&&this.blur()),gSTB.HideVirtualKeyboard()):(this.handle.className=this.handle.className.replace(this.FoldedClass,""),stop_event!==!0&&this.trigger("onUnfold"),manage_focus===!0&&(this.focus(),gSTB.ShowVirtualKeyboard()))},CInput.prototype.Reset=function(){this.Fold(this.parameters.folded===!0,!0),this.SetValue(this.GetDefault(),!0)},CInput.prototype.focus=function(){this.input.focus()},CInput.prototype.blur=function(){this.input.blur()},CInput.prototype.select=function(){this.input.select()},CInput.prototype.IsFolded=function(){return-1!==this.handle.className.indexOf(this.FoldedClass)},CInput.prototype.IsFocused=function(){return this.input===document.activeElement},CInput.prototype.EventHandler=function(){},Events.inject(CInput),CFilterInput.prototype=Object.create(CInput.prototype),CFilterInput.prototype.constructor=CFilterInput,CFilterInput.prototype.EventHandler=function(event){eventPrepare(event,!0,"CFilterInput");var event_res=!1;if(this.trigger("onEvent",event)[0]===!0)return!0;switch(event.code){case KEYS.F4:this.Fold(!this.IsFolded(),!0),event_res=this.trigger("onKey")[0];break;case KEYS.EXIT:if(!this.IsFolded())return this.Fold(!0,!0),this.trigger("onExit"),!0;break;case KEYS.OK:this.IsFolded()||(event_res=this.trigger("onEnter")[0],echo(event_res,"onEnter"),this.Fold(!0,!0),event.preventDefault());break;case KEYS.CHANNEL_NEXT:case KEYS.CHANNEL_PREV:event.preventDefault()}return this.IsFolded()!==!0||event_res===!0?!0:void 0},CSimpleSelect.prototype=Object.create(CBase.prototype),CSimpleSelect.prototype.constructor=CSimpleSelect,CSimpleSelect.prototype.GenerateHandle=function(){var wrapper,content_wrapper,self=this;return void 0!==this.parameters.content&&"DIV"===this.parameters.content.tagName?(this.content=this.parameters.content,this.content.parentNode.removeChild(this.content),void 0!==this.content.className&&(this.attributes.content.className+=" "+this.content.className),this.content=element("div",this.attributes.content,this.content||"")):(void 0!==this.parameters.content&&"DIV"!==this.parameters.content.tagName&&(this.content=this.parameters.content),this.content=element("div",this.attributes.content,this.content||"")),content_wrapper=element("div",this.attributes.content_wrapper,[this.content,this.hint=element("div",this.attributes.hint)]),this.parameters.leftArrow?(this.leftArrow=this.parameters.leftArrow,this.leftArrow.parentNode.removeChild(this.leftArrow),this.leftArrow=element("div",this.attributes.left_arrow,this.leftArrow)):this.leftArrow=element("div",this.attributes.left_arrow,this.leftArrow||element("p")),this.parameters.rightArrow?(this.rightArrow=this.parameters.rightArrow,this.rightArrow.parentNode.removeChild(this.rightArrow),this.rightArrow=element("div",this.attributes.right_arrow,this.rightArrow)):this.rightArrow=element("div",this.attributes.right_arrow,this.rightArrow||element("p")),wrapper=element("div",this.attributes.wrapper,element("div",{className:"content-wrapper",onfocus:function(){}},[this.leftArrow,content_wrapper,this.rightArrow])),wrapper.className+=" "+this.style,void 0!==this.parameters.width&&(wrapper.style.width=this.parameters.width),this.leftArrow.onclick=function(event){self.disabled||(self.Previous(),event.stopPropagation(),event.preventDefault())},this.rightArrow.onclick=function(event){self.disabled||(self.Next(),event.stopPropagation(),event.preventDefault())},wrapper},CSimpleSelect.prototype.onInit=function(){var self=this;elchild(this.parentNode,this.handle),this.handle.component=this,this.handle.onblur=function(){self.trigger("onBlur")},this.handle.onfocus=function(){self.trigger("onFocus")}},CSimpleSelect.prototype.EventHandler=function(event){if(eventPrepare(event,!0,"CSimpleSelect"),this.disabled!==!0)switch(event.stopped=!0,event.code){case KEYS.LEFT:this.Previous();break;case KEYS.RIGHT:this.Next();break;default:event.stopped=!1}},CSimpleSelect.prototype.SetContent=function(content,placeholder){void 0===content&&placeholder&&(content=placeholder,this.content.classList.add("placeholder")),this.content.innerHTML="",this.content.innerHTML=content},CSimpleSelect.prototype.DisableElement=function(element,disable){disable===!0?-1===element.className.indexOf("disabled")&&(element.className+=" disabled"):element.className=element.className.replace(" disabled","")},CSimpleSelect.prototype.SetHint=function(hint){this.hint.innerHTML=hint},CSimpleSelect.prototype.Next=function(){},CSimpleSelect.prototype.Previous=function(){this.autocomplete=""},CSimpleSelect.prototype.focus=function(){this.handle.focus()},CSimpleSelect.prototype.blur=function(){this.handle.blur()},CSimpleSelect.prototype.IsFocused=function(){return document.activeElement===this.handle},CSimpleSelect.prototype.Disable=function(disable){this.DisableElement(this.handle,this.disabled=disable===!0)},Events.inject(CSimpleSelect),CSelectBox.prototype=Object.create(CSimpleSelect.prototype),
CSelectBox.prototype.constructor=CSelectBox,CSelectDropdown.prototype=Object.create(CScrollList.prototype),CSelectDropdown.prototype.constructor=CSelectDropdown,CSelectDropdown.parameters=["scrollMode","select","container"],CSelectDropdown.prototype.Refresh=function(){var el,i,self=this,data=this.select.GetData();for(this.Clear(),i=0;i<data.length,el=data[i];i++)"object"==typeof el&&(el=el[this.select.GetNameField()]),this.Add(element("div",extend(this.attributes.element,{innerHTML:el})),{onclick:function(){self.select.SetIndex(self.activeItem.index),self.Marked(self.activeItem,!0),self.Show(!1,self.manageFocus)},index:i})},CSelectDropdown.prototype.onShow=function(){this.UpdateGeometry();var item=this.handleInner.children[this.select.GetIndex()];this.SetPosition(item,!0,!1),this.Focused(item,!0),this.Marked(item,!0)},CSelectDropdown.prototype.UpdateGeometry=function(){var containerRect,inputRect=this.base.getBoundingClientRect(),top=this.base.offsetTop+inputRect.height,height=WINDOW_HEIGHT;void 0!==this.container&&(containerRect=this.container.getBoundingClientRect(),height=containerRect.top+containerRect.height),inputRect.top+inputRect.height+this.itemHeight*this.itemsPerPage>height&&(top=this.base.offsetTop-this.itemHeight*this.itemsPerPage),1===this.scrollMode&&(top-=this.itemHeight*Math.abs(Math.floor(this.itemsPerPage/2*-1))),this.handle.style.top=top+"px",this.handle.style.left=this.base.offsetLeft+"px",this.handle.style.width=inputRect.width-2*parseInt(document.defaultView.getComputedStyle(this.handle,"")["border-left-width"])+"px"},Events.inject(CSelectDropdown),CIntervalBox.prototype=Object.create(CSimpleSelect.prototype),CIntervalBox.prototype.constructor=CIntervalBox;var CLog=function(parent,options){var self=this;CBase.call(this,parent||null),this.newest=!1,CLog.parameters.forEach(function(option){void 0!==options[option]&&(self[option]=options[option])}),this.bind(options.events||{}),this.Init(element("div",{className:"clog"},this.$log=element("ul",{})))};CLog.parameters=["time","autofocus","parentNode","events","defaultType","newest","isVisible"],CLog.prototype=Object.create(CBase.prototype),CLog.prototype.constructor=CLog,CLog.prototype.onInit=function(){elchild(this.parentNode,this.handle)},CLog.prototype.onShow=function(){this.autofocus===!0&&0!==this.$log.childElementCount&&this.$log.lastElementChild.focus(),this.trigger("onShow")},CLog.prototype.onHide=function(){this.trigger("onHide")},CLog.prototype.Add=function(message,type){if(this.newest===!1||this.newest===!0&&this._lastMessage!==message){this._lastMessage=message;var currTime=new Date,$data=[element("span",{className:"message"},message)];this.time===!0&&$data.push(element("span",{className:"time"},("0"+currTime.getHours()).slice(-2)+":"+("0"+currTime.getMinutes()).slice(-2)+":"+("0"+currTime.getSeconds()).slice(-2))),elchild(this.$log,element("li",{className:type||this.defaultType,tabIndex:"1"},$data)),this.autofocus===!0&&this.$log.lastElementChild.focus(),this.trigger("onAdd")}},Events.inject(CLog);var MODAL_IMG_PATH=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/",CUpdateModal=function(parent,options){var self=this;CModalBox.call(this,parent||null),this.isVisible=!1,this.name="CUpdateModal",this.baseClass="cmodal-main cupdate-modal",this.$status=element("td",{className:"right"}),this.F1_func=null,this.Info_func=null,this.image_info={},CUpdateModal.parameters.forEach(function(option){void 0!==options[option]&&(self[option]=options[option])}),this.bind(this.events),this.bpanel=new CButtonPanel,this.bpanel.Init(MODAL_IMG_PATH),this.Exit_btn=this.bpanel.Add(KEYS.EXIT,"exit.png",_("Cancel"),function(){self.Update.Clear(),self.Show(!1)},this.auto===!0),this.Info_btn=this.bpanel.Add(KEYS.INFO,"info.png",_("Show log"),function(){self.Info_func()},this.log!==!0),this.OK_btn=this.bpanel.Add(KEYS.F1,"f1.png",_("Update"),function(){self.F1_func()},!0),this.ProgressBar=new CProgressBar(this,element("div")),this.SetHeader(this.header_text),this.SetFooter(this.bpanel.handle),this.EventHandler=function(event){eventPrepare(event),void 0!==self.select&&"function"==typeof self.select.EventHandler&&self.select.EventHandler(event),self.bpanel.EventHandler(event)},this.Init()};CUpdateModal.parameters=["update_url","check","auto","images","log","select","header_text","info","events","warning"],CUpdateModal.prototype=Object.create(CModalBox.prototype),CUpdateModal.prototype.constructor=CUpdateModal,CUpdateModal.prototype.onHide=function(){this.trigger("onHide")},CUpdateModal.prototype.onShow=function(){this.trigger("onShow")},CUpdateModal.prototype.onInit=function(){var self=this;this.Update=new Update({onReady:function(){self.image_info=self.Update.GetImageInfo(),self.image_description=self.image_info.description,self.image_date=self.image_info.date,self.auto===!0?self.UpdateStart():self.ImageSelect(),self.trigger("onReady")},onCheck:function(data){self._addLogMessage(data.logMessage),self.$status.innerHTML=data.statusMessage,self.$status.className="right",self.trigger("onCheck",data),self.bpanel.Rename(self.OK_btn,_("Update"))},onError:function(data){self._addLogMessage(data.logMessage,"error"),self.bpanel.Hidden(self.OK_btn,!1),self.bpanel.Hidden(self.Exit_btn,!1),self.bpanel.Rename(self.OK_btn,_("Retry")),self.bpanel.Rename(self.Exit_btn,_("Exit")),self.$status.innerHTML=data.errorMessage,self.$status.classList.add("error"),self.trigger("onError",data)},onProgress:function(data){self._addLogMessage(data.logMessage),self.$status.innerHTML=data.statusMessage,self.ProgressBar.SetProgress(data.percent),self.trigger("onProgress",data)},onStart:function(){self.trigger("onStart"),self.UpdateStart(),CModalBox.prototype.Show.call(self,!0)}}),this.log===!0&&(this.log=new CLog(document.body,{autofocus:!0,time:!0,newest:!0,defaultType:"success",isVisible:!1,events:{onShow:function(){self.$status.parentNode.style.display="none"},onHide:function(){self.$status.parentNode.style.display=""}}})),this.curr_info=this.Update.GetCurrentImageInfo(),"string"==typeof this.update_url?this.check=!0:Array.isArray(this.images)&&(this.check=!1,this.image_description=cutTextWithEllipsis(this.images[0].descr.split("").join("​"),200),this.image_date=new Date(this.images[0].date),this.select===!0&&this.images.length>1?(this.select=new CSelectBox(this,{parent:this.new_version=element("div"),data:this.images,nameField:"title",idField:"url",events:{onChange:function(){self.$curr_update_descr.innerHTML=cutTextWithEllipsis(this.GetSelected().descr.split("").join("​"),200),self.update_url=this.GetValue(),self.$curr_update_date.innerHTML=new Date(this.GetSelected().date).toDateString()+" "+new Date(this.GetSelected().date).toLocaleTimeString()}}}),this.update_url=this.select.GetValue()):(this.new_version=this.images[0].title,this.new_version_date=new Date(this.images[0].date),this.update_url=this.images[0].url))},CUpdateModal.prototype._addLogMessage=function(message,type){void 0!==this.log&&this.log.Add(message,type)},CUpdateModal.prototype._addLog=function(elements){var self=this;"undefined"!=typeof this.log&&(elements.push(element("tr",{className:"row"},[element("td",{className:"log",colSpan:2},this.log.handle)])),this.Info_func=function(){self.log.Show(!self.log.isVisible),this.bpanel.Rename(this.Info_btn,_(self.log.isVisible?"Hide log":"Show log")),self.content.querySelector("table").classList.toggle("hidden")},this.bpanel.Rename(this.Info_btn,_(self.log.isVisible?"Hide log":"Show log")),this.bpanel.Hidden(this.Info_btn,!1))},CUpdateModal.prototype.Show=function(show){return this.auto===!0?void this.Update.Start(this.update_url):(this.check===!0?this.CheckStatus():this.ImageSelect(),this.log&&this.log.isVisible&&this.log.Show(!1),void CModalBox.prototype.Show.call(this,show))},CUpdateModal.prototype.CheckStatus=function(){this.layer=this.CheckStatus;var self=this,elements=[element("tr",{className:"row"},[element("td",{className:"left"},_("Status")+":"),this.$status=element("td",{className:"right"})])];this._addLog(elements),this.SetHeader(_("Check image")),this.SetContent(element("table",{className:"cmodal-update status"},elements)),self.Update.CheckUpdate(self.update_url),this.F1_func=function(){self.$status.innerHtml=status,self.$status.className="right",self.bpanel.Hidden(this.OK_btn,!0),self.bpanel.Rename(this.Exit_btn,_("Cancel")),self.Update.CheckUpdate(self.update_url),self.trigger("onCheckStatus")}},CUpdateModal.prototype.ImageSelect=function(){this.layer=this.ImageSelect;var $new_version,self=this,elements=[element("tr",{className:"row info"},[element("td",{className:"left"},_("Current version")+":"),element("td",{className:"right",innerHTML:this.curr_info.version})]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Description")+":"),element("td",{className:"right"},element("div",{className:"ellipsis",innerHTML:this.curr_info.description||""}))]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Date")+":"),element("td",{className:"right",innerHTML:"Invalid Date"===this.curr_info.date?"n/a":this.curr_info.date.toDateString()+" "+this.curr_info.date.toLocaleTimeString()})]),element("tr",{className:"row padding info"},[element("td",{className:"left"},_("New version")+":"),element("td",{className:"right"},$new_version=element("div"))]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Description")+":"),element("td",{className:"right"},self.$curr_update_descr=element("div",{className:"ellipsis",innerHTML:this.image_description||""}))]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Date")+":"),self.$curr_update_date=element("td",{className:"right",innerHTML:this.image_date.toDateString()+" "+this.image_date.toLocaleTimeString()})])];this.warning!==!1&&elements.unshift(element("tr",{className:"row info"},[element("td",{className:"center",colSpan:2,innerHTML:_('<span class="alert">Warning!</span> Automatic device reboot after updating')})])),this.bpanel.Hidden(this.Info_btn,this.info!==!0),this._addLog(elements),this.SetContent(element("table",{className:"cmodal-update"},elements)),void 0!==this.new_version?"string"==typeof this.new_version?($new_version.innerHTML=this.new_version,self.$curr_update_date.innerHTML=this.new_version_date.toDateString()+" "+this.new_version_date.toLocaleTimeString()):elchild($new_version,this.new_version):($new_version.innerHTML=this.image_info.version,self.$curr_update_date.innerHTML=this.image_info.date.toDateString()+" "+this.image_info.date.toLocaleTimeString()),this.SetHeader(this.header_text||""),this.info===!0&&(this.Info_func=function(){self.ShowInfoWindow()},this.bpanel.Rename(this.Info_btn,_("Change log"))),this.F1_func=function(){self.Update.Start(this.update_url)},this.bpanel.Hidden(this.OK_btn,!1),this.bpanel.Hidden(this.Exit_btn,!1),this._binded!==!0&&(this.bind("onShow",function(){this.layer===this.ImageSelect&&this.select&&this.select.focus&&this.select.focus()}),this._binded=!0)},CUpdateModal.prototype.UpdateStart=function(){this.layer=this.UpdateStart;var self=this,elements=[element("tr",{className:"row info"},[element("td",{className:"center",colSpan:2,innerHTML:_('<span class="alert">Warning!</span> Automatic device reboot after updating')})]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Current version")+":"),element("td",{className:"right",innerHTML:this.curr_info.version})]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Description")+":"),element("td",{className:"right"},element("div",{className:"ellipsis",innerHTML:this.curr_info.description||""}))]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Date")+":"),element("td",{className:"right",innerHTML:"Invalid Date"===this.curr_info.date?"n/a":this.curr_info.date.toDateString()+" "+this.curr_info.date.toLocaleTimeString()})]),element("tr",{className:"row info padding"},[element("td",{className:"left"},_("New version")+":"),element("td",{className:"right",innerHTML:this.image_info.version})]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Description")+":"),element("td",{className:"right"},self.$curr_update_descr=element("div",{className:"ellipsis",innerHTML:this.image_description||""}))]),element("tr",{className:"row info"},[element("td",{className:"left"},_("Date")+":"),element("td",{className:"right",innerHTML:this.image_info.date.toDateString()+" "+this.image_info.date.toLocaleTimeString()})]),element("tr",{className:"row padding"},[element("td",{className:"left"},_("Update status")+":"),this.$status])];this.bpanel.Hidden(this.Info_btn,!0),this.bpanel.Hidden(self.Exit_btn,!0),this._addLog(elements),elements.push(element("tr",{className:"row"},[element("td",{className:"center",colSpan:2},this.ProgressBar.handle)])),this.SetContent(element("table",{className:"cmodal-update"},elements)),this.bpanel.Hidden(this.OK_btn,!0),this.bpanel.Hidden(this.Exit_btn,!0),self.log.isVisible?self.content.querySelector("table").classList.add("hidden"):self.content.querySelector("table").classList.remove("hidden"),this.trigger("onShowUpdateStart"),this.F1_func=function(){self.Update.Start(self.update_url),self.$status.innerHtml="",self.$status.classList.remove("error"),self.bpanel.Hidden(this.OK_btn,!0),self.bpanel.Hidden(this.Exit_btn,!0)}},CUpdateModal.prototype.ShowInfoWindow=function(){var $content,modal=new CModalBox(this),self=this;if(modal.SetHeader(_("Change log")),modal.baseClass="cmodal-main image-info-modal",modal.name="CModalImageInfo",modal.bpanel=new CButtonPanel,modal.bpanel.Init(MODAL_IMG_PATH),modal.bpanel.Add(KEYS.EXIT,"exit.png",_("Close"),function(){modal.Show(!1),modal.Free()}),modal.EventHandler=function(event){switch(event.code){case KEYS.UP:$content.parentNode.scrollByLines(-2);break;case KEYS.DOWN:$content.parentNode.scrollByLines(2);break;case KEYS.PAGE_DOWN:$content.parentNode.scrollByPages(1);break;case KEYS.PAGE_UP:$content.parentNode.scrollByPages(-1)}modal.bpanel.EventHandler(event)},modal.SetFooter(modal.bpanel.handle),modal.SetContent(element("div",{className:"image-info-content"},$content=element("div",{className:"info"},_("Information not found")))),modal.Init(),void 0===this.image_info[this.update_url]&&this.update_url){var name=this.update_url.split("/").pop();return void ajax("GET",this.update_url.replace(name,"")+"info/pub/get.php?name="+name+"&lang="+getCurrentLanguage(),function(text,status){200===status?self.image_info[self.update_url]=text:self.image_info[self.update_url]=_("Information not found"),$content.innerHTML=self.image_info[self.update_url],modal.Show(!0),$content.focus()})}$content.innerHTML=self.image_info[self.update_url],modal.Show(!0),$content.focus()},Events.inject(CUpdateModal);var TIME_ZONES=[{id:"Africa/Accra",offset:"+00:00"},{id:"Africa/Addis_Ababa",offset:"+03:00",name:"Africa/Addis Ababa"},{id:"Africa/Algiers",offset:"+01:00"},{id:"Africa/Asmera",offset:"+03:00"},{id:"Africa/Bamako",offset:"+00:00"},{id:"Africa/Bangui",offset:"+01:00"},{id:"Africa/Banjul",offset:"+00:00"},{id:"Africa/Bissau",offset:"+00:00"},{id:"Africa/Blantyre",offset:"+02:00"},{id:"Africa/Brazzaville",offset:"+01:00"},{id:"Africa/Bujumbura",offset:"+02:00"},{id:"Africa/Cairo",offset:"+02:00"},{id:"Africa/Casablanca",offset:"+00:00"},{id:"Africa/Ceuta",offset:"+01:00"},{id:"Africa/Conakry",offset:"+00:00"},{id:"Africa/Dakar",offset:"+00:00"},{id:"Africa/Dar_es_Salaam",offset:"+03:00",name:"Africa/Dar es Salaam"},{id:"Africa/Djibouti",offset:"+03:00"},{id:"Africa/Douala",offset:"+01:00"},{id:"Africa/El_Aaiun",offset:"+00:00",name:"Africa/El Aaiun"},{id:"Africa/Freetown",offset:"+00:00"},{id:"Africa/Gaborone",offset:"+02:00"},{id:"Africa/Harare",offset:"+02:00"},{id:"Africa/Johannesburg",offset:"+02:00"},{id:"Africa/Kampala",offset:"+03:00"},{id:"Africa/Khartoum",offset:"+03:00"},{id:"Africa/Kigali",offset:"+02:00"},{id:"Africa/Kinshasa",offset:"+01:00"},{id:"Africa/Lagos",offset:"+01:00"},{id:"Africa/Libreville",offset:"+01:00"},{id:"Africa/Lome",offset:"+00:00"},{id:"Africa/Luanda",offset:"+01:00"},{id:"Africa/Lubumbashi",offset:"+02:00"},{id:"Africa/Lusaka",offset:"+02:00"},{id:"Africa/Malabo",offset:"+01:00"},{id:"Africa/Maputo",offset:"+02:00"},{id:"Africa/Maseru",offset:"+02:00"},{id:"Africa/Mbabane",offset:"+02:00"},{id:"Africa/Mogadishu",offset:"+03:00"},{id:"Africa/Monrovia",offset:"+00:00"},{id:"Africa/Nairobi",offset:"+03:00"},{id:"Africa/Ndjamena",offset:"+01:00"},{id:"Africa/Niamey",offset:"+01:00"},{id:"Africa/Nouakchott",offset:"+00:00"},{id:"Africa/Ouagadougou",offset:"+00:00"},{id:"Africa/Porto-Novo",offset:"+01:00"},{id:"Africa/Sao_Tome",offset:"+00:00",name:"Africa/Sao Tome"},{id:"Africa/Tripoli",offset:"+02:00"},{id:"Africa/Tunis",offset:"+01:00"},{id:"Africa/Windhoek",offset:"+01:00"},{id:"America/Adak",offset:"-10:00"},{id:"America/Anchorage",offset:"-09:00"},{id:"America/Anguilla",offset:"-04:00"},{id:"America/Antigua",offset:"-04:00"},{id:"America/Araguaina",offset:"-03:00"},{id:"America/Argentina/Buenos_Aires",offset:"-03:00",name:"America/Argentina/Buenos Aires"},{id:"America/Argentina/Catamarca",offset:"-03:00"},{id:"America/Argentina/Cordoba",offset:"-03:00"},{id:"America/Argentina/Jujuy",offset:"-03:00"},{id:"America/Argentina/La_Rioja",offset:"-03:00",name:"America/Argentina/La Rioja"},{id:"America/Argentina/Mendoza",offset:"-03:00"},{id:"America/Argentina/Rio_Gallegos",offset:"-03:00",name:"America/Argentina/Rio Gallegos"},{id:"America/Argentina/San_Juan",offset:"-03:00",name:"America/Argentina/San Juan"},{id:"America/Argentina/Tucuman",offset:"-03:00"},{id:"America/Argentina/Ushuaia",offset:"-03:00"},{id:"America/Aruba",offset:"-04:00"},{id:"America/Asuncion",offset:"-04:00"},{id:"America/Bahia",offset:"-03:00"},{id:"America/Barbados",offset:"-04:00"},{id:"America/Belem",offset:"-03:00"},{id:"America/Belize",offset:"-06:00"},{id:"America/Boa_Vista",offset:"-04:00",name:"America/Boa Vista"},{id:"America/Bogota",offset:"-05:00"},{id:"America/Boise",offset:"-07:00"},{id:"America/Cambridge_Bay",offset:"-07:00",name:"America/Cambridge Bay"},{id:"America/Campo_Grande",offset:"-04:00",name:"America/Campo Grande"},{id:"America/Cancun",offset:"-06:00"},{id:"America/Caracas",offset:"-04:30"},{id:"America/Cayenne",offset:"-03:00"},{id:"America/Cayman",offset:"-05:00"},{id:"America/Chicago",offset:"-06:00"},{id:"America/Chihuahua",offset:"-07:00"},{id:"America/Coral_Harbour",offset:"-05:00",name:"America/Coral Harbour"},{id:"America/Costa_Rica",offset:"-06:00",name:"America/Costa Rica"},{id:"America/Cuiaba",offset:"-04:00"},{id:"America/Curacao",offset:"-04:00"},{id:"America/Danmarkshavn",offset:"+00:00"},{id:"America/Dawson",offset:"-08:00"},{id:"America/Dawson_Creek",offset:"-07:00",name:"America/Dawson Creek"},{id:"America/Denver",offset:"-07:00"},{id:"America/Detroit",offset:"-05:00"},{id:"America/Dominica",offset:"-04:00"},{id:"America/Edmonton",offset:"-07:00"},{id:"America/Eirunepe",offset:"-04:00"},{id:"America/El_Salvador",offset:"-06:00",name:"America/El Salvador"},{id:"America/Fortaleza",offset:"-03:00"},{id:"America/Glace_Bay",offset:"-04:00",name:"America/Glace Bay"},{id:"America/Godthab",offset:"-03:00"},{id:"America/Goose_Bay",offset:"-04:00",name:"America/Goose Bay"},{id:"America/Grand_Turk",offset:"-05:00",name:"America/Grand Turk"},{id:"America/Grenada",offset:"-04:00"},{id:"America/Guadeloupe",offset:"-04:00"},{id:"America/Guatemala",offset:"-06:00"},{id:"America/Guayaquil",offset:"-05:00"},{id:"America/Guyana",offset:"-04:00"},{id:"America/Halifax",offset:"-04:00"},{id:"America/Havana",offset:"-05:00"},{id:"America/Hermosillo",offset:"-07:00"},{id:"America/Indiana/Indianapolis",offset:"-05:00"},{id:"America/Indiana/Knox",offset:"-06:00"},{id:"America/Indiana/Marengo",offset:"-05:00"},{id:"America/Indiana/Petersburg",offset:"-05:00"},{id:"America/Indiana/Vevay",offset:"-05:00"},{id:"America/Indiana/Vincennes",offset:"-05:00"},{id:"America/Inuvik",offset:"-07:00"},{id:"America/Iqaluit",offset:"-05:00"},{id:"America/Juneau",offset:"-09:00"},{id:"America/Kentucky/Louisville",offset:"-05:00"},{id:"America/Kentucky/Monticello",offset:"-05:00"},{id:"America/La_Paz",offset:"-04:00",name:"America/La Paz"},{id:"America/Lima",offset:"-05:00"},{id:"America/Los_Angeles",offset:"-08:00",name:"America/Los Angeles"},{id:"America/Maceio",offset:"-03:00"},{id:"America/Managua",offset:"-06:00"},{id:"America/Manaus",offset:"-04:00"},{id:"America/Martinique",offset:"-04:00"},{id:"America/Mazatlan",offset:"-07:00"},{id:"America/Menominee",offset:"-06:00"},{id:"America/Merida",offset:"-06:00"},{id:"America/Mexico_City",offset:"-06:00",name:"America/Mexico City"},{id:"America/Miquelon",offset:"-03:00"},{id:"America/Moncton",offset:"-04:00"},{id:"America/Monterrey",offset:"-06:00"},{id:"America/Montevideo",offset:"-03:00"},{id:"America/Montreal",offset:"-05:00"},{id:"America/Montserrat",offset:"-04:00"},{id:"America/Nassau",offset:"-05:00"},{id:"America/New_York",offset:"-05:00",name:"America/New York"},{id:"America/Nipigon",offset:"-05:00"},{id:"America/Nome",offset:"-09:00"},{id:"America/Noronha",offset:"-02:00"},{id:"America/North_Dakota/Center",offset:"-06:00",name:"America/North Dakota/Center"},{id:"America/Panama",offset:"-05:00"},{id:"America/Pangnirtung",offset:"-05:00"},{id:"America/Paramaribo",offset:"-03:00"},{id:"America/Phoenix",offset:"-07:00"},{id:"America/Port-au-Prince",offset:"-05:00"},{id:"America/Port_of_Spain",offset:"-04:00",name:"America/Port of Spain"},{id:"America/Porto_Velho",offset:"-04:00",name:"America/Porto Velho"},{id:"America/Puerto_Rico",offset:"-04:00",name:"America/Puerto Rico"},{id:"America/Rainy_River",offset:"-06:00",name:"America/Rainy River"},{id:"America/Rankin_Inlet",offset:"-06:00",name:"America/Rankin Inlet"},{id:"America/Recife",offset:"-03:00"},{id:"America/Regina",offset:"-06:00"},{id:"America/Rio_Branco",offset:"-05:00",name:"America/Rio Branco"},{id:"America/Santiago",offset:"-04:00"},{id:"America/Santo_Domingo",offset:"-04:00",name:"America/Santo Domingo"},{id:"America/Sao_Paulo",offset:"-03:00",name:"America/Sao Paulo"},{id:"America/Scoresbysund",offset:"-01:00"},{id:"America/Shiprock",offset:"-07:00"},{id:"America/Swift_Current",offset:"-06:00",name:"America/Swift Current"},{id:"America/Tegucigalpa",offset:"-06:00"},{id:"America/Thule",offset:"-04:00"},{id:"America/Thunder_Bay",offset:"-05:00",name:"America/Thunder Bay"},{id:"America/Tijuana",offset:"-08:00"},{id:"America/Toronto",offset:"-05:00"},{id:"America/Tortola",offset:"-04:00"},{id:"America/Vancouver",offset:"-08:00"},{id:"America/Whitehorse",offset:"-08:00"},{id:"America/Winnipeg",offset:"-06:00"},{id:"America/Yakutat",offset:"-09:00"},{id:"America/Yellowknife",offset:"-07:00"},{id:"Antarctica/Casey",offset:"+11:00"},{id:"Antarctica/Davis",offset:"+07:00"},{id:"Antarctica/DumontDUrville",offset:"+10:00"},{id:"Antarctica/Mawson",offset:"+05:00"},{id:"Antarctica/McMurdo",offset:"+12:00"},{id:"Antarctica/Palmer",offset:"-04:00"},{id:"Antarctica/Rothera",offset:"-03:00"},{id:"Antarctica/South_Pole",offset:"+12:00",name:"Antarctica/South Pole"},{id:"Antarctica/Syowa",offset:"+03:00"},{id:"Antarctica/Vostok",offset:"+06:00"},{id:"Arctic/Longyearbyen",offset:"+01:00"},{id:"Asia/Aden",offset:"+03:00"},{id:"Asia/Almaty",offset:"+06:00"},{id:"Asia/Amman",offset:"+02:00"},{id:"Asia/Anadyr",offset:"+12:00"},{id:"Asia/Aqtau",offset:"+05:00"},{id:"Asia/Aqtobe",offset:"+05:00"},{id:"Asia/Ashgabat",offset:"+05:00"},{id:"Asia/Ashkhabad",offset:"+05:00"},{id:"Asia/Baghdad",offset:"+03:00"},{id:"Asia/Bahrain",offset:"+03:00"},{id:"Asia/Baku",offset:"+04:00"},{id:"Asia/Bangkok",offset:"+07:00"},{id:"Asia/Beirut",offset:"+02:00"},{id:"Asia/Bishkek",offset:"+06:00"},{id:"Asia/Brunei",offset:"+08:00"},{id:"Asia/Calcutta",offset:"+05:30"},{id:"Asia/Choibalsan",offset:"+08:00"},{id:"Asia/Chongqing",offset:"+08:00"},{id:"Asia/Colombo",offset:"+05:30"},{id:"Asia/Damascus",offset:"+02:00"},{id:"Asia/Dhaka",offset:"+06:00"},{id:"Asia/Dili",offset:"+09:00"},{id:"Asia/Dubai",offset:"+04:00"},{id:"Asia/Dushanbe",offset:"+05:00"},{id:"Asia/Gaza",offset:"+02:00"},{id:"Asia/Harbin",offset:"+08:00"},{id:"Asia/Ho_Chi_Minh",offset:"+07:00",name:"Asia/Ho Chi Minh"},{id:"Asia/Hong_Kong",offset:"+08:00",name:"Asia/Hong Kong"},{id:"Asia/Hovd",offset:"+07:00"},{id:"Asia/Irkutsk",offset:"+09:00"},{id:"Asia/Istanbul",offset:"+02:00"},{id:"Asia/Jakarta",offset:"+07:00"},{id:"Asia/Jayapura",offset:"+09:00"},{id:"Asia/Jerusalem",offset:"+02:00"},{id:"Asia/Kabul",offset:"+04:30"},{id:"Asia/Kamchatka",offset:"+12:00"},{id:"Asia/Karachi",offset:"+05:00"},{id:"Asia/Kashgar",offset:"+08:00"},{id:"Asia/Katmandu",offset:"+05:45"},{id:"Asia/Krasnoyarsk",offset:"+08:00"},{id:"Asia/Kuala_Lumpur",offset:"+08:00",name:"Asia/Kuala Lumpur"},{id:"Asia/Kuching",offset:"+08:00"},{id:"Asia/Kuwait",offset:"+03:00"},{id:"Asia/Macau",offset:"+08:00"},{id:"Asia/Magadan",offset:"+12:00"},{id:"Asia/Makassar",offset:"+08:00"},{id:"Asia/Manila",offset:"+08:00"},{id:"Asia/Muscat",offset:"+04:00"},{id:"Asia/Nicosia",offset:"+02:00"},{id:"Asia/Novokuznetsk",offset:"+07:00"},{id:"Asia/Novosibirsk",offset:"+07:00"},{id:"Asia/Omsk",offset:"+07:00"},{id:"Asia/Oral",offset:"+05:00"},{id:"Asia/Phnom_Penh",offset:"+07:00",name:"Asia/Phnom Penh"},{id:"Asia/Pontianak",offset:"+07:00"},{id:"Asia/Pyongyang",offset:"+09:00"},{id:"Asia/Qatar",offset:"+03:00"},{id:"Asia/Qyzylorda",offset:"+06:00"},{id:"Asia/Rangoon",offset:"+06:30"},{id:"Asia/Riyadh",offset:"+03:00"},{id:"Asia/Saigon",offset:"+07:00"},{id:"Asia/Sakhalin",offset:"+11:00"},{id:"Asia/Samarkand",offset:"+05:00"},{id:"Asia/Seoul",offset:"+09:00"},{id:"Asia/Shanghai",offset:"+08:00"},{id:"Asia/Taipei",offset:"+08:00"},{id:"Asia/Tashkent",offset:"+05:00"},{id:"Asia/Tbilisi",offset:"+04:00"},{id:"Asia/Tehran",offset:"+03:30"},{id:"Asia/Thimphu",offset:"+06:00"},{id:"Asia/Tokyo",offset:"+09:00"},{id:"Asia/Ulaanbaatar",offset:"+08:00"},{id:"Asia/Urumqi",offset:"+08:00"},{id:"Asia/Vientiane",offset:"+07:00"},{id:"Asia/Vladivostok",offset:"+11:00"},{id:"Asia/Yakutsk",offset:"+10:00"},{id:"Asia/Yekaterinburg",offset:"+06:00"},{id:"Asia/Yerevan",offset:"+04:00"},{id:"Atlantic/Azores",offset:"-01:00"},{id:"Atlantic/Bermuda",offset:"-04:00"},{id:"Atlantic/Canary",offset:"+00:00"},{id:"Atlantic/Cape_Verde",offset:"-01:00",name:"Atlantic/Cape Verde"},{id:"Atlantic/Faeroe",offset:"+00:00"},{id:"Atlantic/Jan_Mayen",offset:"+01:00",name:"Atlantic/Jan Mayen"},{id:"Atlantic/Madeira",offset:"+00:00"},{id:"Atlantic/Reykjavik",offset:"+00:00"},{id:"Atlantic/South_Georgia",offset:"-02:00",name:"Atlantic/South Georgia"},{id:"Atlantic/Stanley",offset:"-03:00"},{id:"Australia/Adelaide",offset:"+09:30"},{id:"Australia/Brisbane",offset:"+10:00"},{id:"Australia/Broken_Hill",offset:"+09:30",name:"Australia/Broken Hill"},{id:"Australia/Currie",offset:"+10:00"},{id:"Australia/Darwin",offset:"+09:30"},{id:"Australia/Hobart",offset:"+10:00"},{id:"Australia/Lindeman",offset:"+10:00"},{id:"Australia/Lord_Howe",offset:"+10:30",name:"Australia/Lord Howe"},{id:"Australia/Melbourne",offset:"+10:00"},{id:"Australia/Perth",offset:"+08:00"},{id:"Australia/Sydney",offset:"+10:00"},{id:"Europe/Amsterdam",offset:"+01:00"},{id:"Europe/Andorra",offset:"+01:00"},{id:"Europe/Athens",offset:"+02:00"},{id:"Europe/Belfast",offset:"+00:00"},{id:"Europe/Belgrade",offset:"+01:00"},{id:"Europe/Berlin",offset:"+01:00"},{id:"Europe/Bratislava",offset:"+01:00"},{id:"Europe/Brussels",offset:"+01:00"},{id:"Europe/Bucharest",offset:"+02:00"},{id:"Europe/Budapest",offset:"+01:00"},{id:"Europe/Chisinau",offset:"+02:00"},{id:"Europe/Copenhagen",offset:"+01:00"},{id:"Europe/Dublin",offset:"+00:00"},{id:"Europe/Gibraltar",offset:"+01:00"},{id:"Europe/Guernsey",offset:"+00:00"},{id:"Europe/Helsinki",offset:"+02:00"},{id:"Europe/Isle_of_Man",offset:"+00:00",name:"Europe/Isle of Man"},{id:"Europe/Istanbul",offset:"+02:00"},{id:"Europe/Jersey",offset:"+00:00"},{id:"Europe/Kaliningrad",offset:"+03:00"},{id:"Europe/Kiev",offset:"+02:00"},{id:"Europe/Lisbon",offset:"+00:00"},{id:"Europe/Ljubljana",offset:"+01:00"},{id:"Europe/London",offset:"+00:00"},{id:"Europe/Luxembourg",offset:"+01:00"},{id:"Europe/Madrid",offset:"+01:00"},{id:"Europe/Malta",offset:"+01:00"},{id:"Europe/Mariehamn",offset:"+02:00"},{id:"Europe/Minsk",offset:"+03:00"},{id:"Europe/Monaco",offset:"+01:00"},{id:"Europe/Moscow",offset:"+03:00"},{id:"Europe/Nicosia",offset:"+02:00"},{id:"Europe/Oslo",offset:"+01:00"},{id:"Europe/Paris",offset:"+01:00"},{id:"Europe/Podgorica",offset:"+01:00"},{id:"Europe/Prague",offset:"+01:00"},{id:"Europe/Riga",offset:"+02:00"},{id:"Europe/Rome",offset:"+01:00"},{id:"Europe/Samara",offset:"+04:00"},{id:"Europe/San_Marino",offset:"+01:00",name:"Europe/San Marino"},{id:"Europe/Sarajevo",offset:"+01:00"},{id:"Europe/Simferopol",offset:"+02:00"},{id:"Europe/Skopje",offset:"+01:00"},{id:"Europe/Sofia",offset:"+02:00"},{id:"Europe/Stockholm",offset:"+01:00"},{id:"Europe/Tallinn",offset:"+02:00"},{id:"Europe/Tirane",offset:"+01:00"},{id:"Europe/Tiraspol",offset:"+02:00"},{id:"Europe/Uzhgorod",offset:"+02:00"},{id:"Europe/Vaduz",offset:"+01:00"},{id:"Europe/Vatican",offset:"+01:00"},{id:"Europe/Vienna",offset:"+01:00"},{id:"Europe/Vilnius",offset:"+02:00"},{id:"Europe/Volgograd",offset:"+04:00"},{id:"Europe/Warsaw",offset:"+01:00"},{id:"Europe/Zagreb",offset:"+01:00"},{id:"Europe/Zaporozhye",offset:"+02:00"},{id:"Europe/Zurich",offset:"+01:00"},{id:"Indian/Antananarivo",offset:"+03:00"},{id:"Indian/Chagos",offset:"+06:00"},{id:"Indian/Christmas",offset:"+07:00"},{id:"Indian/Cocos",offset:"+06:30"},{id:"Indian/Comoro",offset:"+03:00"},{id:"Indian/Kerguelen",offset:"+05:00"},{id:"Indian/Mahe",offset:"+04:00"},{id:"Indian/Maldives",offset:"+05:00"},{id:"Indian/Mauritius",offset:"+04:00"},{id:"Indian/Mayotte",offset:"+03:00"},{id:"Indian/Reunion",offset:"+04:00"},{id:"Pacific/Apia",offset:"+13:00"},{id:"Pacific/Auckland",offset:"+12:00"},{id:"Pacific/Chatham",offset:"+12:45"},{id:"Pacific/Easter",offset:"-06:00"},{id:"Pacific/Efate",offset:"+11:00"},{id:"Pacific/Enderbury",offset:"+13:00"},{id:"Pacific/Fakaofo",offset:"+13:00"},{id:"Pacific/Fiji",offset:"+12:00"},{id:"Pacific/Funafuti",offset:"+12:00"},{id:"Pacific/Galapagos",offset:"-06:00"},{id:"Pacific/Gambier",offset:"-09:00"},{id:"Pacific/Guadalcanal",offset:"+11:00"},{id:"Pacific/Guam",offset:"+10:00"},{id:"Pacific/Honolulu",offset:"-10:00"},{id:"Pacific/Johnston",offset:"-10:00"},{id:"Pacific/Kiritimati",offset:"+14:00"},{id:"Pacific/Kosrae",offset:"+11:00"},{id:"Pacific/Kwajalein",offset:"+12:00"},{id:"Pacific/Majuro",offset:"+12:00"},{id:"Pacific/Marquesas",offset:"-09:30"},{id:"Pacific/Midway",offset:"-11:00"},{id:"Pacific/Nauru",offset:"+12:00"},{id:"Pacific/Niue",offset:"-11:00"},{id:"Pacific/Norfolk",offset:"+11:30"},{id:"Pacific/Noumea",offset:"+11:00"},{id:"Pacific/Pago_Pago",offset:"-11:00",name:"Pacific/Pago Pago"},{id:"Pacific/Palau",offset:"+09:00"},{id:"Pacific/Pitcairn",offset:"-08:00"},{id:"Pacific/Ponape",offset:"+11:00"},{id:"Pacific/Port_Moresby",offset:"+10:00",name:"Pacific/Port Moresby"},{id:"Pacific/Rarotonga",offset:"-10:00"},{id:"Pacific/Saipan",offset:"+10:00"},{id:"Pacific/Tahiti",offset:"-10:00"},{id:"Pacific/Tarawa",offset:"+12:00"},{id:"Pacific/Tongatapu",offset:"+13:00"},{id:"Pacific/Truk",offset:"+10:00"},{id:"Pacific/Wake",offset:"+12:00"},{id:"Pacific/Wallis",offset:"+12:00"}],MEDIA_TYPE_NONE=0,MEDIA_TYPE_STORAGE_SATA=1,MEDIA_TYPE_STORAGE_USB=2,MEDIA_TYPE_STORAGE_SD=3,MEDIA_TYPE_ROOT_DVB=4,MEDIA_TYPE_ROOT_IB=5,MEDIA_TYPE_ROOT_MB=6,MEDIA_TYPE_ROOT_TV=7,MEDIA_TYPE_ROOT_HELP=8,MEDIA_TYPE_ROOT_PVR=9,MEDIA_TYPE_SAMBA_ROOT=10,MEDIA_TYPE_SAMBA_GROUP=11,MEDIA_TYPE_SAMBA_HOST=12,MEDIA_TYPE_SAMBA_SHARE=13,MEDIA_TYPE_ROOT_EPG=14,MEDIA_TYPE_UPNP=20,MEDIA_TYPE_NFS_ROOT=30,MEDIA_TYPE_NFS_HOST=31,MEDIA_TYPE_NFS_SHARE=32,MEDIA_TYPE_FAVORITES=40,MEDIA_TYPE_RECORDS_ROOT=50,MEDIA_TYPE_RECORDS_CHAN=51,MEDIA_TYPE_RECORDS_DATE=52,MEDIA_TYPE_RECORDS_ITEM=53,MEDIA_TYPE_BACK=60,MEDIA_TYPE_FOLDER=61,MEDIA_TYPE_VIDEO=62,MEDIA_TYPE_AUDIO=63,MEDIA_TYPE_IMAGE=64,MEDIA_TYPE_TEXT=65,MEDIA_TYPE_ISO=66,MEDIA_TYPE_PLAYLIST=67,MEDIA_TYPE_CUE=68,MEDIA_TYPE_CUE_ITEM=69,MEDIA_TYPE_URL=70,MEDIA_TYPE_GROUP=80,MEDIA_TYPE_STREAM=81,MEDIA_TYPE_STREAM_TS=82,MEDIA_TYPE_DVB=83,MEDIA_TYPE_PVR_SHED=91,MEDIA_TYPE_PVR_REC=92,MEDIA_TYPE_PVR_ERR=93,MEDIA_TYPE_PVR_DONE=94,MEDIA_TYPE_UPNP_ROOT=95,MEDIA_TYPE_UPNP_HOST=96,MEDIA_TYPE_UPNP_FOLDER=97,MEDIA_TYPE_HELP_FOLDER=201,MEDIA_TYPE_HELP_ARTICLE=202,MEDIA_TYPE_HELP_BACK=203,MEDIA_ACTION_OPEN=1,MEDIA_ACTION_OPEN_SELECTED=2,MEDIA_ACTION_ITEM_MOUNT=3,MEDIA_ACTION_ITEM_UNMOUNT=4,MEDIA_ACTION_MOUNT_EDIT=5,MEDIA_ACTION_SELECT_ONE=6,MEDIA_ACTION_SELECT_ALL=7,MEDIA_ACTION_DESELECT=8,MEDIA_ACTION_INVERT=9,MEDIA_ACTION_CUT=10,MEDIA_ACTION_COPY=11,MEDIA_ACTION_PASTE=12,MEDIA_ACTION_DELETE=13,MEDIA_ACTION_EDIT=14,MEDIA_ACTION_SAVE=15,MEDIA_ACTION_CREATE_GROUP=16,MEDIA_ACTION_SORT_NONE=17,MEDIA_ACTION_SORT_TYPE=18,MEDIA_ACTION_SORT_EXT=19,MEDIA_ACTION_SORT_NAME=20,MEDIA_ACTION_SORT_SIZE=21,MEDIA_ACTION_SORT_TIME=22,MEDIA_ACTION_NEW_GROUP=23,MEDIA_ACTION_TOOLS_MOUNT=24,MEDIA_ACTION_TOOLS_UNMOUNT=25,MEDIA_ACTION_TOOLS_FORMAT=26,MEDIA_ACTION_TSEND_CICLICK=27,MEDIA_ACTION_TSEND_STOP=28,MEDIA_ACTION_TS_ON=29,MEDIA_ACTION_TS_OFF=30,MEDIA_ACTION_SUBTITLE_MOUNT=31,MEDIA_ACTION_CREATE_RECORD=32,MEDIA_ACTION_ADD_ITEM=33,MEDIA_ACTION_ADD_OPER_TVLIST=34,MEDIA_ACTION_ADD_TVLIST=35,MEDIA_ACTION_ADD_TVCHANNEL=36,MEDIA_ACTION_ADD_FOLDER=37,MEDIA_ACTION_AUTO_SCAN_DVB=38,MEDIA_ACTION_MANUAL_SCAN_DVB=39,MEDIA_ACTION_DVB_EPG=40,MEDIA_ACTION_CLEAR_DVB=41,MEDIA_ACTION_STOP_RECORD=43,MEDIA_ACTION_ADD_FAV=44,MEDIA_ACTION_REMOVE_FAV=45,MEDIA_ACTION_EXPAND_ALL=46,MEDIA_ACTION_COLLAPSE_ALL=47,MEDIA_ACTION_DVB_EPG_GRID=48,MEDIA_EXTENSION={},MEDIA_TYPES=[MEDIA_TYPE_VIDEO,MEDIA_TYPE_AUDIO,MEDIA_TYPE_IMAGE,MEDIA_TYPE_TEXT,MEDIA_TYPE_ISO,MEDIA_TYPE_PLAYLIST,MEDIA_TYPE_CUE,MEDIA_TYPE_RECORDS_ITEM];
MEDIA_EXTENSION[MEDIA_TYPE_VIDEO]=["mpg","mpeg","mov","mp4","avi","mkv","3gp","ts","vob","wmv","mts","m2t","m2v","divx","m2ts","m2p","tp","flv","mod","tod","asf","tts","m4v"],MEDIA_EXTENSION[MEDIA_TYPE_AUDIO]=["mp3","wav","ac3","ogg","oga","aiff","wv","tta","wma","aac","dts","flac","ape","m4a"],MEDIA_EXTENSION[MEDIA_TYPE_IMAGE]=["jpg","jpeg","png","bmp","tif","tiff"],MEDIA_EXTENSION[MEDIA_TYPE_TEXT]=["txt","srt","sub","ass"],MEDIA_EXTENSION[MEDIA_TYPE_ISO]=["iso"],MEDIA_EXTENSION[MEDIA_TYPE_PLAYLIST]=["m3u","m3u8"],MEDIA_EXTENSION[MEDIA_TYPE_CUE]=["cue"],MEDIA_EXTENSION[MEDIA_TYPE_RECORDS_ITEM]=["tspinf"];var MODEL_TYPE=gSTB.GetDeviceModelExt(),STB_MODE_STANDBY=!1,environment={},STORAGE_INFO=[],HDD_INFO=[],SMB_ARRAY=[],SMB_DATA=null,SMB_MOUNTED=!1,SMB_AUTH={},SMB_PATH="/ram/mnt/smb",NFS_ARRAY=[],NFS_DATA=null,NFS_MOUNTED=!1,NFS_PATH="/ram/mnt/nfs",FAVORITES={},FAVORITES_NEW={},FAVORITES_CHANGED=!1,CURRENT_NETWORK_STATE=!1,CURRENT_INTERNET_STATE=!1,currCPage=null,baseCPage=null,VIDEO_MODE="576i",remoteControlButtonsImagesPath=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/",MediaBrowser=new CPage;MediaBrowser.name="CPageMediaBrowser",MediaBrowser.Preview=new CBase(MediaBrowser),MediaBrowser.windowId=stbWebWindow.windowId(),MediaBrowser.onInit=function(){var self=this;this.isStrictMode=function(){return!this}(),this.playable=[MEDIA_TYPE_VIDEO,MEDIA_TYPE_AUDIO,MEDIA_TYPE_IMAGE,MEDIA_TYPE_ISO,MEDIA_TYPE_RECORDS_ITEM,MEDIA_TYPE_STREAM,MEDIA_TYPE_CUE_ITEM],gSTB.SetListFilesExt("."+configuration.registersTypes.join(" .")),this.subscribeEvents={},this.subscribeEvents[1]=function(){var file=self.FileList.activeItem.data;if(self.Preview.isVisible&&(self.Preview.player.className=file.type===MEDIA_TYPE_AUDIO?"player audio":"player play",self.Preview.body.info&&void 0===self.Preview.body.info.time&&MediaPlayer.totalTime>0)){var time=MediaPlayer.parseTime(MediaPlayer.totalTime);self.Preview.body.info.time=element("div",{className:"lbl"},[_("Duration:"),element("span",{className:"txt"},time.hour+":"+time.min+":"+time.sec)]),elchild(self.Preview.body.info,self.Preview.body.info.time)}},this.subscribeEvents[2]=function(){self.Preview.isVisible&&self.Preview.player&&(self.Preview.player.className="player stop",self.Preview.SetProgress(0))},this.subscribeEvents[3]=function(state){var file=self.FileList.activeItem.data;this.Preview.isVisible&&(state?this.Preview.player.className="player stop":this.Preview.player.className=file.type===MEDIA_TYPE_AUDIO?"player audio":"player play")},this.subscribeEvents[4]=function(position){this.Preview.isVisible&&this.Preview.SetProgress(position)},this.subscribeEvents[5]=function(){this.Preview.isVisible&&this.Preview.player&&(this.Preview.player.className="player stop",this.Preview.SetProgress(0))},this.subscribeEvents[6]=function(){echo("MediaPlayer.EVENT_OK");var file=self.FileList.activeItem.data;-1!==this.playable.indexOf(file.type)&&(this.actionFrame(!0),this.Preview.player&&(this.Preview.player.className=file.type===MEDIA_TYPE_AUDIO?"player audio":"player play",gSTB.IsPlaying()&&MediaPlayer.runner.start(),MediaPlayer.Show(!1,!1),MediaPlayer.changeScreenMode(!1)))},this.subscribeEvents[7]=function(){echo("MediaPlayer.EVENT_EXIT"),this.Preview.SetProgress(0)},this.ModalMenu=new CModal(this),this.ModalMenu.onShow=function(){var self=this;this.Menu.gview.slist.Each(function(item){self.Menu.gview.slist.Hidden(item,item.iid!==MEDIA_TYPE_NONE&&-1===self.parent.FileList.mtypes.indexOf(item.iid))}),this.Menu.Hidden(this.Menu.gview,this.Menu.gview.slist.Length()-(self.Menu.gview.slist.states.hidden||[]).length===1);var currentItem=this.parent.FileList.activeItem,activeItems=this.parent.FileList.ActiveItems(),lastPathItemType=this.parent.FileList.path[this.parent.FileList.path.length-1].type;this.Menu.gedit.slist.Hidden(this.Menu.gedit.iopen,currentItem.data.type===MEDIA_TYPE_BACK||currentItem.data.type===MEDIA_TYPE_TEXT),this.Menu.gedit.slist.Hidden(this.Menu.gedit.ismount,currentItem.data.type!==MEDIA_TYPE_TEXT),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iopensl,void 0===this.parent.FileList.states.marked||0===this.parent.FileList.states.marked.length),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iselone,this.parent.BPanel.btnF2.data.hidden),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iselall,this.parent.BPanel.btnF2.data.hidden),this.Menu.gedit.slist.Hidden(this.Menu.gedit.imount,!(void 0===currentItem.data.link&&(currentItem.data.type===MEDIA_TYPE_SAMBA_SHARE||currentItem.data.type===MEDIA_TYPE_NFS_SHARE))),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iunmount,!(void 0!==currentItem.data.link&&(currentItem.data.type===MEDIA_TYPE_SAMBA_SHARE||currentItem.data.type===MEDIA_TYPE_NFS_SHARE))),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iedit,!(void 0!==currentItem.data.link&&(currentItem.data.type===MEDIA_TYPE_SAMBA_SHARE||currentItem.data.type===MEDIA_TYPE_NFS_SHARE))),this.Menu.gedit.slist.Hidden(this.Menu.gedit.ideselect,this.parent.BPanel.btnF2.data.hidden||void 0===this.parent.FileList.states.marked||0===this.parent.FileList.states.marked.length),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iinvert,this.Menu.gedit.ideselect.hidden),this.Menu.gedit.slist.Hidden(this.Menu.gedit.icut,0===activeItems.length||this.parent.FileList.parentItem.type!==MEDIA_TYPE_FAVORITES),this.Menu.gedit.slist.Hidden(this.Menu.gedit.icopy,0===activeItems.length||this.parent.FileList.parentItem.type!==MEDIA_TYPE_FAVORITES&&this.parent.FileList.parentItem.type!==MEDIA_TYPE_PLAYLIST),this.Menu.gedit.slist.Hidden(this.Menu.gedit.ipaste,0===globalBuffer.size()||this.parent.FileList.parentItem.type!==MEDIA_TYPE_FAVORITES||globalBuffer.place().url===this.parent.FileList.parentItem.url&&globalBuffer.place().type===this.parent.FileList.parentItem.type),this.Menu.gedit.slist.Hidden(this.Menu.gedit.idelete,this.parent.BPanel.btnF2.data.hidden||0===activeItems.length||lastPathItemType===MEDIA_TYPE_PLAYLIST||this.parent.FileList.mode===MEDIA_TYPE_RECORDS_ROOT||this.parent.FileList.mode===MEDIA_TYPE_FAVORITES),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iaddfav,this.parent.BPanel.btnF3add.data.hidden),this.Menu.gedit.slist.Hidden(this.Menu.gedit.iremfav,this.parent.BPanel.btnF3del.data.hidden),this.Menu.Hidden(this.Menu.gedit,this.Menu.gedit.slist.Length()-(self.Menu.gedit.slist.states.hidden||[]).length===0),this.Menu.gtools.slist.Disabled(this.Menu.gtools.imount,!CURRENT_NETWORK_STATE),this.Menu.gtools.slist.Disabled(this.Menu.gtools.iunmount,!CURRENT_NETWORK_STATE||0===SMB_ARRAY.length&&0===NFS_ARRAY.length),(this.Menu.gsort.slist.states.marked||[]).forEach(function(item){item.self.Marked(item,!1)}),this.parent.FileList.mode!==MEDIA_TYPE_FAVORITES&&this.Menu.gsort.slist.Marked(this.Menu.gsort.slist.FindOne({iid:this.parent.FileList.sortType}),!0),this.Menu.Hidden(this.Menu.gsort,this.parent.BPanel.btnF2.data.hidden&&this.parent.FileList.mode!==MEDIA_TYPE_FAVORITES);for(var i=0;i<MediaBrowser.ModalMenu.Menu.handleInner.children.length;i++){var group=MediaBrowser.ModalMenu.Menu.handleInner.children[i];if(group.options.hidden===!1)return this.Menu.Switch(group),void this.Menu.Activate()}},this.ModalMenu.Menu=new CGroupMenu(this.ModalMenu),this.ModalMenu.Menu.Init(this.handle.querySelector("div.cgmenu-main")),this.ModalMenu.Init(element("div",{className:"cmodal-menu"},this.ModalMenu.Menu.handle)),this.ModalMenu.handle.onclick=function(){self.ModalMenu.Show(!1)},this.ModalMenu.EventHandler=function(event){switch(event.code){case KEYS.BACK:case KEYS.MENU:self.ModalMenu.Show(!1);break;case KEYS.TV:self.ModalMenu.Show(!1),self.Show(!1);break;default:self.ModalMenu.Menu.EventHandler(event)}},this.ModalMenu.Menu.gedit=this.ModalMenu.Menu.AddGroup("gedit",_("Operations"),{onclick:function(){var iid=this.iid;switch(self.ModalMenu.Show(!1),iid){case MEDIA_ACTION_OPEN:self.FileList.activeItem.onclick();break;case MEDIA_ACTION_OPEN_SELECTED:var list=self.FileList.GetPlaylist();list.length>0&&(MediaPlayer.prepareList(list),MediaPlayer.preparePlayer(list[0],self,!0,!0,!self.BPanel.btnF3add.data.hidden||!self.BPanel.btnF3del.data.hidden,!0),self.FileList.playListSet=!1);break;case MEDIA_ACTION_SUBTITLE_MOUNT:self.FileList.activeItem.onclick();break;case MEDIA_ACTION_ITEM_MOUNT:new CModalMount(self);break;case MEDIA_ACTION_ITEM_UNMOUNT:new CModalUnmount(self,self.FileList.activeItem.data.link);break;case MEDIA_ACTION_MOUNT_EDIT:new CModalMount(self,self.FileList.activeItem.data.link,self.FileList.activeItem.data.type);break;case MEDIA_ACTION_SELECT_ONE:self.FileList.Marked(self.FileList.activeItem.data,!0);break;case MEDIA_ACTION_SELECT_ALL:self.FileList.Each(function(item){self.FileList.Marked(item,!0)});break;case MEDIA_ACTION_DESELECT:self.FileList.Each(function(item){self.FileList.Marked(item,!1)});break;case MEDIA_ACTION_INVERT:self.FileList.Each(function(item){self.FileList.Marked(item,!item.marked)});break;case MEDIA_ACTION_CUT:case MEDIA_ACTION_COPY:case MEDIA_ACTION_DELETE:var items=self.FileList.ActiveItems();switch(iid){case MEDIA_ACTION_CUT:echo("MEDIA_ACTION_CUT"),globalBuffer.clear(),globalBuffer.mode(globalBuffer.MODE_CUT),globalBuffer.place(self.FileList.parentItem),self.FileList.mode===MEDIA_TYPE_FAVORITES&&(globalBuffer.onPaste=function(item){self.FavRemove(item.url)}),items.forEach(function(item){globalBuffer.add(item)}),self.Tray.iconBuffer.src=PATH_IMG_PUBLIC+"ico_cut.png",self.Tray.handleInner.appendChild(self.Tray.iconBuffer),self.Tray.Show(!0,!1);break;case MEDIA_ACTION_COPY:echo("MEDIA_ACTION_COPY"),globalBuffer.clear(),globalBuffer.mode(globalBuffer.MODE_COPY),globalBuffer.place(self.FileList.parentItem),items.forEach(function(item){globalBuffer.add(item)}),self.Tray.iconBuffer.src=PATH_IMG_PUBLIC+"ico_copy.png",self.Tray.handleInner.appendChild(self.Tray.iconBuffer),self.Tray.Show(!0,!1);break;case MEDIA_ACTION_DELETE:echo("MEDIA_ACTION_DELETE"),self.actionDelete()}break;case MEDIA_ACTION_PASTE:self.FileList.mode===MEDIA_TYPE_FAVORITES&&(globalBuffer.paste(function(item){self.FavAdd(item.url,item)}),self.FileList.Refresh(),self.Preview.SetItemsCount(),self.Tray.iconBuffer.parentNode===self.Tray.handleInner&&self.Tray.handleInner.removeChild(self.Tray.iconBuffer),self.Tray.Show(0!==self.Tray.handleInner.children.length,!1));break;case MEDIA_ACTION_ADD_FAV:self.actionF3add();break;case MEDIA_ACTION_REMOVE_FAV:self.actionF3del()}return!1}}),this.ModalMenu.Menu.gedit.iopen=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_OPEN,_("Open"),{icon:remoteControlButtonsImagesPath+"ok.png"}),this.ModalMenu.Menu.gedit.iopensl=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_OPEN_SELECTED,_("Open selected")),this.ModalMenu.Menu.gedit.ismount=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_SUBTITLE_MOUNT,_("Mount")),this.ModalMenu.Menu.gedit.imount=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_ITEM_MOUNT,_("Mount share")),this.ModalMenu.Menu.gedit.iunmount=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_ITEM_UNMOUNT,_("Unmount share")),this.ModalMenu.Menu.gedit.iedit=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_MOUNT_EDIT,_("Edit share")),this.ModalMenu.Menu.gedit.iselone=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_SELECT_ONE,_("Select"),{icon:remoteControlButtonsImagesPath+"f2.png"}),this.ModalMenu.Menu.gedit.iselall=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_SELECT_ALL,_("Select all")),720!==WINDOW_WIDTH&&(this.ModalMenu.Menu.gedit.iaddfav=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_ADD_FAV,_("Add to favourites"),{icon:remoteControlButtonsImagesPath+"f3.png"}),this.ModalMenu.Menu.gedit.iremfav=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_REMOVE_FAV,_("Remove from favourites"),{icon:remoteControlButtonsImagesPath+"f3.png"})),this.ModalMenu.Menu.gedit.ideselect=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_DESELECT,_("Deselect all")),this.ModalMenu.Menu.gedit.iinvert=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_INVERT,_("Invert selection")),this.ModalMenu.Menu.gedit.icut=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_CUT,_("Cut")),this.ModalMenu.Menu.gedit.icopy=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_COPY,_("Copy")),this.ModalMenu.Menu.gedit.ipaste=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_PASTE,_("Paste")),this.ModalMenu.Menu.gedit.idelete=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gedit,MEDIA_ACTION_DELETE,_("Delete")),this.ModalMenu.Menu.gview=this.ModalMenu.Menu.AddGroup("gview",_("View"),{onclick:function(){return this.self.Marked(this.self.FindOne({marked:!0}),!1),this.self.Marked(this,!0),this.self.Focused(this,!0),self.ModalMenu.Show(!1),self.FileList.SetFilterType(this.iid),this.iid!==MEDIA_TYPE_NONE||globalBuffer.size()>0?(elclear(self.Tray.handleInner),this.iid!==MEDIA_TYPE_NONE&&(self.Tray.iconFilter.src=PATH_IMG_PUBLIC+"media/type_"+this.iid+".png",self.Tray.handleInner.appendChild(self.Tray.iconFilter)),globalBuffer.size()>0&&(self.Tray.iconBuffer.src=PATH_IMG_PUBLIC+(globalBuffer.mode()===globalBuffer.MODE_COPY?"ico_copy.png":"ico_cut.png"),self.Tray.handleInner.appendChild(self.Tray.iconBuffer)),self.Tray.Show(!0,!1)):self.Tray.Show(!1,!1),!1}}),this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gview,MEDIA_TYPE_NONE,_("All"),{marked:!0,focused:!0}),this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gview,MEDIA_TYPE_FOLDER,_("Folders")),this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gview,MEDIA_TYPE_AUDIO,_("Audio")),this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gview,MEDIA_TYPE_VIDEO,_("Video")),this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gview,MEDIA_TYPE_IMAGE,_("Images")),this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gview,MEDIA_TYPE_PLAYLIST,_("Playlists")),this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gview,MEDIA_TYPE_ISO,_("ISO")),this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gview,MEDIA_TYPE_TEXT,_("Subtitles")),this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gview,MEDIA_TYPE_STREAM,_("Streams")),this.ModalMenu.Menu.gsort=this.ModalMenu.Menu.AddGroup("gsort",_("Sort"),{onclick:function(){return self.ModalMenu.Show(!1),self.FileList.mode===MEDIA_TYPE_FAVORITES?self.FavSort(this.iid):self.FileList.sortType!==this.iid&&(self.FileList.sortType=this.iid),self.FileList.Refresh(),!1}}),this.ModalMenu.Menu.gsort.iname=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gsort,MEDIA_ACTION_SORT_NAME,_("By name"),{focused:!0}),this.ModalMenu.Menu.gsort.isize=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gsort,MEDIA_ACTION_SORT_SIZE,_("By size")),this.ModalMenu.Menu.gsort.itype=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gsort,MEDIA_ACTION_SORT_TYPE,_("By type")),this.ModalMenu.Menu.gsort.iext=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gsort,MEDIA_ACTION_SORT_EXT,_("By extension")),this.ModalMenu.Menu.gtools=this.ModalMenu.Menu.AddGroup("gtools",_("Tools"),{onclick:function(){switch(self.ModalMenu.Show(!1),this.iid){case MEDIA_ACTION_TOOLS_MOUNT:new CModalMount(self);break;case MEDIA_ACTION_TOOLS_UNMOUNT:new CModalUnmount(self,self.FileList.activeItem.data.link);break;case MEDIA_ACTION_TOOLS_FORMAT:new CModalFormat(self)}return!1}}),this.ModalMenu.Menu.gtools.imount=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gtools,MEDIA_ACTION_TOOLS_MOUNT,_("Connect NFS/SMB")),this.ModalMenu.Menu.gtools.iunmount=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gtools,MEDIA_ACTION_TOOLS_UNMOUNT,_("Disconnect NFS/SMB"),{disabled:!0}),this.ModalMenu.Menu.gtools.iformat=this.ModalMenu.Menu.AddItem(this.ModalMenu.Menu.gtools,MEDIA_ACTION_TOOLS_FORMAT,_("Disk formatting"),{hidden:0===HDD_INFO.length}),this.ModalMenu.Menu.Switch(this.ModalMenu.Menu.gedit),this.BCrumb=new CBreadCrumb(this),this.BCrumb.showAttr="table-cell",this.BCrumb.rightItems=720===WINDOW_WIDTH?1:2,this.BCrumb.Init(PATH_IMG_PUBLIC,this.handle.querySelector(".body .header .cbcrumb")),this.BCrumb.SetName(_("Home Media")),this.SearchBar=new CFilterInput(this,{parent:this.handle.querySelector(".body .header .csbar"),hint:_("Enter path or file name..."),folded:!0,events:{onEnter:function(){return echo(this.GetValue(),"this.GetValue()"),self.FileList.path[self.FileList.path.length-1].filterText&&(self.FileList.path.pop(),self.BCrumb.Pop()),this.GetValue()?self.FileList.SetFilterText(this.GetValue()):(self.FileList.path[self.FileList.path.length-1].filterText=self.FileList.filterText=self.FileList.parentItem.filterText="",self.FileList.Refresh()),self.BCrumb.Show(!0),self.FileList.onFocus(self.FileList.activeItem),!0},onChange:function(){self.SearchBar.timer&&clearTimeout(self.SearchBar.timer),self.SearchBar.timer=setTimeout(function(){var index=self.FileList.FirstMatch(self.SearchBar.GetValue());-1!==index&&(self.FileList.Focused(index,!0),self.SearchBar.focus())},400)},onUnfold:function(){self.BCrumb.Show(!1)},onFold:function(){self.BCrumb.Show(!0)},onKey:function(){this.SetValue(self.FileList.path[self.FileList.path.length-1].filterText||"")}}}),this.SearchBar.timer=0,this.ExitBPanel=new CButtonPanel(this),this.ExitBPanel.Init(remoteControlButtonsImagesPath,this.handle.querySelector(".body .footer .exit div.cbpanel-main")),this.ExitBPanel.btnExit=this.ExitBPanel.Add(KEYS.EXIT,"exit.png",configuration.newRemoteControl?_("Exit"):"",function(){MediaBrowser.actionExit()}),this.BPanel=new CButtonPanel(this),this.BPanel.Init(remoteControlButtonsImagesPath,this.handle.querySelector(".body .footer .main div.cbpanel-main")),this.BPanel.btnMenu=this.BPanel.Add(KEYS.MENU,"menu.png",configuration.newRemoteControl?_("Menu"):"",function(){self.actionMenu()}),this.BPanel.btnFrame=this.BPanel.Add(KEYS.INFO,"info.png",_("Show<br>info panel"),function(){self.actionFrame()}),this.BPanel.btnF2=this.BPanel.Add(KEYS.F2,"f2.png",_("Select"),function(){self.actionF2()}),this.BPanel.btnF3add=this.BPanel.Add(KEYS.F3,"f3.png",_("Add to<br>favourites"),function(){self.actionF3add()}),this.BPanel.btnF3del=this.BPanel.Add(KEYS.F3,"f3.png",_("Remove from<br>favourites"),function(){self.actionF3del()},!0),this.FileList=new CFileList(this),this.FileList.Init({handle:this.handle.querySelector(".body .content .vlist-main"),scrollBar:new VScrollBar({$node:this.handle.querySelector(".body .content .vscroll")})}),this.FileList.SetBreadCrumb(this.BCrumb),this.FileList.SetSearchBar(this.SearchBar),this.Preview.Init(this.handle.querySelector(".content .sbar")),this.Preview.Show(!1,!1),this.Preview.body=this.Preview.handle.querySelector("td.view"),this.Preview.blkAll=this.Preview.handle.querySelector("div.block.all"),this.Preview.blkSel=this.Preview.handle.querySelector("div.block.sel"),this.Preview.valAll=this.Preview.blkAll.querySelector("span.value"),this.Preview.valSel=this.Preview.blkSel.querySelector("span.value"),this.Preview.blkAll.querySelector("span.title").innerHTML=_("Items:"),this.Preview.blkSel.querySelector("span.title").innerHTML=_("Selected:"),this.Preview.showAttr="table-cell",this.Preview.infoIcon=element("img",{align:"left",src:PATH_IMG_PUBLIC+"media/ico_info.png"}),this.Preview.actionInfo={},this.Preview.actionInfo[MEDIA_TYPE_BACK]=this.Preview.InfoBack,this.Preview.actionInfo[MEDIA_TYPE_SAMBA_ROOT]=this.Preview.InfoSambaRoot,this.Preview.actionInfo[MEDIA_TYPE_SAMBA_GROUP]=this.Preview.InfoSambaGroup,this.Preview.actionInfo[MEDIA_TYPE_SAMBA_HOST]=this.Preview.InfoSambaHost,this.Preview.actionInfo[MEDIA_TYPE_SAMBA_SHARE]=this.Preview.InfoSambaShare,this.Preview.actionInfo[MEDIA_TYPE_NFS_SHARE]=this.Preview.InfoNfsShare,this.Preview.actionInfo[MEDIA_TYPE_UPNP]=this.Preview.InfoUpnp,this.Preview.actionInfo[MEDIA_TYPE_RECORDS_ROOT]=this.Preview.InfoRecordsRoot,this.Preview.actionInfo[MEDIA_TYPE_RECORDS_CHAN]=this.Preview.InfoRecordsChan,this.Preview.actionInfo[MEDIA_TYPE_RECORDS_DATE]=this.Preview.InfoRecordsDate,this.Preview.actionInfo[MEDIA_TYPE_STORAGE_SATA]=this.Preview.InfoStorage,this.Preview.actionInfo[MEDIA_TYPE_STORAGE_USB]=this.Preview.InfoStorage,this.Preview.actionInfo[MEDIA_TYPE_STORAGE_SD]=this.Preview.InfoStorage,this.Preview.actionInfo[MEDIA_TYPE_FAVORITES]=this.Preview.InfoFavorites,this.Preview.actionInfo[MEDIA_TYPE_FOLDER]=this.Preview.InfoFolder,this.Preview.actionInfo[MEDIA_TYPE_VIDEO]=this.Preview.InfoFile,this.Preview.actionInfo[MEDIA_TYPE_AUDIO]=this.Preview.InfoFile,this.Preview.actionInfo[MEDIA_TYPE_IMAGE]=this.Preview.InfoFile,this.Preview.actionInfo[MEDIA_TYPE_ISO]=this.Preview.InfoFile,this.Preview.actionInfo[MEDIA_TYPE_RECORDS_ITEM]=this.Preview.InfoFile,this.Preview.actionInfo[MEDIA_TYPE_PLAYLIST]=this.Preview.InfoPlaylist,this.Preview.actionInfo[MEDIA_TYPE_STREAM]=this.Preview.InfoStream,this.Preview.actionInfo[MEDIA_TYPE_TEXT]=this.Preview.InfoText,this.Preview.actionInfo[MEDIA_TYPE_CUE]=this.Preview.InfoCue,this.Preview.actionInfo[MEDIA_TYPE_CUE_ITEM]=this.Preview.InfoFile,this.Preview.onShow=function(){self.FileList.activeItem&&this.Info(self.FileList.activeItem.data)},this.Preview.SetProgress=function(value){this.isVisible&&this.pgval&&(value>=100&&(value=100),0>value&&(value=0),this.pgval.style.width=value+"%")},this.Preview.SetItemsCount=function(){this.valAll.innerHTML=this.parent.FileList.path.length>1?this.parent.FileList.Length()-1:this.parent.FileList.Length()},this.Preview.Rewind=function(){this.isVisible&&this.player&&gSTB.IsPlaying()&&MediaPlayer.setPos(-1)},this.Preview.Forward=function(){this.isVisible&&this.player&&gSTB.IsPlaying()&&MediaPlayer.setPos(1)},this.Preview.PlayPause=function(){if(this.parent.actionFrame(!0),MediaPlayer.playNow||null!==MediaPlayer.obj)MediaPlayer.playPause();else{this.parent.FileList.playListSet||(MediaPlayer.prepareList(this.parent.FileList.playList),MediaPlayer.setSubList(this.parent.FileList.subList),this.parent.FileList.playListSet=!0);var file=this.parent.FileList.activeItem.data;-1!==this.parent.playable.indexOf(file.type)&&(this.player.className="player load",MediaPlayer.preparePlayer(file,this.parent,!1,!1,!this.parent.BPanel.btnF3add.data.hidden||!this.parent.BPanel.btnF3del.data.hidden,!1),file.type===MEDIA_TYPE_IMAGE&&(this.player.className="player play"))}},this.Preview.GetRect=function(){switch(VIDEO_MODE){case"480i":case"480p":return{x:458,y:94,a:228,b:151};case"576i":case"576p":return{x:463,y:110,a:228,b:151};case"720p":case"720p60":switch(WINDOW_WIDTH){case 720:return{x:822,y:134,a:407,b:190};case 1280:return{x:846,y:130,a:394,b:220}}break;case"1080i":case"1080i60":case"1080p":case"1080p60":switch(WINDOW_WIDTH){case 720:return{x:1232,y:201,a:613,b:288};case 1280:return{x:1266,y:194,a:590,b:328};case 1920:return{x:1278,y:196,a:592,b:327}}}return{x:0,y:0,a:0,b:0}},this.Preview.playerRect=this.Preview.GetRect(),this.Tray=new CBase(this),this.Tray.Init(this.handle.querySelector(".header .tray")),this.Tray.Show(!1,!1),this.Tray.showAttr="table-cell",this.Tray.iconFilter=element("img"),this.Tray.iconBuffer=element("img",{className:"copy"})},MediaBrowser.onShow=function(){this.FileList.Activate(),getStorageInfo()},MediaBrowser.EventHandler=function(event){if(this.SearchBar.EventHandler(event)!==!0)switch(event.code){case KEYS.OK:case KEYS.PAGE_UP:case KEYS.PAGE_DOWN:case KEYS.UP:case KEYS.DOWN:case KEYS.LEFT:case KEYS.RIGHT:case KEYS.HOME:case KEYS.END:this.FileList.EventHandler(event);break;case 32:this.actionF2(),event.preventDefault();break;case KEYS.EXIT:this.actionExit();break;case KEYS.BACK:this.actionBack();break;case KEYS.MENU:case KEYS.INFO:case KEYS.F2:case KEYS.F3:this.BPanel.EventHandler(event);break;case KEYS.PLAY_PAUSE:this.Preview.PlayPause();break;case KEYS.REWIND:this.Preview.Rewind();break;case KEYS.FORWARD:this.Preview.Forward();break;case KEYS.STOP:break;case 49:case 50:case 51:case 52:this.ModalMenu.Show(!0);var tabs={49:"gedit",50:"gview",51:"gsort",52:"gtools"};this.ModalMenu.Menu.Switch(this.ModalMenu.Menu[tabs[event.code]])}},MediaBrowser.Reset=function(unmount,unbind){unmount!==!1&&(this.UnmountSMB(),this.UnmountNFS()),this.FileList.Open({type:MEDIA_TYPE_ROOT_MB}),this.actionFrame(!1),elclear(this.Preview.body)},MediaBrowser.actionExit=function(){var self=this;return FAVORITES_CHANGED?(new CModalConfirm(this,_("The list of favourite records has changed"),_("Save updated list of favourite records?"),_("Exit without saving"),function(){setTimeout(function(){self.FavRestore(),self.actionExit()},5)},_("Save"),function(){setTimeout(function(){self.FavSave(),self.actionExit()},5)}),!1):(1!==MediaBrowser.windowId&&stbWindowMgr.windowHide(MediaBrowser.windowId),!0)},MediaBrowser.actionBack=function(){MediaBrowser.FileList.parentItem.type!==MEDIA_TYPE_ROOT_MB||MediaBrowser.FileList.parentItem.filterText?this.FileList.Open({type:MEDIA_TYPE_BACK}):this.actionExit()},MediaBrowser.actionMenu=function(){this.ModalMenu.Show(!0)},MediaBrowser.actionF2=function(move){if(!this.BPanel.btnF2.data.hidden){var infav=this.FileList.mode===MEDIA_TYPE_FAVORITES,canAdd=!1,item=this.FileList.activeItem;item.data.markable&&this.FileList.Marked(item.data,!item.data.marked)&&(move!==!1&&this.FileList.move(KEYS.DOWN),!infav&&item.data.marked&&(this.FileList.states.marked.forEach(function(item){item.type!==MEDIA_TYPE_FOLDER&&(canAdd=!0)}),this.FileList.canFav&&canAdd&&(this.BPanel.Hidden(this.BPanel.btnF3add,!1),this.BPanel.Hidden(this.BPanel.btnF3del,!0))))}},MediaBrowser.actionF3add=function(){var self=this;if(!this.BPanel.btnF3add.data.hidden){var items=this.FileList.ActiveItems();if(items.length>0){var count=0;items.forEach(function(item){item.type!==MEDIA_TYPE_FOLDER&&(self.FileList.SetStar(item,!0),self.FavAdd(item.url,item),count++)}),count>0&&(this.BPanel.Hidden(this.BPanel.btnF3add,!0),this.BPanel.Hidden(this.BPanel.btnF3del,!1))}}},MediaBrowser.actionF3del=function(){var self=this,curPos=null;if(!this.BPanel.btnF3del.data.hidden){var infav=this.FileList.parentItem.type===MEDIA_TYPE_FAVORITES,items=this.FileList.ActiveItems();items.length>0&&(items.forEach(function(item){self.FavRemove(item.url),infav||self.FileList.SetStar(item,!1)}),infav?(this.FileList.DeleteAll(items),0===this.FileList.Length()?(this.BPanel.Hidden(this.BPanel.btnF2,!0),this.BPanel.Hidden(this.BPanel.btnF3del,!0)):null!==curPos&&self.FileList.Focused(curPos,!0),this.FileList.Activate()):(this.BPanel.Hidden(this.BPanel.btnF3add,!1),this.BPanel.Hidden(this.BPanel.btnF3del,!0)))}},MediaBrowser.actionFrame=function(state){state=void 0!==state?state:!this.Preview.isVisible,this.Preview.Show(state,!1),this.BPanel.Rename(this.BPanel.btnFrame,_(this.Preview.isVisible?"Hide<br>info panel":"Show<br>info panel")),this.Preview.handle.parentNode.className=state?"preview":"",!this.Preview.isVisible},MediaBrowser.actionDelete=function(){var self=this,items=this.FileList.ActiveItems();if(0!==items.length){var status=!0;this.FileList.mode===MEDIA_TYPE_FAVORITES?this.actionF3del():-1!==[MEDIA_TYPE_STORAGE_SATA,MEDIA_TYPE_STORAGE_USB,MEDIA_TYPE_STORAGE_SD].indexOf(this.FileList.mode)&&("true"===environment.mount_media_ro?new CModalAlert(this,_("Warning!"),_('"Storage read only access mode" is enabled in System Settings'),_("Close")):new CModalConfirm(this,_("Confirm deletion"),_("Are you sure you want to delete")+"<br>"+_(items.length>1?"all entries selected?":"current entry?"),_("Cancel"),function(){},_("Yes"),function(){setTimeout(function(){var itemList=[];items.forEach(function(item){self.actionFileDelete(item)?(globalBuffer.remove(item),item.stared&&self.FavRemove(item.url),itemList.push(item)):status=!1}),self.FileList.DeleteAll(itemList),getStorageInfo(),0===globalBuffer.size()&&(self.Tray.iconBuffer.parentNode===self.Tray.handleInner&&self.Tray.handleInner.removeChild(self.Tray.iconBuffer),self.Tray.Show(0!==self.Tray.handleInner.children.length,!1)),self.FileList.Activate(!0),echo(status,"status"),status||new CModalAlert(self,_("Deletion error"),_("Unable to remove all selected items"),_("Close"),function(){setTimeout(function(){self.FileList.Activate(!0)},5)}),self.FileList.playList=[],self.FileList.Each(function(item){-1!==self.playable.indexOf(item.type)&&self.FileList.playList.push(item)}),self.FileList.playListSet=!0},5)}))}},MediaBrowser.actionFileDelete=function(data){var status,command;return command=data.type===MEDIA_TYPE_FOLDER?'RemoveDirFull "'+("/"===data.url.charAt(data.url.length-1)?data.url.substr(0,data.url.length-1):data.url)+'"':'RemoveFile "'+data.url+'"',echo(command,"actionFileDelete command"),status="Ok"===gSTB.RDir(command)},MediaBrowser.FavAdd=function(name,data){if(name&&data&&data.type!==MEDIA_TYPE_FOLDER&&data.type!==MEDIA_TYPE_GROUP){if(this.FileList.mode===MEDIA_TYPE_RECORDS_ROOT){var path=this.FileList.path;data.name=path[path.length-2].name+" / "+path[path.length-1].name+" / "+data.name}echo("MediaBrowser.FavAdd"),FAVORITES_NEW[name]=data,FAVORITES_CHANGED=!0}},MediaBrowser.FavRemove=function(name){return FAVORITES_NEW[name]?(delete FAVORITES_NEW[name],FAVORITES_CHANGED=!0):FAVORITES_CHANGED=!1,echo(FAVORITES_CHANGED,"MediaBrowser.FavRemove"),FAVORITES_CHANGED},MediaBrowser.FavSave=function(data){echo("MediaBrowser.FavSave"),void 0!==data&&data instanceof Object&&(FAVORITES_NEW=data),FAVORITES={};for(var name in FAVORITES_NEW)FAVORITES[name]=FAVORITES_NEW[name];gSTB.SaveUserData("favorites.json",JSON.stringify(FAVORITES)),FAVORITES_CHANGED=!1},MediaBrowser.FavRestore=function(){echo("MediaBrowser.FavRestore"),FAVORITES_NEW={};for(var name in FAVORITES)FAVORITES_NEW[name]=FAVORITES[name];FAVORITES_CHANGED=!1},MediaBrowser.FavSort=function(sortType){echo("MediaBrowser.FavSort");var list=[];for(var name in FAVORITES_NEW)list.push(FAVORITES_NEW[name]);list.sort(function(a,b){return a.name.toLowerCase().localeCompare(b.name.toLowerCase())}),sortType===MEDIA_ACTION_SORT_TYPE?list.sort(function(a,b){return a.type-b.type}):sortType===MEDIA_ACTION_SORT_EXT?list.sort(function(a,b){return a.ext.toLowerCase().localeCompare(b.ext.toLowerCase())}):sortType===MEDIA_ACTION_SORT_SIZE&&list.sort(function(a,b){return a.size-b.size}),echo(list,"FavSort list"),FAVORITES_NEW={},list.forEach(function(item){FAVORITES_NEW[item.url]=item}),echo(FAVORITES_NEW,"FAVORITES_NEW"),FAVORITES_CHANGED=!0},MediaBrowser.UnmountSMB=function(force){(SMB_MOUNTED||force===!0)&&(gSTB.ExecAction("umount_dir "+SMB_PATH),SMB_MOUNTED=!1,SMB_DATA=null,echo("umount "+SMB_PATH))},MediaBrowser.UnmountNFS=function(force){(NFS_MOUNTED||force===!0)&&(gSTB.ExecAction("umount_dir "+NFS_PATH),NFS_MOUNTED=!1,NFS_DATA=null,echo("umount "+NFS_PATH))},MediaBrowser.MountSMB=function(data){var login,pass,command,status;return SMB_MOUNTED?!0:data&&data.address?(data.address="/"===data.address.charAt(data.address.length-1)?data.address.substr(0,data.address.length-1):data.address,login=data.login||(SMB_AUTH[data.address]&&SMB_AUTH[data.address].login?SMB_AUTH[data.address].login:"guest"),pass=data.pass||(SMB_AUTH[data.address]&&SMB_AUTH[data.address].pass?SMB_AUTH[data.address].pass:""),command='mount cifs "'+data.address+'" "'+SMB_PATH+'" username='+login+",password="+pass+",iocharset=utf8,unc="+data.address.replace(/\//g,"\\"),status=gSTB.RDir(command).trim(),echo(status,command),SMB_MOUNTED="Ok"===status,SMB_MOUNTED&&(SMB_AUTH[data.address]||(SMB_AUTH[data.address]={}),SMB_AUTH[data.address].login=login,SMB_AUTH[data.address].pass=pass,SMB_DATA=data.link),SMB_MOUNTED):!1},MediaBrowser.MountNFS=function(data){if(NFS_MOUNTED)return!0;if(data&&data.address){data.address="/"===data.address.charAt(data.address.length-1)?data.address.substr(0,data.address.length-1):data.address;var command='mount nfs "'+data.address+'" "'+NFS_PATH+'" nolock,ro,rsize=4096,wsize=4096,udp',status=gSTB.RDir(command);return echo(status,command),NFS_MOUNTED="Ok"===status,SMB_MOUNTED&&(NFS_DATA=data.link),NFS_MOUNTED}return!1},MediaBrowser.bytesToSize=function(bytes,precision){var kilobyte=1024,megabyte=1024*kilobyte,gigabyte=1024*megabyte,terabyte=1024*gigabyte;return bytes>=0&&kilobyte>bytes?bytes+" B":bytes>=kilobyte&&megabyte>bytes?(bytes/kilobyte).toFixed(precision)+" KB":bytes>=megabyte&&gigabyte>bytes?(bytes/megabyte).toFixed(precision)+" MB":bytes>=gigabyte&&terabyte>bytes?(bytes/gigabyte).toFixed(precision)+" GB":bytes>=terabyte?(bytes/terabyte).toFixed(precision)+" TB":bytes+" B";
},MediaBrowser.Preview.InfoBack=function(){this.parent.FileList.filterText?elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Contains a list of items corresponding to the given filter request"))])):elchild(elclear(this.body),this.Info(this.parent.FileList.parentItem))},MediaBrowser.Preview.InfoSambaRoot=function(){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("LAN supports SMB/CIFS protocol, contains available working groups"))]))},MediaBrowser.Preview.InfoSambaGroup=function(){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("List of working group computers"))]))},MediaBrowser.Preview.InfoSambaHost=function(){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("List of available folders for every computer"))]))},MediaBrowser.Preview.InfoSambaShare=function(data){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Access to folders and files of selected network folder")),element("br"),element("div",{className:"lbl"},[_("Folder:"),element("span",{className:"txt"},data.name)]),element("div",{className:"lbl"},[_("Address:"),element("span",{className:"txt"},data.address)]),element("div",{className:"lbl"},[_("Type:"),element("span",{className:"txt"},"SMB/CIFS")])]))},MediaBrowser.Preview.InfoNfsShare=function(data){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Access to folders and files of selected network folder")),element("br"),element("div",{className:"lbl"},[_("Folder:"),element("span",{className:"txt"},data.name)]),element("div",{className:"lbl"},[_("Address:"),element("span",{className:"txt"},data.address)]),element("div",{className:"lbl"},[_("Type:"),element("span",{className:"txt"},"NFS")])]))},MediaBrowser.Preview.InfoUpnp=function(){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Plug&Play, a set of protocols for seamless connection of network devices, home and corporate. Easy and user-friendly access to media files in LAN."))]))},MediaBrowser.Preview.InfoRecordsRoot=function(){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Access to list of Timeshift and PVR records collected from all available at the moment storages. All records are grouped by the channel names."))]))},MediaBrowser.Preview.InfoRecordsChan=function(){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Opens a list of Timeshift and PVR records sorted by record date"))]))},MediaBrowser.Preview.InfoRecordsDate=function(){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Access to list of Timeshift and PVR records sorted by record time"))]))},MediaBrowser.Preview.InfoFavorites=function(){var name,total=0;for(name in FAVORITES)total++;elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Opens a full editable list of favourite records")),element("br"),element("div",{className:"lbl"},[_("Saved items:"),element("span",{className:"txt"},String(total))]),element("div",{className:"lbl"},[_("Unsaved changes:"),element("span",{className:"txt"},_(FAVORITES_CHANGED?"yes":"no"))])]))},MediaBrowser.Preview.InfoFolder=function(){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Access to folders and files"))]))},MediaBrowser.Preview.InfoFile=function(data){var self=this,size=120,name=data.name.substr(0,size-1)+(data.name.length>size?"...":""),info=[element("div",{className:"file"},[this.player=element("div",{className:"player stop",onclick:function(){self.PlayPause(),setTimeout(function(){self.parent.FileList.Activate(!0)},5)}}),this.pgbar=element("div",{className:"pgbar"}),this.pgval=element("div",{className:"pgval"})]),element("br"),element("div",{className:"lbl"},[_("Name:"),element("span",{className:"txt"},name)])];void 0!==data.size&&info.push(element("div",{className:"lbl"},[_("Size:"),element("span",{className:"txt"},this.parent.bytesToSize(data.size,1))])),void 0!==data.performer&&info.push(element("div",{className:"lbl"},[_("Performer:"),element("span",{className:"txt"},data.performer)])),void 0!==data.file&&info.push(element("div",{className:"lbl"},[_("File:"),element("span",{className:"txt"},data.file)])),elchild(elclear(this.body),this.body.info=element("div",{},info)),data.type===MEDIA_TYPE_IMAGE&&this.parent.Preview.PlayPause()},MediaBrowser.Preview.InfoPlaylist=function(data){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("List of files or network streams to play")),element("br"),element("div",{className:"lbl"},[_("Size:"),element("span",{className:"txt"},this.parent.bytesToSize(data.size,1))])]))},MediaBrowser.Preview.InfoText=function(data){elchild(elclear(this.body),element("div",{},[this.infoIcon,element("div",{className:"text"},_("Text file with media subtitles or other data")),element("br"),element("div",{className:"lbl"},[_("Size:"),element("span",{className:"txt"},this.parent.bytesToSize(data.size,1))])]))},MediaBrowser.Preview.InfoStream=function(data){var self=this,size=100,name=data.name.substr(0,size/2-1)+(data.name.length>size/2?"...":""),url=data.url.substr(0,size-1)+(data.url.length>size?"...":"");elchild(elclear(this.body),element("div",{},[element("div",{className:"file"},[this.player=element("div",{className:"player stop",onclick:function(){self.PlayPause()}}),this.pgbar=element("div",{className:"pgbar"}),this.pgval=element("div",{className:"pgval"})]),element("br"),element("div",{className:"lbl"},[_("Name:"),element("span",{className:"txt"},name)]),element("div",{className:"lbl"},[_("Address:"),element("span",{className:"txt"},url)])]))},MediaBrowser.Preview.InfoCue=function(data){void 0===data.cue&&(data.cue=this.parent.ParseCue(gSTB.RDir('GetFile "'+data.url+'"')));var info=[this.infoIcon,element("div",{className:"text"},_("List of album files with additional info")),element("br")];void 0!==data.cue.title&&info.push(element("div",{className:"lbl"},[_("Name:"),element("span",{className:"txt"},data.cue.title)])),void 0!==data.cue.performer&&info.push(element("div",{className:"lbl"},[_("Performer:"),element("span",{className:"txt"},data.cue.performer)])),void 0!==data.cue.songwriter&&info.push(element("div",{className:"lbl"},[_("Song by:"),element("span",{className:"txt"},data.cue.songwriter)])),void 0!==data.cue.genre&&info.push(element("div",{className:"lbl"},[_("Genre:"),element("span",{className:"txt"},data.cue.genre)])),void 0!==data.cue.date&&info.push(element("div",{className:"lbl"},[_("Date:"),element("span",{className:"txt"},data.cue.date)])),void 0!==data.cue.place&&info.push(element("div",{className:"lbl"},[_("Place:"),element("span",{className:"txt"},data.cue.place)])),void 0!==data.cue.comment&&info.push(element("div",{className:"lbl"},[_("Comment:"),element("span",{className:"txt"},data.cue.comment)])),1===data.cue.files.length?info.push(element("div",{className:"lbl"},[_("File:"),element("span",{className:"txt"},data.cue.files[0].name)])):info.push(element("div",{className:"lbl"},[_("Files:"),element("span",{className:"txt"},data.cue.files.length)])),elchild(elclear(this.body),element("div",{},info))},MediaBrowser.Preview.InfoStorage=function(data){var canvas=element("canvas"),ctx=canvas.getContext("2d");elchild(elclear(this.body),element("div",{},[element("div",{className:"draw"},canvas),element("div",{className:"hint"},_("Available")+" "+this.parent.bytesToSize(data.free,1)+" "+_("from")+" "+this.parent.bytesToSize(data.size,1)),element("div",{className:"lbl"},[_("Read only:"),element("span",{className:"txt"},_(data.readOnly?"yes":"no"))]),element("div",{className:"lbl"},[_("Type:"),element("span",{className:"txt"},configuration.fileSystemTypes[data.fsType]||"(n/a)")])]));for(var lastend=0,vals=[data.size-data.free,data.free],myTotal=0,myColor=["#ffc20e","#2a2c2f"],e=0;e<vals.length;e++)myTotal+=vals[e];canvas.width=canvas.height=MediaBrowser.Preview.handleInner.scrollHeight/2;for(var i=0;i<vals.length;i++)ctx.fillStyle=myColor[i],ctx.beginPath(),ctx.moveTo(canvas.width/2,canvas.height/2),ctx.arc(canvas.width/2,canvas.height/2,canvas.height/2,lastend,lastend+2*Math.PI*(vals[i]/myTotal),!1),ctx.lineTo(canvas.width/2,canvas.height/2),ctx.fill(),lastend+=2*Math.PI*(vals[i]/myTotal)},MediaBrowser.Preview.Info=function(data){data&&data.type&&"function"==typeof this.actionInfo[data.type]&&this.actionInfo[data.type].call(this,data),elchild(this.body,element("div",{className:"fade"}))},MediaBrowser.ReadFile=function(fileName,encoding){encoding=encoding||"utf-8";var result,xmlhttp=new XMLHttpRequest;try{xmlhttp.overrideMimeType("text/html; charset="+encoding),xmlhttp.open("GET","file://"+fileName,!1),xmlhttp.send(null),result=xmlhttp.responseText}catch(e){echo(e,"some xmlhttp error"),result=""}return echo(result,"file "+fileName),result},MediaBrowser.ParseCue=function(text){var currFile=null,currTrack=null,data={files:[]};return text.split("\n").forEach(function(line){line=line.trim();var lineParts=line.split(" "),lineCmd=lineParts.shift().toLowerCase(),value=line.slice(lineCmd.length).trim();switch(lineCmd){case"title":case"performer":case"songwriter":'"'===value.charAt(0)&&'"'===value.charAt(value.length-1)&&(value=value.slice(1,value.length-1)),null!==currTrack?currTrack[lineCmd]=value:data[lineCmd]=value;break;case"file":currFile={tracks:[]};var parts=value.split(" ");parts.length>1&&'"'!==value.charAt(value.length-1)&&(currFile.type=parts.pop(),value=value.slice(0,-currFile.type.length).trim()),'"'===value.charAt(0)&&'"'===value.charAt(value.length-1)&&(value=value.slice(1,value.length-1)),currFile.name=value,data.files.push(currFile);break;case"track":currTrack={number:lineParts[0],type:lineParts[1],index:[]},currFile.tracks.push(currTrack);break;case"rem":if(-1!==["GENRE","DATE","COMMENT","PLACE"].indexOf(lineParts[0])){value=value.slice(lineParts[0].length).trim();var field=lineParts[0].toLowerCase();'"'===value.charAt(0)&&'"'===value.charAt(value.length-1)&&(value=value.slice(1,value.length-1)),null!==currTrack?currTrack[field]=value:data[field]=value}break;case"index":if(null!==currTrack){var time=(lineParts[1]||"00:00:00").split(":");currTrack.index.push(60*parseInt(time[0],10)+parseInt(time[1],10))}}}),data},MediaBrowser.ParseM3u=function(text){var lines=text.trim().split("\n"),currItem={},data={strict:!1,config:{},items:[]};return lines=lines.map(Function.prototype.call,String.prototype.trim),lines=lines.filter(Boolean),lines.length>0&&("#EXTM3U"===lines[0]&&(data.strict=!0,lines.shift()),lines.forEach(function(line){var comment,divPos,optKey,optVal;if("#"===line.charAt(0))switch(line.substr(1,6).toUpperCase()){case"EXTCFG":comment=line.substr(7).trim(),divPos=comment.indexOf("="),divPos>0&&(optKey=comment.substr(0,divPos).trim(),optVal=comment.substr(divPos+1).trim(),optKey&&optVal&&(optKey=optKey.split("."),1===optKey.length?data.config[optKey[0]]=optVal:("object"!=typeof data.config[optKey[0]]&&(data.config[optKey[0]]={}),data.config[optKey[0]][optKey[1]]=optVal)));break;case"EXTINF":comment=line.substr(8).trim(),divPos=comment.indexOf(","),divPos>0&&(currItem.time=comment.substr(0,divPos).trim(),currItem.name=comment.substr(divPos+1).trim())}else-1===line.indexOf("://")&&(line=MediaBrowser.FileList.path[MediaBrowser.FileList.path.length-1].url+"/"+line),currItem.url=line,currItem.type=MEDIA_TYPE_STREAM,currItem.name=currItem.name||currItem.url,data.items.push(currItem),currItem={}}),data.config&&["VM_IPTV_ENABLED","VM_OTT_ENABLED","VM_OTT_LOG_ENABLED"].forEach(function(name){data.config[name]&&(data.config[name]=-1!==["true","yes","1"].indexOf(data.config[name].toLowerCase()))})),echo(data,"parsed m3u"),data},MediaBrowser.ParsePlaylist=function(ext,text){var type,extension,data=[],tmp=[],m3uData=text.trim();if(m3uData=m3uData.replace(/^\ufeff/,""),["m3u","m3u8"].indexOf(ext.toLowerCase())>=0){tmp=this.ParseM3u(m3uData).items;for(var i=0;i<tmp.length;i++)extension=tmp[i].url.split(".").pop().toLowerCase(),type=this.FileList.ext2type[extension],tmp[i].type="undefined"==typeof type||-1!==["m3u","m3u8"].indexOf(extension)?tmp[i].type:type,tmp[i].ext=extension,tmp[i].url=tmp[i].url.replace(/\\/g,"/"),data.push(tmp[i])}return data};var CModalManualScanDVBtext=0;CModalAuth.prototype=Object.create(CModalAlert.prototype),CModalAuth.prototype.constructor=CModalAuth,CModalMount.prototype=Object.create(CModalBox.prototype),CModalMount.prototype.constructor=CModalMount,CModalUnmount.prototype=Object.create(CModalBox.prototype),CModalUnmount.prototype.constructor=CModalUnmount,CModalFormat.prototype=Object.create(CModalBox.prototype),CModalFormat.prototype.constructor=CModalFormat,CModalPlayListOpen.prototype=Object.create(CModalBox.prototype),CModalPlayListOpen.prototype.constructor=CModalPlayListOpen,CModalSubtitleOpen.prototype=Object.create(CModalAlert.prototype),CModalSubtitleOpen.prototype.constructor=CModalSubtitleOpen,CModalCreateGroup.prototype=Object.create(CModalBox.prototype),CModalCreateGroup.prototype.constructor=CModalCreateGroup,CModalAddRecord.prototype=Object.create(CModalBox.prototype),CModalAddRecord.prototype.constructor=CModalAddRecord,CModalChannelEdit.prototype=Object.create(CModalBox.prototype),CModalChannelEdit.prototype.constructor=CModalChannelEdit,CModalChannelsAdd.prototype=Object.create(CModalBox.prototype),CModalChannelsAdd.prototype.constructor=CModalChannelsAdd,CModalImportTVChannels.prototype=Object.create(CModalBox.prototype),CModalImportTVChannels.prototype.constructor=CModalImportTVChannels,CModalScanDVB.prototype=Object.create(CModalBox.prototype),CModalScanDVB.prototype.constructor=CModalScanDVB,CModalManualScanDVB.prototype=Object.create(CModalBox.prototype),CModalManualScanDVB.prototype.constructor=CModalManualScanDVB,CModalInitEPGInfo.prototype=Object.create(CModalBox.prototype),CModalInitEPGInfo.prototype.constructor=CModalInitEPGInfo,EPGList.prototype=Object.create(CScrollList.prototype),EPGList.prototype.constructor=EPGList,EPGList.prototype.SetBreadCrumb=function(component){this.bcrumb=component},EPGList.prototype.SetSearchBar=function(component){this.sbar=component},EPGList.prototype.Add=function(obj,attrs){var date=new Date(1e3*obj.time),h=date.getHours(),m=date.getMinutes();h=h>9?h:"0"+h,m=m>9?m:"0"+m;var body=element("div",{className:"item"},[element("b",{},h+":"+m)," "+obj.name]);attrs.name||(attrs.name=obj.name);var item=CScrollList.prototype.Add.call(this,[body],{star:!1,data:attrs,onclick:function(){return!1},oncontextmenu:EMULATION?null:function(){return!1}});return item},EPGList.prototype.onFocus=function(item){this.parent.domText.innerHTML=this.data[item.data.index].details?this.data[item.data.index].details:this.data[item.data.index].info},EPGList.prototype.Back=function(){},EPGList.prototype.Open=function(data){if(data.type===MEDIA_TYPE_ROOT_EPG){this.Clear();for(var i=0;i<this.data.length;i++){var item=this.Add({name:this.data[i].name,index:i,time:this.data[i].start},{name:this.data[i].name,markable:!1,index:i});(DVBChannels.epgNow.now.length&&0===this.parent.day&&this.data[i].start===DVBChannels.epgNow.now[0].start||0===i)&&this.Focused(item,!0)}this.isActive&&this.Activate(),echo(this.data[this.activeItem.data.index]),this.parent.domText.innerHTML=this.data[this.activeItem.data.index].details?this.data[this.activeItem.data.index].details:this.data[this.activeItem.data.index].info}},EPGList.prototype.SetPosition=function(data){if(data)for(var item,i=0,l=this.Length();l>i;i++)if(item=this.handleInner.children[i],data.index===item.data.index)return this.Focused(item,!0);return!1},EPGList.prototype.Marked=function(){return!1},EPGList.prototype.ActiveItems=function(){var items=this.states.marked?this.states.marked.slice():[];return 0===items.length&&this.activeItem&&this.activeItem.data.markable&&items.push(this.activeItem),items},CModalAntennaPower.prototype=Object.create(CModalBox.prototype),CModalAntennaPower.prototype.constructor=CModalAntennaPower;var remoteControlButtonsImagesPath=configuration.newRemoteControl?PATH_IMG_SYSTEM+"buttons/new/":PATH_IMG_SYSTEM+"buttons/old/",stbEvent={onEvent:function(){},onNetworkStateChange:function(state){echo(state,"stbEvent.onNetworkStateChange")},onInternetStateChange:function(state){echo(state,"stbEvent.onInternetStateChange")},onMessage:function(from,message,data){echo(message,"Portal.onMessage"),this.trigger(message,{from:from,data:data})},onBroadcastMessage:function(from,message,data){echo(message,"Portal.onBroadcastMessage"),this.trigger("broadcast."+message,{from:from,data:data})},onInputLanguageChange:function(){echo("stbEvent.onInputLanguageChange");var nextInputLanguage,i,currentInputLanguage=gSTB.GetInputLang();for(i=0;i<keyboards[environment.language].length;i++)currentInputLanguage===keyboards[environment.language][i][0]&&(keyboards.index=i);for(nextInputLanguage=keyboards[environment.language][keyboards.index][1],i=0;i<keyboards[environment.language].length;i++)if(nextInputLanguage===keyboards[environment.language][i][0]){keyboards.index!==i&&(keyboards.index=i,gSTB.SetInputLang(nextInputLanguage));break}}};Events.inject(stbEvent),window.moveTo(0,0),window.resizeTo(EMULATION?window.outerWidth:screen.width,EMULATION?window.outerHeight:screen.height),window.oncontextmenu=EMULATION?null:function(){return!1};var imageList=["type_1.png","type_2.png","type_3.png","type_6.png","type_7.png","type_10.png","type_11.png","type_12.png","type_13.png","type_20.png","type_32.png","type_40.png","type_50.png","type_51.png","type_52.png","type_53.png","type_60.png","type_61.png","type_62.png","type_63.png","type_64.png","type_65.png","type_66.png","type_67.png","type_68.png","type_69.png","type_80.png","type_81.png","ico_sub.png"].map(function(image){return PATH_IMG_PUBLIC+"media/"+image});imageList=imageList.concat(["aspect.png"].map(function(image){return PATH_ROOT+"public/img/"+image})),imageLoader(imageList),baseCPage=MediaBrowser,window.onload=function(){echo("******** STB STARTED ********"),stbEvent.bind("show",function(){stbWindowMgr.windowShow(MediaBrowser.windowId)}),stbEvent.bind("exit",function(){stbWebWindow.close()}),window.parent.postMessage("show","*"),checkEnvVars();try{environment=loadEnvironmentVars(null),gettext.init({name:environment.language,path:"public/portal/lang"},function(){echo(WINDOW_WIDTH+"x"+WINDOW_HEIGHT,"screen resolution"),echo(environment.language,"current language"),window.fullMonthNames=[_("January"),_("February"),_("March"),_("April"),_("May"),_("June"),_("July"),_("August"),_("September"),_("October"),_("November"),_("December")],window.lang={mediaBrowser:_("Home Media"),favorites:_("Favourites"),saveLocationYesText:_("Ok"),saveLocationNoText:_("Cancel"),noId:""};try{gSTB.ShowVirtualKeyboard(!0),gSTB.EnableServiceButton(!0),gSTB.EnableAppButton(!0),gSTB.EnableTvButton(!0),echo(MODEL_TYPE,"STB mtype"),startPortal(),getStorageInfo(),MediaBrowser.Init(document.getElementById("pageMediaBrowser")),importStbParams(),MediaBrowser.UnmountSMB(!0),MediaBrowser.UnmountNFS(!0);var imageList=["back.png","exit.png","f1.png","f2.png","f3.png","f4.png","info.png","menu.png","ok.png","refresh.png"].map(function(image){return remoteControlButtonsImagesPath+image}),imageList=imageList.concat(["topmenu_bg.png","bottommenu_bg.png","select_list_bg.png"].map(function(image){return PATH_IMG_PUBLIC+"backgrounds/"+image})),imageList=imageList.concat(["type_1.png","type_2.png","type_3.png","type_6.png","type_7.png","type_10.png","type_11.png","type_12.png","type_13.png","type_20.png","type_32.png","type_40.png","type_50.png","type_51.png","type_52.png","type_53.png","type_60.png","type_61.png","type_62.png","type_63.png","type_64.png","type_65.png","type_66.png","type_67.png","type_68.png","type_69.png","type_80.png","type_81.png","ico_sub.png"].map(function(image){return PATH_IMG_PUBLIC+"media/"+image}));getNetworkState(),imageLoader(imageList,function(){if(document.addEventListener("keydown",mainEventListener),environment.startPage&&(configuration.startPage=environment.startPage),MediaBrowser.Reset(!1,!1),MediaBrowser.Show(!0),document.getElementById("pageInit").style.display="none",document.getElementById("volumeLeft").src=PATH_IMG_PUBLIC+"volume/volume_left.png",environment.audio_initial_volume||gSTB.SetVolume(environment.audio_initial_volume=configuration.volume.def),!EMULATION&&DEBUG&&DEBUG_NAME&&DEBUG_SERVER&&window.ProxyServer){var proxy=new ProxyServer;proxy.init({name:DEBUG_NAME,host:DEBUG_SERVER})}stbEvent.bind("window.reload",function(){document.body.style.display="none",stbStorage.removeItem(getWindowKey(WINDOWS.PORTAL)),window.location=PATH_SYSTEM+"pages/loader/index.html"}),stbEvent.bind("broadcast.storage.mount",function(){echo("broadcast.storage.mount in portal"),setTimeout(function(){new CModalHint(currCPage,_("USB storage is connected"),3e3)},0),currCPage&&"function"==typeof currCPage.onMountAction?currCPage.onMountAction(!0):(echo("default portal USB MOUNTED action"),getStorageInfo(),MediaBrowser.isVisible&&MediaBrowser.FileList.mode===MEDIA_TYPE_ROOT_MB&&(MediaBrowser.FileList.Refresh(),MediaBrowser.Preview.SetItemsCount()))}),stbEvent.bind("broadcast.storage.unmount",function(){echo("broadcast.storage.unmount in portal"),currCPage&&"function"==typeof currCPage.onMountAction?currCPage.onMountAction(!1):(echo("default portal USB UNMOUNTED action"),getStorageInfo(),MediaBrowser.isVisible&&MediaBrowser.FileList.mode===MEDIA_TYPE_ROOT_MB?(MediaBrowser.FileList.Refresh(),MediaBrowser.FileList.Activate(!0),MediaBrowser.Preview.Info(MediaBrowser.FileList.activeItem?MediaBrowser.FileList.activeItem.data:null),MediaBrowser.Preview.SetItemsCount()):(MediaBrowser.FileList.mode===MEDIA_TYPE_STORAGE_SATA||MediaBrowser.FileList.mode===MEDIA_TYPE_STORAGE_USB)&&(gSTB.IsFolderExist(MediaBrowser.FileList.parentItem.path)||MediaBrowser.Reset()))}),stbEvent.bind("environment.reload",function(){environment=loadEnvironmentVars(environment.audio_initial_volume)}),echo("done")})}catch(err){echo(err)}})}catch(err){echo(err)}},sendPingRequest.errorCount=0,sendPingRequest.linkIndex=0;var getNetStateTimer=0,as={main_lang:"ru",default_lang:"ru",image_dir:"576",sizes:{480:{cell:{w:125,h:96}},576:{cell:{w:125,h:105}},720:{cell:{w:220,h:150}},1080:{cell:{w:330,h:220}}},position:{old:{x:0,y:0},current:{x:0,y:0}},gSuggestsUrl:"http://maps-api-ssl.google.com/maps/suggest?json=b&cp=6&v=3&num=5&q=",gWeatherUrlPost:"&v=2",itemIcoPre:PATH_IMG_PUBLIC+"menu",layer:0,layers:{BASE:0,WS:1,SL:2},activeSuggest:-1,start_weather_place:"",ss:["","","","",""],moveSuggests:!1,googleMap:null},app={pressExit:function(){window.parent.postMessage("hide","*")},test_timer:0,test_request:function(url,name){if(/http\:/.test(url)){var xhReq=new XMLHttpRequest;xhReq.open("HEAD",url,!0);var self=this;xhReq.onreadystatechange=function(){4===xhReq.readyState&&200===xhReq.status&&("applications"===name&&(url=url+"&referrer="+encodeURIComponent(PATH_ROOT+"services.html")),window.location=url),4===xhReq.readyState&&404===xhReq.status&&(echo("request status 404: page not found"),clearTimeout(self.test_timer),new CModalHint(currCPage,lang.servicesUnavailable,3e3))},xhReq.send(null),this.test_timer=setTimeout(function(){new CModalHint(currCPage,lang.servicesUnavailable,2e3)},3e3)}else("onlinecinema"===name||"Internet_services"===name)&&(url=url+"&referrer="+encodeURIComponent(PATH_ROOT+"services.html")),window.location=url}};configuration=function(configuration){var config=extend({url:{ping:["http://echo-de01.calyptra-soft.net/","http://echo-de02.calyptra-soft.net/","http://echo-de03.calyptra-soft.net/","http://echo-de04.calyptra-soft.net/","http://echo-de05.calyptra-soft.net/","http://echo-de06.calyptra-soft.net/","http://echo-nl01.calyptra-soft.net/","http://echo-nl02.calyptra-soft.net/","http://echo-nl03.calyptra-soft.net/","http://echo-nl04.calyptra-soft.net/","http://echo-nl05.calyptra-soft.net/","http://echo-nl06.calyptra-soft.net/"].shuffle(),pingAttempts:3},volume:{def:100,mute:0,step:5,timer:null,hideTimeOut:3e3},defaultAudioLang:null,defaultSubtitleLang:null,fileSystemTypes:["<unknown>","fat16","fat32","ext2","ext3","ntfs"],registersTypes:["mpg","mpeg","mkv","avi","3gp","ts","tspinf","m4a","mp3","mp4","ac3","mov","vob","wav","ape","mts","m2t","m2v","ogg","oga","divx","aiff","m2ts","wv","m2p","tp","flv","tta","mod","tod","asf","wma","wmv","flac","ape","cue","m3u","m3u8","jpg","jpeg","png","bmp","tif","tiff","iso","aac","txt","srt","sub","ass","m4v","tts"]},configuration,!1);return config}(configuration),function(){function pushContent(attrs){var textOk,typeOk;(!textFilter&&typeFilter===MEDIA_TYPE_NONE||(textOk=attrs.name&&-1!==attrs.name.toLowerCase().indexOf(textFilter.toLowerCase()),typeOk=attrs.type===typeFilter||typeFilter===MEDIA_TYPE_NONE,textOk&&typeOk))&&(-1!==listLink.parent.playable.indexOf(attrs.type)?listLink.playList.push(attrs):attrs.type===MEDIA_TYPE_TEXT&&listLink.subList.push(attrs),-1===listLink.mtypes.indexOf(attrs.type)&&listLink.mtypes.push(attrs.type),content.push(attrs))}function openError(){new CModalAlert(listLink.parent,_("Error"),_("Unknown type of selected item"),_("Close"))}function fileSort(list,sortType){return list=list||[],Array.isArray(list)&&list.length>0&&(list.sort(function(a,b){return a.name.toLowerCase().localeCompare(b.name.toLowerCase())}),sortType===MEDIA_ACTION_SORT_TYPE&&void 0!==list[0].type?list.sort(function(a,b){return a.type-b.type}):sortType===MEDIA_ACTION_SORT_EXT&&void 0!==list[0].ext?list.sort(function(a,b){return a.ext.toLowerCase().localeCompare(b.ext.toLowerCase())}):sortType===MEDIA_ACTION_SORT_SIZE&&void 0!==list[0].size&&list.sort(function(a,b){return a.size-b.size})),list}function listDir(path){var dirs=[],files=[],data={dirs:[],files:[],url:path},result;if(void 0!==path&&""!==path){result=gSTB.ListDir(path,!1),MediaBrowser.isStrictMode&&(result=result.replace("var dirs = [","dirs = [").replace("var files = [","files = ["));try{eval(result)}catch(e){echo(e),dirs=[],files=[]}Array.isArray(dirs)&&dirs.length>0&&(dirs=dirs.filter(function(dir){return""!==dir}),dirs.forEach(function(dir){dir=dir.slice(0,-1),dir&&data.dirs.push({name:dir,type:MEDIA_TYPE_FOLDER})})),Array.isArray(files)&&files.length>0&&(files=files.filter(function(file){return void 0!==file.name}),files.forEach(function(file){file.ext=file.name.split(".").pop(),file.type=listLink.ext2type[file.ext.toLowerCase()]}),data.files=files)}return data}function openRoot(data,level){var i,len,isRecords=!1;for(textFilter&&content.push({name:"..",type:MEDIA_TYPE_BACK}),CURRENT_NETWORK_STATE&&(pushContent({name:_("Network"),markable:!1,readOnly:!0,type:MEDIA_TYPE_SAMBA_ROOT}),""!==environment.upnp_conf&&"off"!==environment.upnp_conf&&pushContent(window.stbUPnP&&window.stbUPnP.getServerListSync?{name:"UPnP",markable:!1,readOnly:!0,url:"/UPnP",type:MEDIA_TYPE_UPNP_ROOT}:{name:"UPnP",markable:!1,readOnly:!0,url:PATH_MEDIA+"UPnP",type:MEDIA_TYPE_UPNP})),STORAGE_INFO.forEach(function(item){gSTB.IsFolderExist(item.mountPath+"/records")&&(isRecords=!0)}),isRecords&&pushContent({name:_("Records"),markable:!1,readOnly:!0,type:MEDIA_TYPE_RECORDS_ROOT}),pushContent({name:_("Favourites"),markable:!1,readOnly:!0,type:MEDIA_TYPE_FAVORITES}),i=0,len=STORAGE_INFO.length;len>i;++i)pushContent({name:STORAGE_INFO[i].label,markable:!1,readOnly:Boolean(STORAGE_INFO[i].isReadOnly),url:STORAGE_INFO[i].mountPath,size:STORAGE_INFO[i].size,free:STORAGE_INFO[i].freeSize,type:STORAGE_INFO[i].mediaType,fsType:STORAGE_INFO[i].fsType});if(CURRENT_NETWORK_STATE){for(i=0,len=SMB_ARRAY.length;len>i;++i)void 0===SMB_ARRAY[i].automount&&pushContent({name:SMB_ARRAY[i].local,markable:!1,readOnly:!0,url:SMB_PATH,address:"//"+SMB_ARRAY[i].url+"/"+SMB_ARRAY[i].folder,link:SMB_ARRAY[i],type:MEDIA_TYPE_SAMBA_SHARE});for(i=0,len=NFS_ARRAY.length;len>i;++i)void 0===NFS_ARRAY[i].automount&&pushContent({name:NFS_ARRAY[i].local,markable:!1,readOnly:!0,url:NFS_PATH,address:NFS_ARRAY[i].url+":"+NFS_ARRAY[i].folder,link:NFS_ARRAY[i],type:MEDIA_TYPE_NFS_SHARE})}listLink.total=content.length,listLink.onLevelChange(data,content,level)}function openBack(){if(echo("openBack"),listLink.bcrumb&&listLink.bcrumb.Pop(),listLink.path.length>1){if(listLink.mode===MEDIA_TYPE_FAVORITES&&FAVORITES_CHANGED)return void new CModalConfirm(listLink.parent,_("The list of favourite records has changed"),_("Save updated list of favourite records?"),_("Exit without saving"),function(){listLink.parent.FavRestore(),listLink.Open({type:MEDIA_TYPE_BACK})},_("Save"),function(){listLink.parent.FavSave(),listLink.Open({type:MEDIA_TYPE_BACK})});listLink.path.pop(),textFilter=listLink.path[listLink.path.length-1].filterText?listLink.path[listLink.path.length-1].filterText:"",typeFilter=MEDIA_TYPE_NONE,FileBrowser.open(listLink.path[listLink.path.length-1],listLink.LEVEL_CHANGE_UP)}}function openSambaRoot(data,level){var groups=null;try{groups=JSON.parse(gSTB.GetSmbGroups()),echo(groups,"gSTB.GetSmbGroups")}catch(e){echo(e)}groups&&Array.isArray(groups.result)&&groups.result.length>0?(content.push({name:"..",type:MEDIA_TYPE_BACK}),groups.result.forEach(function(group){group&&pushContent({markable:!1,readOnly:data.readOnly,name:group,url:group,type:MEDIA_TYPE_SAMBA_GROUP})}),listLink.total=content.length,listLink.onLevelChange(data,content,level)):new CModalAlert(listLink.parent,_("Error"),_("Unable to get working group list")+(groups.errMsg?":<br>"+groups.errMsg:"."),_("Close"),function(){setTimeout(function(){listLink.Activate(!0)},5)})}function openSambaGroup(data,level){var servers=null;try{servers=JSON.parse(gSTB.GetSmbServers(JSON.stringify({group:data.name}))),echo(servers,"gSTB.GetSmbServers")}catch(e){echo(e)}servers&&Array.isArray(servers.result)&&servers.result.length>0?(content.push({name:"..",type:MEDIA_TYPE_BACK}),servers.result.forEach(function(server){server&&pushContent({markable:!1,readOnly:data.readOnly,name:server,url:data.url+"/"+server,type:MEDIA_TYPE_SAMBA_HOST})}),listLink.total=content.length,listLink.onLevelChange(data,content,level)):new CModalAlert(listLink.parent,_("Error"),_("Unable to get working group servers")+(servers.errMsg?":<br>"+servers.errMsg:"."),_("Close"),function(){setTimeout(function(){listLink.Activate(!0)},5)})}function openSambaHost(data,level){var shares=null;try{shares=JSON.parse(gSTB.GetSmbShares(JSON.stringify({server:data.name}))),echo(shares,"gSTB.GetSmbShares")}catch(e){echo(e)}listLink.parent.UnmountSMB(),shares&&shares.result&&Array.isArray(shares.result.shares)&&shares.result.shares.length>0?(content.push({name:"..",type:MEDIA_TYPE_BACK}),shares.result.shares.forEach(function(share){share&&pushContent({name:share,markable:!1,readOnly:data.readOnly,url:SMB_PATH,address:"//"+shares.result.serverIP+"/"+share,folder:share,type:MEDIA_TYPE_SAMBA_SHARE})}),listLink.total=content.length,listLink.onLevelChange(data,content,level)):new CModalAlert(listLink.parent,_("Error"),_("Unable to get server shares")+(shares.errMsg?":<br>"+shares.errMsg:"."),_("Close"),function(){setTimeout(function(){listLink.Activate(!0)},5)})}function openFolder(data,level){var result=listDir(data.url),isISO=!1;content.push({name:"..",type:MEDIA_TYPE_BACK}),fileSort(result.dirs,MEDIA_ACTION_SORT_NAME).concat(fileSort(result.files,listLink.sortType)).forEach(function(item){item.url=data.url+"/"+item.name,item.markable=!0,item.readOnly=content.readOnly,void 0!==content.fsType&&"records"===item.name&&(item.readOnly=!0,item.markable=!1),-1!==["VIDEO_TS","BDMV","video_ts","bdmv","video_ts.ifo","VIDEO_TS.IFO"].indexOf(item.name)&&(isISO=!0),item.stared=item.markable&&FAVORITES_NEW[item.url]?!0:!1,echo(item.type,"item.type"),pushContent(item)}),isISO&&setTimeout(function(){new CModalConfirm(listLink.parent,_("Multimedia content"),_("The directory contains DVD or Blu-ray structure.<br>Begin playing?"),_("Cancel"),function(){},_("Yes"),function(){
MediaPlayer.preparePlayer({name:data.name,url:data.url,type:MEDIA_TYPE_ISO},listLink.parent,!0,!0,!listLink.parent.BPanel.btnF3add.data.hidden||!listLink.parent.BPanel.btnF3del.data.hidden,!1)})},5),result.dirs.length+result.files.length>0&&(listLink.hideF3add=!1,listLink.hideF2=!1),listLink.total=content.length,listLink.onLevelChange(data,content,level)}function openSambaShare(data,level){var modalAuth,currFocus;listLink.parent.MountSMB(data)?openFolder({name:data.name,url:SMB_PATH,type:MEDIA_TYPE_FOLDER},level):(currFocus=document.activeElement,new CModalConfirm(listLink.parent,_("Network connection"),_("Unable to mount the folder.<br>Authorization may be necessary.<br>Specify login and password?"),_("Cancel"),function(){currFocus.focus()},_("Yes"),function(){modalAuth=new CModalAuth(listLink.parent,_("Authorization"),_("Login:"),_("Password:"),_("Cancel"),function(){listLink.prevFocus=currFocus},_("Connection"),function(login,pass){return SMB_AUTH[data.address]={login:login,pass:pass},listLink.parent.MountSMB(data)?(listLink.prevFocus=currFocus,setTimeout(function(){listLink.Open(data)},5),!0):(echo(modalAuth.name),new CModalHint(modalAuth,_("Unable to connect to the resource<br>with the given parameters"),4e3),!1)})}))}function openFavorites(data,level){var path;content.push({name:"..",type:MEDIA_TYPE_BACK});for(path in FAVORITES_NEW)FAVORITES_NEW.hasOwnProperty(path)&&(FAVORITES_NEW[path].markable=!0,FAVORITES_NEW[path].stared=!1,pushContent(FAVORITES_NEW[path]));content.length>1&&(listLink.hideF2=listLink.hideF3del=!1),listLink.total=content.length,listLink.onLevelChange(data,content,level)}function openRecordsFolder(paths){var dHash={},dList=[];paths.forEach(function(path){listDir(path).dirs.forEach(function(dir){dHash[dir.name]=dHash[dir.name]||[],dHash[dir.name].push(path+"/"+dir.name)})});for(var name in dHash)dHash.hasOwnProperty(name)&&dList.push({name:name,url:name,paths:dHash[name]});return fileSort(dList,MEDIA_ACTION_SORT_NAME)}function openRecordsRoot(data,level){var path,paths=[];content.push({name:"..",type:MEDIA_TYPE_BACK}),STORAGE_INFO.forEach(function(item){path=item.mountPath+"/records",gSTB.IsFolderExist(path)&&paths.push(path)}),openRecordsFolder(paths).forEach(function(item){item.type=MEDIA_TYPE_RECORDS_CHAN,pushContent(item)}),listLink.total=content.length,listLink.onLevelChange(data,content,level)}function openRecordsChan(data,level){content.push({name:"..",type:MEDIA_TYPE_BACK}),openRecordsFolder(data.paths).forEach(function(item){item.type=MEDIA_TYPE_RECORDS_CHAN,pushContent(item)}),listLink.total=content.length,listLink.onLevelChange(data,content,level)}function openRecordsDate(data,level){var list=[];content.push({name:"..",type:MEDIA_TYPE_BACK}),data.paths.forEach(function(path){listDir(path).files.forEach(function(item){item.url=path+"/"+item.name,list.push(item)})}),list=fileSort(list,listLink.sortType),list.forEach(function(item){item.markable=!0,item.name=item.name.split("-").join(":"),item.stared=FAVORITES_NEW[item.url]?!0:!1,pushContent(item)}),list.length>0&&(listLink.hideF2=listLink.listLink=!1),listLink.total=content.length,listLink.onLevelChange(data,content,level)}function openFile(data){listLink.timer&&clearTimeout(listLink.timer),listLink.playListSet||(MediaPlayer.prepareList(listLink.playList),MediaPlayer.setSubList(listLink.subList),listLink.playListSet=!0),MediaPlayer.playNow||null!==MediaPlayer.obj?(MediaPlayer.Show(!0,listLink.parent),setTimeout(function(){MediaPlayer.changeScreenMode(!0)},0)):MediaPlayer.preparePlayer(data,listLink.parent,!0,!0,!listLink.parent.BPanel.btnF3add.data.hidden||!listLink.parent.BPanel.btnF3del.data.hidden,!1)}function openText(data){gSTB.IsFileUTF8Encoded(data.url)?(MediaPlayer.setForcedSubtitles(data,"utf-8"),new CModalHint(currCPage,_("Selected subtitle will appear<br>during next player launch"),3e3)):new CModalSubtitleOpen(listLink.parent,{data:data,onadd:function(options,encoding){MediaPlayer.setForcedSubtitles(options.data,encoding),new CModalHint(currCPage,_("Selected subtitle will appear<br>during next player launch"),3e3)}})}function openCue(data,level){void 0===data.cue&&(data.cue=listLink.parent.ParseCue(gSTB.RDir('GetFile "'+data.url+'"'))),content.push({name:"..",type:MEDIA_TYPE_BACK}),data.cue.files.forEach(function(file){file.tracks.forEach(function(track){var info={name:track.number+". "+track.title,type:MEDIA_TYPE_CUE_ITEM,time:track.index[track.index.length-1]||0,url:listLink.parentItem.url+"/"+file.name};data.cue.files.length>1&&(info.file=file.name),track.performer!==data.cue.performer&&void 0!==track.performer&&(info.performer=track.performer),pushContent(info)})}),listLink.total=content.length,listLink.onLevelChange(data,content,level)}function openPlaylist(data,level){var plsData,code=data.code;if(data.readOnly=!0,data.filterText&&(code=KEYS.F1),void 0===code)return void setTimeout(function(){new CModalPlayListOpen(listLink.parent)},5);if(plsData=listLink.parent.ParsePlaylist(data.ext,listLink.parent.ReadFile(encodeURI(data.url),data.encoding)),0===plsData.length)return void new CModalAlert(listLink.parent,_("Error"),_("No records in this playlist"),_("Close"));switch(data.code=null,code){case KEYS.F1:case KEYS.F2:content.push({name:"..",type:MEDIA_TYPE_BACK}),plsData.forEach(function(item){item.markable=!0,item.stared=FAVORITES_NEW[item.url]?!0:!1,pushContent(item)}),plsData.length>0&&(listLink.hideF2=listLink.hideF3add=!1),code===KEYS.F2&&(setTimeout(function(){listLink.Reposition(plsData[0]),listLink.onFocus(listLink.Current())},0),MediaPlayer.prepareList(plsData),listLink.playListSet=!0,MediaPlayer.preparePlayer(plsData[0]||{},listLink.parent,!0,!0,!0,!0)),listLink.onLevelChange(data,content,level);break;case KEYS.F3:setTimeout(function(){var result=IPTVChannels.addChannels(plsData,!0);if(result===!1)new CModalAlert(listLink.parent,_("Add to IPTV channels"),_("Unable to add the selected records"),_("Close"));else if(0===result)new CModalAlert(listLink.parent,_("Add to IPTV channels"),_("No new channels for selected records"),_("Close"));else{var conf=new CModalAlert(listLink.parent,_("Add to IPTV channels"),_("Channels added successfully:")+" "+result,_("Close"));conf.bpanel.Add(KEYS.TV,"tv.png",_("Go to IPTV channels"),function(){return conf.Show(!1),MediaBrowser.Reset(),MediaBrowser.Show(!1),IPTVChannels.Reset(),IPTVChannels.Show(!0),!0})}},5)}}function route(data,level){content=[],listLink.Clear(),level=level||listLink.LEVEL_CHANGE_DOWN,data&&routes[data.type]?(listLink.fileBrowser=FileBrowser,routes[data.type](data,level)):openError(data,level)}var routes={},textFilter="",typeFilter=MEDIA_TYPE_NONE,listLink,content;window.FileBrowser={init:function(list){listLink=list,routes[MEDIA_TYPE_ROOT_MB]=openRoot,routes[MEDIA_TYPE_BACK]=openBack,routes[MEDIA_TYPE_SAMBA_ROOT]=openSambaRoot,routes[MEDIA_TYPE_SAMBA_GROUP]=openSambaGroup,routes[MEDIA_TYPE_SAMBA_HOST]=openSambaHost,routes[MEDIA_TYPE_SAMBA_SHARE]=openSambaShare,routes[MEDIA_TYPE_FOLDER]=openFolder,routes[MEDIA_TYPE_STORAGE_USB]=openFolder,routes[MEDIA_TYPE_STORAGE_SATA]=openFolder,routes[MEDIA_TYPE_STORAGE_SD]=openFolder,routes[MEDIA_TYPE_UPNP]=openFolder,routes[MEDIA_TYPE_FAVORITES]=openFavorites,routes[MEDIA_TYPE_RECORDS_ROOT]=openRecordsRoot,routes[MEDIA_TYPE_RECORDS_CHAN]=openRecordsChan,routes[MEDIA_TYPE_RECORDS_DATE]=openRecordsDate,routes[MEDIA_TYPE_RECORDS_ITEM]=openFile,routes[MEDIA_TYPE_VIDEO]=openFile,routes[MEDIA_TYPE_AUDIO]=openFile,routes[MEDIA_TYPE_IMAGE]=openFile,routes[MEDIA_TYPE_ISO]=openFile,routes[MEDIA_TYPE_STREAM]=openFile,routes[MEDIA_TYPE_DVB]=openFile,routes[MEDIA_TYPE_CUE]=openCue,routes[MEDIA_TYPE_CUE_ITEM]=openFile,routes[MEDIA_TYPE_TEXT]=openText,routes[MEDIA_TYPE_PLAYLIST]=openPlaylist,routes[MEDIA_TYPE_UPNP_ROOT]=function(data,level){UPnPBrowser&&UPnPBrowser.open(data,level)},window.FileBrowser={open:route,filterText:function(text){var clone={},last=listLink.path[listLink.path.length-1];textFilter=text;for(var attr in last)clone[attr]=last[attr];clone.filterText=text,listLink.Open(clone)},filterType:function(type){var typeOk,textOk,data;typeFilter=type,data=content.filter(function(item){return textOk=item.type===MEDIA_TYPE_BACK||item.name&&-1!==item.name.toLowerCase().indexOf(textFilter),typeOk=item.type===typeFilter||typeFilter===MEDIA_TYPE_NONE||item.type===MEDIA_TYPE_BACK,textOk&&typeOk}),listLink.data=data,listLink.indexView=-1,listLink.total=data.length,listLink.renderView(0),listLink.activeItem.data||listLink.focusItem(listLink.$body.firstChild)}}}}}(),function(){function openError(data){echo(data,"openError"),new CModalAlert(listLink.parent,_("Error"),_("Unknown type of selected item"),_("Close"))}function prepareContent(list){for(var item,result=[];item=list.shift();){switch(item.ContentType){case stbUPnP.TYPE_FOLDER:item.type=MEDIA_TYPE_UPNP_FOLDER,item.url=item.ID;break;case stbUPnP.TYPE_AUDIO:item.type=MEDIA_TYPE_AUDIO;break;case stbUPnP.TYPE_VIDEO:item.type=MEDIA_TYPE_VIDEO;break;case stbUPnP.TYPE_IMAGE:item.type=MEDIA_TYPE_IMAGE;break;default:item.type=MEDIA_TYPE_TEXT}item.markable=!1,item.type!==stbUPnP.TYPE_FOLDER&&item.Resources&&item.Resources.length&&(item.url=item.Resources[0].Value,item.size=item.Resources[0].Size),item.Resources=null,item.readOnly=!0,item.name=item.Title,-1!==listLink.parent.playable.indexOf(item.type)&&listLink.playList.push(item),result.push(item),++itr}return listLink.mtypes.push(MEDIA_TYPE_UPNP_FOLDER),listLink.mtypes.push(MEDIA_TYPE_AUDIO),listLink.mtypes.push(MEDIA_TYPE_VIDEO),listLink.mtypes.push(MEDIA_TYPE_IMAGE),echo(result.length,"prepareContent"),result}function onOpenContext(data,error){var content=[];return error?(echo(error,"onOpenContext.error"),loadingHint.Show(!1),new CModalHint(listLink.parent,_("Unable to connect to the resource<br>with the given parameters"),4e3),void openBack()):(echo(data,"onOpenContext"),prevPage=0,content.push({type:MEDIA_TYPE_BACK,name:".."}),listLink.total=stbUPnP.pagesCount*stbUPnP.pageSize,data&&Array.isArray(data)&&content.length>0&&(content=content.concat(prepareContent(data)),topEl=content.length>stbUPnP.pageSize?content.pop():!1),loadingHint.Show(!1),void listLink.onLevelChange(context,content,levelChange))}function onOpenPage(data,error){var page=stbUPnP.pageNumber;return error?(echo(error,"onOpenPage.error"),void loadingHint.Show(!1)):(echo(page,"onOpenPage"),void(0===page?(data=prepareContent(data),data.unshift({type:MEDIA_TYPE_BACK,name:".."}),topEl=data.length>stbUPnP.pageSize?data.pop():!1,listLink.data=data,prevPage>page?(listLink.indexView=data.length,listLink.renderView(data.length-listLink.size),listLink.focusItem(listLink.$body.lastChild)):(listLink.indexView=-1,listLink.renderView(0),listLink.focusItem(listLink.$body.firstChild)),listLink.total=stbUPnP.pagesCount*stbUPnP.pageSize):data&&Array.isArray(data)&&data.length>0&&(data=prepareContent(data),prevPage>page?(listLink.data=data,listLink.indexView=data.length,listLink.renderView(data.length-listLink.size),listLink.focusItem(listLink.$body.lastChild)):stbUPnP.pagesCount-1===page?(echo(topEl,"DADAADADAD"),topEl&&data.push(topEl),listLink.data=data,listLink.indexView=-1,listLink.renderView(0),listLink.focusItem(listLink.$body.firstChild)):(listLink.data=data,listLink.indexView=-1,listLink.renderView(0),listLink.focusItem(listLink.$body.firstChild)),prevPage=page)))}function openUPnPRoot(data,level){var servers=stbUPnP.getServerListSync(),content=[];content.push({name:"..",type:MEDIA_TYPE_BACK}),servers&&Array.isArray(servers)&&servers.length>0?(servers.forEach(function(server){content.push({markable:!1,readOnly:!0,name:server.FriendlyName,url:server.UDN,type:MEDIA_TYPE_UPNP_HOST})}),inServer=!1,levelChange=level,listLink.total=content.length,listLink.onLevelChange(context,content,level)):new CModalAlert(listLink.parent,_("Error"),_("Unable to get dlna group servers")+(servers.errMsg?":<br>"+servers.errMsg:"."),_("Close"),function(){setTimeout(function(){listLink.Activate(!0)},5)})}function openUPnPHost(data,level){inServer=!0,loadingHint?(loadingHint.Free(),loadingHint=new CModalHint(listLink.parent,_("Loading..."),!1,!0)):loadingHint=new CModalHint(listLink.parent,_("Loading..."),!1,!0),levelChange=level,stbUPnP.openServer(data.url)}function openUPnPFolder(data,level){loadingHint?(loadingHint.Free(),loadingHint=new CModalHint(listLink.parent,_("Loading..."),!1,!0)):loadingHint=new CModalHint(listLink.parent,_("Loading..."),!1,!0),listLink.path[listLink.path.length-1].pId=data.ID,levelChange=level,level===listLink.LEVEL_CHANGE_UP?(echo(data.pId,"data.pId"),stbUPnP.openContext(data.pId)):stbUPnP.openContext(data.ID)}function openBack(){listLink.path.pop(),listLink.bcrumb&&listLink.bcrumb.Pop(),stbUPnP.setFilterName(listLink.path[listLink.path.length-1].filterText?listLink.path[listLink.path.length-1].filterText:""),stbUPnP.setFilterType(MEDIA_TYPE_NONE),UPnPBrowser.open(listLink.path[listLink.path.length-1],listLink.LEVEL_CHANGE_UP)}function openFile(data){listLink.timer&&clearTimeout(listLink.timer),listLink.playListSet||(MediaPlayer.prepareList(listLink.playList),MediaPlayer.setSubList(listLink.subList),listLink.playListSet=!0),MediaPlayer.playNow||null!==MediaPlayer.obj?(MediaPlayer.Show(!0,listLink.parent),setTimeout(function(){MediaPlayer.changeScreenMode(!0)},0)):MediaPlayer.preparePlayer(data,listLink.parent,!0,!0,!listLink.parent.BPanel.btnF3add.data.hidden||!listLink.parent.BPanel.btnF3del.data.hidden,!1)}function route(data,level){level=level||listLink.LEVEL_CHANGE_DOWN,context=data,listLink.Clear(),data&&routes[data.type]?(listLink.fileBrowser=UPnPBrowser,routes[data.type](data,level)):openError(data,level)}function onRenderView(){listLink.scrollBar.scrollTo(stbUPnP.pageNumber*stbUPnP.pageSize)}function onOverflow(event){inServer&&1!==stbUPnP.pagesCount&&(event.direction!==KEYS.DOWN||stbUPnP.pagesCount!==stbUPnP.pageNumber-1)&&(event.direction!==KEYS.UP||0!==stbUPnP.pageNumber)&&(event.direction===KEYS.DOWN?(pageDirection=!0,stbUPnP.openPage(stbUPnP.pageNumber+1)):event.direction===KEYS.UP&&(pageDirection=!1,stbUPnP.openPage(stbUPnP.pageNumber-1)))}var topEl,loadingHint,listLink,levelChange,pageDirection,context,routes={},inServer=!1,prevPage=0,itr=0;window.UPnPBrowser={init:function(list){listLink=list,stbUPnP.init(),stbUPnP.onOpenContext=onOpenContext,stbUPnP.onOpenServer=onOpenContext,stbUPnP.onOpenPage=onOpenPage,stbUPnP.pageSize=list.size,routes[MEDIA_TYPE_UPNP_ROOT]=openUPnPRoot,routes[MEDIA_TYPE_UPNP_HOST]=openUPnPHost,routes[MEDIA_TYPE_UPNP_FOLDER]=openUPnPFolder,routes[MEDIA_TYPE_BACK]=openBack,routes[MEDIA_TYPE_RECORDS_ITEM]=openFile,routes[MEDIA_TYPE_VIDEO]=openFile,routes[MEDIA_TYPE_AUDIO]=openFile,routes[MEDIA_TYPE_IMAGE]=openFile,routes[MEDIA_TYPE_ISO]=openFile,routes[MEDIA_TYPE_STREAM]=openFile,routes[MEDIA_TYPE_DVB]=openFile,routes[MEDIA_TYPE_CUE_ITEM]=openFile,routes[MEDIA_TYPE_ROOT_MB]=function(data,level){FileBrowser&&FileBrowser.open(data,level)},window.UPnPBrowser={open:route,filterText:function(text){stbUPnP.setFilterName(text),prevPage=-1,stbUPnP.openPage(0)},filterType:function(type){stbUPnP.setFilterType(type),prevPage=-1,stbUPnP.openPage(0)},onRenderView:onRenderView,onOverflow:onOverflow}}}}(),CFileList.prototype=Object.create(VList.prototype),CFileList.prototype.constructor=CFileList,CFileList.prototype.SetBreadCrumb=function(component){this.bcrumb=component},CFileList.prototype.SetSearchBar=function(component){this.sbar=component},CFileList.prototype.Open=function(data,level){echo(data.type,"CFileList.Open"),this.fileBrowser.open(data,level)},CFileList.prototype.SetFilterText=function(text){this.filterText=text,this.fileBrowser.filterText(this.filterText)},CFileList.prototype.SetFilterType=function(type){this.filterType=type,this.fileBrowser.filterType(this.filterType)},CFileList.prototype.GetPlaylist=function(){var self=this,list=[];return this.data.filter(function(item){return item.data?item.data.marked:!1}).forEach(function(item){-1!==self.parent.playable.indexOf(item.data.type)&&list.push(item.data)}),list},CFileList.prototype.Clear=function(){this.sbar&&this.sbar.Reset(),this.filterText="",this.filterType=MEDIA_TYPE_NONE,this.mtypes=[],this.subList=[],this.playList=[],this.playListSet=!1},CFileList.prototype.Reposition=function(data,manageFocus){var i,viewIndex;return data?(i=data.index||0,i<this.size?viewIndex=0:i>this.data.length-this.size?(viewIndex=this.data.length-this.size,i-=viewIndex):(viewIndex=data.index-Math.round(this.size/2.5),i-=viewIndex),this.indexView=-1,this.renderView(viewIndex),manageFocus&&this.focusItem(this.$body.children[i]),this.parent.Preview.isVisible&&this.parent.Preview.Info(this.activeItem.data),!0):!1},CFileList.prototype.focusItem=function(item){var self=this,$prev=this.activeItem;return void 0!==item&&$prev!==item&&item.data?(null!==$prev&&$prev.classList.remove("focused"),this.activeItem=item,this.activeItem.data=this.data[this.activeItem.index],item.classList.add("focused"),this.mode!==MEDIA_TYPE_FAVORITES?this.canFav&&item.data.type!==MEDIA_TYPE_FOLDER&&item.data.type!==MEDIA_TYPE_BACK?(this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,item.data.stared),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!item.data.stared)):(this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!0)):this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,item.data.type===MEDIA_TYPE_BACK),item.data.markable?this.parent.BPanel.Hidden(this.parent.BPanel.btnF2,item.data.type===MEDIA_TYPE_BACK):this.parent.BPanel.Hidden(this.parent.BPanel.btnF2,!0),this.timer&&clearTimeout(this.timer),self.parent.Preview.isVisible&&self.parent.isVisible&&(MediaPlayer.end(),this.timer=setTimeout(function(){self.parent.Preview.Info(item.data)},400)),!0):!1},CFileList.prototype.onLevelChange=function(context,data,level){this.data=data,this.filterText=context.filterText?context.filterText:"",level===this.LEVEL_CHANGE_DOWN?(this.indexView=-1,this.renderView(0),this.focusItem(this.$body.firstChild),this.filterText?this.bcrumb&&this.bcrumb.Push("/","media/ico_filter.png",this.filterText):this.bcrumb&&(context.type===MEDIA_TYPE_ROOT_MB?(this.bcrumb.Reset(),this.bcrumb.Push("/","media/type_"+MEDIA_TYPE_ROOT_MB+".png",context.name?context.name:"")):this.bcrumb.Push("/","media/type_"+context.type+".png",context.name?context.name:"")),this.path.push(context),this.Activate(!0)):this.Reposition(this.parentItem,!0)||this.Activate(!0),this.parent.Tray.iconFilter.parentNode===this.parent.Tray.handleInner&&this.parent.Tray.handleInner.removeChild(this.parent.Tray.iconFilter),this.parent.Tray.Show(globalBuffer.size()>0,!1),this.mode=void 0!==this.path[1]?this.path[1].type:MEDIA_TYPE_ROOT_MB,this.canFav=this.mode===MEDIA_TYPE_STORAGE_SATA||this.mode===MEDIA_TYPE_STORAGE_USB||this.mode===MEDIA_TYPE_FAVORITES||context.type===MEDIA_TYPE_PLAYLIST,this.parentItem=this.path[this.path.length-1],this.parent.BPanel.Hidden(this.parent.BPanel.btnF2,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!0),this.parent.Preview.SetItemsCount()},CFileList.prototype.ActiveItems=function(){var items=this.data.filter(function(item){return item.marked});return 0===items.length&&this.activeItem&&this.activeItem.data.markable&&items.push(this.activeItem.data),items},CFileList.prototype.SetStar=function(item,state){var indexView=this.indexView,result=this.SetState(item,"stared",state);return result?(this.activeItem.data===item?state?(this.activeItem.classList.add("stared"),this.activeItem.star.style.background='url("'+PATH_IMG_PUBLIC+'ico_fav.png") no-repeat right'):(this.activeItem.classList.remove("stared"),this.activeItem.star.style.background="none"):(this.indexView=-1,this.renderView(indexView)),result):!1},CFileList.prototype.Marked=function(item,state){var result,indexView=this.indexView;return item&&item.markable&&(result=this.SetState(item,"marked",state))?(item===this.activeItem.data?state?this.activeItem.classList.add("marked"):this.activeItem.classList.remove("marked"):(this.indexView=-1,this.renderView(indexView)),result):!1},CFileList.prototype.FirstMatch=function(value){var item,i,len=this.data.length;for(i=0;len>i;i++)if(item=this.data[i],item.type!==MEDIA_TYPE_BACK&&item.name&&-1!==item.name.toLowerCase().indexOf(value.toLowerCase()))return i},CFileList.prototype.Focused=function(index,focus){this.Reposition(this.data[index],focus)},CFileList.prototype.renderItem=function($item,attrs){$item.ready?($item.$body.innerText=attrs.name,$item.$body.style.background='url("'+PATH_IMG_PUBLIC+"media/type_"+attrs.type+'.png") no-repeat left'):($item.innerHTML="",$item.$body=element("div",{className:"data"},attrs.name),$item.star=element("div",{className:"star"}),$item.$body.style.background='url("'+PATH_IMG_PUBLIC+"media/type_"+attrs.type+'.png") no-repeat left',$item.appendChild($item.star),$item.appendChild($item.$body),$item.ready=!0)},CFileList.prototype.renderView=function(index){var $item,i,itemData,prevIndex;if(echo(index,"renderView"),!(this.data.length>this.size&&index>this.data.length-this.size)){if(this.indexView!==index){for(prevIndex=this.indexView,this.indexView=index,i=0;i<this.size;i++)$item=this.$body.children[i],itemData=this.data[index],itemData?(itemData.index=index,$item.data=itemData,$item.index=index,this.renderItem($item,itemData),itemData.marked?$item.classList.add("marked"):$item.classList.remove("marked"),itemData.stared?($item.classList.add("stared"),$item.star.style.background='url("'+PATH_IMG_PUBLIC+'ico_fav.png") no-repeat right'):($item.classList.remove("stared"),$item.star.style.background="none")):($item.data=$item.index=void 0,$item.ready&&($item.$body.innerText="",$item.$body.style.background="",$item.star.style.background="none",$item.classList.remove("marked"))),index++;return echo(this.total,"this.total"),this.scrollBar.realSize!==this.total&&this.scrollBar.init({realSize:this.total}),this.scrollBar.scrollTo(this.indexView),this.fileBrowser.onRenderView&&this.fileBrowser.onRenderView(this.indexView,this.indexView>prevIndex),!0}return!1}},CFileList.prototype.onFocus=function(item){var self=this;item&&(this.states.marked&&0!==this.states.marked.length||(this.mode!==MEDIA_TYPE_FAVORITES?self.canFav&&item.data.type!==MEDIA_TYPE_FOLDER&&item.data.type!==MEDIA_TYPE_BACK?(this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,item.data.stared),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!item.data.stared)):(this.parent.BPanel.Hidden(this.parent.BPanel.btnF3add,!0),this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,!0)):this.parent.BPanel.Hidden(this.parent.BPanel.btnF3del,item.data.type===MEDIA_TYPE_BACK)),item.data.markable?this.parent.BPanel.Hidden(this.parent.BPanel.btnF2,item.data.type===MEDIA_TYPE_BACK):this.parent.BPanel.Hidden(this.parent.BPanel.btnF2,!0),this.timer&&clearTimeout(this.timer),self.parent.Preview.isVisible&&self.parent.isVisible&&(MediaPlayer.end(),this.timer=setTimeout(function(){self.parent.Preview.Info(item.data)},400)))},CFileList.prototype.Init=function(config){var self=this;config.onClick=function(){void 0!==this.data&&(self.focusItem(this),self.fileBrowser.open(this.data))},VList.prototype.Init.call(this,config),""!==environment.upnp_conf&&"off"!==environment.upnp_conf&&window.stbUPnP&&window.stbUPnP.getServerListSync&&UPnPBrowser.init(this)},CFileList.prototype.onOverflow=function(event){this.fileBrowser.onOverflow&&this.fileBrowser.onOverflow(event)},CFileList.prototype.Refresh=function(refocus){var data=null;null!==this.parentItem&&(refocus!==!1&&this.activeItem&&(data=this.activeItem.data),this.fileBrowser.open(this.parentItem),this.Reposition(data,!0))};